---
layout: post
title: ReactJSè¯­æ³•-ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
category: Webå¼€å‘
tags: Webå¼€å‘
description: Webå¼€å‘
--- 

## æ¦‚å¿µ
1. åœ¨ç»„ä»¶åˆ›å»ºã€åˆ°åŠ è½½åˆ°é¡µé¢ä¸Šè¿è¡Œã€ä»¥åŠç»„ä»¶è¢«é”€æ¯çš„è¿‡ç¨‹ä¸­ï¼Œæ€»æ˜¯ä¼´éšç€å„ç§å„æ ·çš„äº‹ä»¶ï¼Œè¿™äº›åœ¨ç»„ä»¶ç‰¹å®šæ—¶æœŸï¼Œè§¦å‘çš„äº‹ä»¶ï¼Œç»Ÿç§°ä¸º ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼›

![pic](https://gitee.com/zhonghua123/blogimgs/raw/master/img/webzh_58.png/)

### ç»„ä»¶åˆ›å»ºé˜¶æ®µ
> ç»„ä»¶åˆ›å»ºé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæœ‰ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹ç‚¹ï¼šåˆ›å»ºé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œåœ¨ç»„ä»¶çš„ä¸€è¾ˆå­ä¸­ï¼Œåªæ‰§è¡Œä¸€æ¬¡ï¼›

1. componentWillMount: ç»„ä»¶å°†è¦è¢«æŒ‚è½½ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰å¼€å§‹æ¸²æŸ“è™šæ‹ŸDOM
2. renderï¼šç¬¬ä¸€æ¬¡å¼€å§‹æ¸²æŸ“çœŸæ­£çš„è™šæ‹ŸDOMï¼Œå½“renderæ‰§è¡Œå®Œï¼Œå†…å­˜ä¸­å°±æœ‰äº†å®Œæ•´çš„è™šæ‹ŸDOMäº†
3. componentDidMount: ç»„ä»¶å®Œæˆäº†æŒ‚è½½ï¼Œæ­¤æ—¶ï¼Œç»„ä»¶å·²ç»æ˜¾ç¤ºåˆ°äº†é¡µé¢ä¸Šï¼Œå½“è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œï¼Œç»„ä»¶å°±è¿›å…¥éƒ½äº† è¿è¡Œä¸­ çš„çŠ¶æ€

### ç»„ä»¶è¿è¡Œé˜¶æ®µ
> ä¹Ÿæœ‰ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹ç‚¹ï¼Œæ ¹æ®ç»„ä»¶çš„stateå’Œpropsçš„æ”¹å˜ï¼Œæœ‰é€‰æ‹©æ€§çš„è§¦å‘0æ¬¡æˆ–å¤šæ¬¡ï¼›

1. componentWillReceiveProps: ç»„ä»¶å°†è¦æ¥æ”¶æ–°å±æ€§ï¼Œæ­¤æ—¶ï¼Œåªè¦è¿™ä¸ªæ–¹æ³•è¢«è§¦å‘ï¼Œå°±è¯æ˜çˆ¶ç»„ä»¶ä¸ºå½“å‰å­ç»„ä»¶ä¼ é€’äº†æ–°çš„å±æ€§å€¼ï¼›
2. shouldComponentUpdate: ç»„ä»¶æ˜¯å¦éœ€è¦è¢«æ›´æ–°ï¼Œæ­¤æ—¶ï¼Œç»„ä»¶å°šæœªè¢«æ›´æ–°ï¼Œä½†æ˜¯ï¼Œstate å’Œ props è‚¯å®šæ˜¯æœ€æ–°çš„
3. componentWillUpdate: ç»„ä»¶å°†è¦è¢«æ›´æ–°ï¼Œæ­¤æ—¶ï¼Œå°šæœªå¼€å§‹æ›´æ–°ï¼Œå†…å­˜ä¸­çš„è™šæ‹ŸDOMæ ‘è¿˜æ˜¯æ—§çš„
4. render: æ­¤æ—¶ï¼Œåˆè¦é‡æ–°æ ¹æ®æœ€æ–°çš„ state å’Œ props é‡æ–°æ¸²æŸ“ä¸€æ£µå†…å­˜ä¸­çš„ è™šæ‹ŸDOMæ ‘ï¼Œå½“ render è°ƒç”¨å®Œæ¯•ï¼Œå†…å­˜ä¸­çš„æ—§DOMæ ‘ï¼Œå·²ç»è¢«æ–°DOMæ ‘æ›¿æ¢äº†ï¼æ­¤æ—¶é¡µé¢è¿˜æ˜¯æ—§çš„
5. componentDidUpdate: æ­¤æ—¶ï¼Œé¡µé¢åˆè¢«é‡æ–°æ¸²æŸ“äº†ï¼Œstate å’Œ è™šæ‹ŸDOM å’Œ é¡µé¢å·²ç»å®Œå…¨ä¿æŒåŒæ­¥

### ç»„ä»¶é”€æ¯é˜¶æ®µ
> ä¹Ÿæœ‰ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹ç‚¹ï¼Œä¸€è¾ˆå­åªæ‰§è¡Œä¸€æ¬¡ï¼›

1. componentWillUnmount: ç»„ä»¶å°†è¦è¢«å¸è½½ï¼Œæ­¤æ—¶ç»„ä»¶è¿˜å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼›

## ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°
1. Reactç”Ÿå‘½å‘¨æœŸçš„å›è°ƒå‡½æ•°æ€»ç»“æˆè¡¨æ ¼å¦‚ä¸‹ï¼š
    ![pic](https://gitee.com/zhonghua123/blogimgs/raw/master/img/webzh_59.png/)
    
2. ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ‰§è¡Œé¡ºåºï¼š
+ Mountingï¼š
 - constructor()
 - componentWillMount()
 - render()
 - componentDidMount()
+ Updatingï¼š
 - componentWillReceiveProps(nextProps)
 - shouldComponentUpdate(nextProps, nextState)
 - componentWillUpdate(nextProps, nextState)
 - render()
 - componentDidUpdate(prevProps, prevState)
+ Unmountingï¼š
 - componentWillUnmount()
    
### defaultProps
1. åœ¨ç»„ä»¶åˆ›å»ºä¹‹å‰ï¼Œä¼šå…ˆåˆå§‹åŒ–é»˜è®¤çš„propså±æ€§ï¼Œè¿™æ˜¯å…¨å±€è°ƒç”¨ä¸€æ¬¡ï¼Œä¸¥æ ¼åœ°æ¥è¯´ï¼Œè¿™ä¸æ˜¯ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçš„ä¸€éƒ¨åˆ†ã€‚åœ¨ç»„ä»¶è¢«åˆ›å»ºå¹¶åŠ è½½å€™ï¼Œé¦–å…ˆè°ƒç”¨ constructor æ„é€ å™¨ä¸­çš„ this.state = {}ï¼Œæ¥åˆå§‹åŒ–ç»„ä»¶çš„çŠ¶æ€ã€‚


## Counterè®¡æ•°å™¨æ¡ˆä¾‹

### defaultPropsè®¾ç½®ç»„ä»¶é»˜è®¤å€¼
1. åœ¨ç»„ä»¶åˆ›å»ºä¹‹å‰ï¼Œä¼šå…ˆåˆå§‹åŒ–é»˜è®¤çš„propså±æ€§ï¼Œè¿™æ˜¯å…¨å±€è°ƒç”¨ä¸€æ¬¡ï¼Œä¸¥æ ¼åœ°æ¥è¯´ï¼Œè¿™ä¸æ˜¯ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçš„ä¸€éƒ¨åˆ†ã€‚åœ¨ç»„ä»¶è¢«åˆ›å»ºå¹¶åŠ è½½å€™ï¼Œé¦–å…ˆè°ƒç”¨ constructor æ„é€ å™¨ä¸­çš„ this.state = {}ï¼Œæ¥åˆå§‹åŒ–ç»„ä»¶çš„çŠ¶æ€ã€‚
2. åˆ›å»ºCounter.jsx

    ```
    import React from 'react'
    
    export default class Counter extends React.Component {
    
      constructor(props) {
        super(props)
        // åˆå§‹åŒ–ç»„ä»¶çš„ç§æœ‰çŠ¶æ€ï¼Œä¿å­˜çš„æ˜¯ç»„ä»¶çš„ç§æœ‰æ•°æ®
        this.state = {
        msg: 'ok'
        }
      }
      
        // åœ¨å°è£…ä¸€ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œç»„ä»¶å†…éƒ¨ï¼Œè‚¯å®šæœ‰ä¸€äº›æ•°æ®æ˜¯å¿…é¡»çš„ï¼Œå“ªæ€•ç”¨æˆ·æ²¡æœ‰ä¼ é€’ä¸€äº›ç›¸å…³çš„å¯åŠ¨å‚æ•°ï¼Œè¿™æ—¶å€™ï¼Œç»„ä»¶å†…éƒ¨ ï¼Œå°½é‡ ç»™è‡ªå·±æä¾›ä¸€ä¸ªé»˜è®¤å€¼ï¼›
      // åœ¨ React ä¸­ï¼Œä½¿ç”¨é™æ€çš„ defaultProps å±æ€§ï¼Œæ¥è®¾ç½® ç»„ä»¶çš„ é»˜è®¤å±æ€§å€¼ï¼›
      static defaultProps = {
        initcount: 0 // å¦‚æœå¤–ç•Œæ²¡æœ‰ä¼ é€’ initcountï¼Œé‚£ä¹ˆï¼Œè‡ªå·±åˆå§‹åŒ–ä¸€ä¸ª æ•°å€¼ï¼Œä¸º0
      }
      
      render() {
        return <div>
          <h1>è¿™æ˜¯ Counter è®¡æ•°å™¨ç»„ä»¶</h1>
          <input type="button" value="+1"/>
          <hr />
          <h3 id="myh3">å½“å‰çš„æ•°é‡æ˜¯ï¼š{this.props.initcount}</h3>
        </div>
      }
    }
    ```
3. main.jså¯¼å…¥
    
    ```
    import React from 'react'
    import ReactDOM from 'react-dom'
    import Counter from './components/Counter.jsx'
    // ä½¿ç”¨ render å‡½æ•°æ¸²æŸ“ è™šæ‹ŸDOM
    ReactDOM.render(<div>
      <Counter></Counter>
      
      {/*èƒ¡ä¹±ä¼ é€’æ•°æ®ï¼Œè¿™å°±éœ€è¦ç»„ä»¶å†…éƒ¨åšæ•°æ®ç±»å‹æ ¡éªŒ */}
      <Counter initcount="å“ˆå“ˆå“ˆå“ˆå“ˆ"></Counter> 
     
    </div>, document.getElementById('app'))
    ```
4. index.html
    
    ```
    <body>
      <!-- å®¹å™¨ï¼Œå°†æ¥é€šè¿‡ React æ¸²æŸ“å¾—åˆ°çš„ è™šæ‹ŸDOMï¼Œä¼šå‘ˆç°åˆ°è¿™ä¸ªä½ç½® -->
      <div id="app"></div>
    </body>
    ```

### propTypeså®ç°ç»„ä»¶å†…éƒ¨æ•°æ®ç±»å‹æ ¡éªŒ
1. å¦‚æœå¤–éƒ¨ç»™Counterç»„ä»·ä¼ é€’çš„æ˜¯åƒåœ¾æ•°æ®ï¼Œé‚£ä¹ˆç»„ä»¶å†…éƒ¨å°±éœ€è¦åšç±»å‹æ ¡éªŒ
    
    ```
    //main.js
    ...
    {/*èƒ¡ä¹±ä¼ é€’æ•°æ®ï¼Œè¿™å°±éœ€è¦ç»„ä»¶å†…éƒ¨åšæ•°æ®ç±»å‹æ ¡éªŒ */}
    <Counter initcount="å“ˆå“ˆå“ˆå“ˆå“ˆ"></Counter> 
    ...
    ```
2. Counter.jsxå†…éƒ¨æ–°å¢propTypes
    1. æ·»åŠ ç¬¬ä¸‰æ–¹åŒ…ï¼Œå«åš prop-types
    2. å¯¼å…¥
    
    ```
    // æ³¨æ„ï¼š prop-types åŒ…ä¸­èŒèƒ½è·Ÿå•ä¸€ï¼Œåªæä¾›äº† ä¸€äº›å¸¸è§çš„ æ•°æ®ç±»å‹ï¼Œç”¨äºåšç±»å‹æ ¡éªŒ
    import ReactTypes from 'prop-types'
    export default class Counter extends React.Component {
        ...
     // è¿™æ˜¯åˆ›å»ºä¸€ä¸ª é™æ€çš„ propTypes å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªå¯¹è±¡ä¸­ï¼Œå¯ä»¥æŠŠ å¤–ç•Œä¼ é€’è¿‡æ¥çš„å±æ€§ï¼Œåšç±»å‹æ ¡éªŒï¼›
      // æ³¨æ„ï¼š å¦‚æœè¦ä¸º ä¼ é€’è¿‡æ¥çš„å±æ€§åšç±»å‹æ ¡éªŒï¼Œå¿…é¡»å®‰è£… React æä¾›çš„ ç¬¬ä¸‰æ–¹åŒ…ï¼Œå«åš prop-types ;
      // prop-types å¤§æ¦‚åœ¨ v.15.* ä¹‹å‰ï¼Œå¹¶æ²¡æœ‰å•ç‹¬æŠ½ç¦»å‡ºæ¥ï¼Œé‚£æ—¶å€™ï¼Œè¿˜å’Œ react åŒ… åœ¨ä¸€èµ·ï¼›åæ¥ï¼Œ ä» v.15.* ä¹‹åï¼Œå®˜æ–¹æŠŠç±»å‹æ ¡éªŒçš„ æ¨¡å—ï¼Œå•ç‹¬æŠ½ç¦»ä¸º ä¸€ä¸ªåŒ…ï¼Œå°±å«åš prop-types
      static propTypes = {
        initcount: ReactTypes.number // ä½¿ç”¨ prop-types åŒ…ï¼Œæ¥å®šä¹‰ initcount ä¸º number ç±»å‹
      }
        ...
    }
    ```

### ç”Ÿå‘½å‘¨æœŸå‡½æ•°componentWillMount
1. åœ¨Counter.jsxçš„renderæ–¹æ³•å‰é¢ï¼Œæ·»åŠ componentWillMountæ–¹æ³•
    
    ```
    // åœ¨ç»„ä»¶å³å°†æŒ‚è½½åˆ°é¡µé¢ä¸Šçš„æ—¶å€™æ‰§è¡Œï¼Œæ­¤æ—¶ï¼Œç»„ä»¶å°šæœªæŒ‚è½½åˆ°é¡µé¢ä¸­
    // è™šæ‹ŸDOMæ˜¯å¦åˆ›å»ºå¥½äº†å‘¢ï¼Ÿæ­¤æ—¶ï¼Œå†…å­˜ä¸­çš„è™šæ‹ŸDOMä¹Ÿæ²¡å¼€å§‹åˆ›å»ºå‘¢
    componentWillMount() {
        // æ­¤æ—¶ï¼Œæ— æ³•è·å–åˆ° é¡µé¢ä¸Šçš„ ä»»ä½•å…ƒç´ ï¼Œå› ä¸º è™šæ‹ŸDOM å’Œ é¡µé¢ éƒ½è¿˜æ²¡æœ‰å¼€å§‹æ¸²æŸ“å‘¢ï¼ã€åœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œä¸èƒ½å»æ“ä½œé¡µé¢ä¸Šçš„DOMå…ƒç´ ã€‘
        // console.log(document.getElementById('myh3'));
        //å¯ä»¥è·å–åˆ°
        // console.log(this.props.initcount);
        //å¯ä»¥è·å–åˆ°
        // console.log(this.state.msg);
        //å¯ä»¥è·å–åˆ°
        // this.myselfFunc()
    }
    //è‡ªå®šä¹‰æ–¹æ³•
    myselfFunc() {
        console.log('è¿™æ˜¯æˆ‘è‡ªå·±å®šä¹‰çš„å‡½æ•°ï¼Œå’Œç”Ÿå‘½å‘¨æœŸå‡½æ•°æ— å…³');
    }
    ```
    
### ç”Ÿå‘½å‘¨æœŸå‡½æ•°render

```
// å½“æ‰§è¡Œåˆ° è¿™ä¸ª ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„æ—¶å€™ï¼Œå³å°†è¦å¼€å§‹æ¸²æŸ“å†…å­˜ä¸­çš„ è™šæ‹ŸDOMäº†ï¼Œå½“è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œï¼Œå†…å­˜ä¸­å°±æœ‰äº†ä¸€ä¸ª æ¸²æŸ“å¥½çš„è™šæ‹ŸDOMï¼Œä½†æ˜¯ï¼Œé¡µé¢ä¸Šå°šæœªçœŸæ­£æ˜¾ç¤ºDOMå…ƒç´ å‘¢ï¼›
render() {
    // åœ¨ return ä¹‹å‰ï¼Œè™šæ‹ŸDOMè¿˜æ²¡æœ‰å¼€å§‹åˆ›å»ºï¼Œé¡µé¢ä¸Šä¹Ÿæ˜¯ç©ºçš„ï¼Œæ ¹æœ¬æ‹¿ä¸åˆ°ä»»ä½•çš„ å…ƒç´ 
    // console.log(document.getElementById('myh3'));
    return <div>
        <h1>è¿™æ˜¯ Counter è®¡æ•°å™¨ç»„ä»¶</h1>
        <input type="button"  value="+1" id="btn"/>
        <hr />
        <h3 id="myh3">å½“å‰çš„æ•°é‡æ˜¯ï¼š{this.props.initcount}</h3>
    </div>
    // å½“ return æ‰§è¡Œå®Œæ¯•åï¼Œ è™šæ‹ŸDOMåˆ›å»ºå¥½äº†ï¼Œä½†æ˜¯ï¼Œè¿˜æ²¡æœ‰æŒ‚è½½åˆ°çœŸæ­£çš„é¡µé¢ä¸­
}
```

### ç”Ÿå‘½å‘¨æœŸå‡½æ•°componentDidMount
1. åœ¨renderå‡½æ•°ä¸‹é¢æ–°å¢componentDidMount

```
 // å½“ç»„ä»¶æŒ‚è½½åˆ°é¡µé¢ä¸Šä¹‹åï¼Œä¼šè¿›å…¥è¿™ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œåªè¦è¿›å…¥è¿™ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°äº†ï¼Œå¿…ç„¶è¯´æ˜ï¼Œé¡µé¢ä¸Šï¼Œå·²ç»æœ‰å¯è§çš„DOMå…ƒç´ äº†
// å½“ç»„ä»¶æ‰§è¡Œå®Œ componentDidMount å‡½æ•°åï¼Œå°±è¿›å…¥åˆ°äº† è¿è¡Œä¸­çš„çŠ¶æ€ï¼Œæ‰€ä»¥ï¼ŒcomponentDidMount æ˜¯åˆ›å»ºé˜¶æ®µçš„æœ€åä¸€ä¸ªå‡½æ•°
componentDidMount() {
    // åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒçš„å» æ“ä½œ é¡µé¢ä¸Šä½ éœ€è¦ä½¿ç”¨çš„ DOM å…ƒç´ äº†ï¼›
    // å¦‚æœæˆ‘ä»¬æƒ³æ“ä½œDOMå…ƒç´ ï¼Œæœ€æ—©ï¼Œåªèƒ½åœ¨ componentDidMount ä¸­è¿›è¡Œï¼›
    // componentDidMount ç›¸å½“äº Vue ä¸­çš„ mounted å‡½æ•°
    // console.log(document.getElementById('myh3'));
}
```

### ç”Ÿå‘½å‘¨æœŸå‡½æ•°shouldComponentUpdate

#### è®¾ç½®è§¦å‘æ¡ä»¶
1. ç»™buttonæ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œåœ¨componentDidMountä¸­
    
    ```
    componentDidMount() {
        document.getElementById('btn').onclick = () => {
            // console.log('ok');
            // console.log(this);
            //initcountåªè¯»å±æ€§ï¼Œä¸èƒ½æ”¹å˜,å› æ­¤è¦ä½¿ç”¨stateç§æœ‰å±æ€§
            // this.props.initcount++
            //å¯ä»¥ä½¿ç”¨setStateå˜æ›´
            this.setState({
                count: this.state.count + 1
            })
        } 
    }
    ```
2. è®¾ç½®ç§æœ‰å±æ€§stateæ¥æ”¶å¤–éƒ¨å‚æ•°
    
    ```
    this.state = {
      msg: 'ok',
      count: props.initcount  // åŸºæ•°, æŠŠ å¤–ç•Œä¼ é€’è¿‡æ¥çš„ initcount èµ‹å€¼ç»™ state ä¸­çš„ countå€¼ï¼Œè¿™æ ·ï¼Œå°±æŠŠ count å€¼æ”¹æˆäº†å¯è¯»å¯å†™çš„ state å±æ€§ï¼Œä»Šåï¼Œå°±èƒ½å®ç° ç‚¹å‡» æŒ‰é’® ï¼Œcount å€¼ + 1 çš„éœ€æ±‚äº†
    }
    ```
3. å°†renderä¸­çš„h3æ ‡ç­¾çš„å±•ç¤ºç”±propsæ¢æˆstate
    
    ```
    <h3 id="myh3" ref="h3">å½“å‰çš„æ•°é‡æ˜¯ï¼š{this.state.count}</h3>
    ```
4. ä¹Ÿå¯ä»¥é€šè¿‡reactæ–¹å¼ç»™buttnæ·»åŠ æ—¶é—´ï¼Œä¸é€šè¿‡componentDidMountå†…éƒ¨æ·»åŠ 
    
    ```
    //renderä¸­buttnæ·»åŠ ç‚¹å‡»äº‹ä»¶
     <input type="button" value="+1" id="btn" onClick={this.increment} />
     
    //å®ç°ç‚¹å‡»äº‹ä»¶
    increment = () => {
        this.setState({
            count: this.state.count + 1
        })
    }
    ```
5. ä»¥ä¸Šå½“ç‚¹å‡»buttnæ—¶ï¼Œå°±ä¼šæ”¹å˜ç§æœ‰å±æ€§stateï¼Œå°±ä¼šè§¦å‘ç»„ä»¶é¡µé¢æ›´æ–°ï¼Œå³shouldComponentUpdate

#### shouldComponentUpdate

```
 // ä»è¿™é‡Œå¼€å§‹ï¼Œå°±è¿›å…¥åˆ°äº†ç»„ä»¶çš„è¿è¡Œä¸­çŠ¶æ€
// åˆ¤æ–­ç»„ä»¶æ˜¯å¦éœ€è¦æ›´æ–°
shouldComponentUpdate(nextProps, nextState) {
    // 1. åœ¨ shouldComponentUpdate ä¸­è¦æ±‚å¿…é¡»è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
    // 2. åœ¨ shouldComponentUpdate ä¸­ï¼Œå¦‚æœè¿”å›çš„å€¼æ˜¯ falseï¼Œåˆ™ ä¸ä¼šç»§ç»­æ‰§è¡Œåç»­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œè€Œæ˜¯ç›´æ¥é€€å›åˆ°äº† è¿è¡Œä¸­ çš„çŠ¶æ€ï¼Œæ­¤æ—¶æœ‰åº åç»­çš„ render å‡½æ•°å¹¶æ²¡æœ‰è¢«è°ƒç”¨ï¼Œå› æ­¤ï¼Œé¡µé¢ä¸ä¼šè¢«æ›´æ–°ï¼Œä½†æ˜¯ï¼Œ ç»„ä»¶çš„ state çŠ¶æ€ï¼Œå´è¢«ä¿®æ”¹äº†ï¼›
    // return false
    
    // éœ€æ±‚ï¼š å¦‚æœ state ä¸­çš„ count å€¼æ˜¯å¶æ•°ï¼Œåˆ™ æ›´æ–°é¡µé¢ï¼Œå¦‚æœ count å€¼ æ˜¯å¥‡æ•°ï¼Œåˆ™ä¸æ›´æ–°é¡µé¢ï¼Œæˆ‘ä»¬æƒ³è¦çš„é¡µé¢æ•ˆæœï¼š4ï¼Œ6ï¼Œ8ï¼Œ10ï¼Œ12....
    // ç»è¿‡æ‰“å°æµ‹è¯•å‘ç°ï¼Œåœ¨ shouldComponentUpdate ä¸­ï¼Œé€šè¿‡ this.state.count æ‹¿åˆ°çš„å€¼ï¼Œæ˜¯ä¸Šä¸€æ¬¡çš„æ—§æ•°æ®ï¼Œå¹¶ä¸æ˜¯å½“å‰æœ€æ–°çš„ï¼›
    // console.log(this.state.count + ' ---- ' + nextState.count);
    // return this.state.count % 2 === 0 ? true : false
    //ä½¿ç”¨nextStateè·å–æœ€æ–°å€¼
    // return nextState.count % 2 === 0 ? true : false
    return true
}
```

### ç”Ÿå‘½å‘¨æœŸå‡½æ•°componentWillUpdate

```
// ç»„ä»¶å°†è¦æ›´æ–°ï¼Œæ­¤æ—¶å°šæœªæ›´æ–°ï¼Œåœ¨è¿›å…¥è¿™ä¸ª ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„è™šæ‹ŸDOMæ˜¯æ—§çš„ï¼Œé¡µé¢ä¸Šçš„ DOM å…ƒç´  ä¹Ÿæ˜¯æ—§çš„
componentWillUpdate() {
    // ç»è¿‡æ‰“å°åˆ†æï¼Œå¾—åˆ°ï¼Œæ­¤æ—¶é¡µé¢ä¸Šçš„ DOM èŠ‚ç‚¹ï¼Œéƒ½æ˜¯æ—§çš„ï¼Œåº”è¯¥æ…é‡æ“ä½œï¼Œå› ä¸ºä½ å¯èƒ½æ“ä½œçš„æ˜¯æ—§DOM
    // console.log(document.getElementById('myh3').innerHTML)
    
     //1. ç»™h3æ ‡ç­¾ç»‘å®šrefå±æ€§<h3 id="myh3" ref="h3">å½“å‰çš„æ•°é‡æ˜¯ï¼š{this.state.count}</h3>
    //2. ä½¿ç”¨refsæ¥è·å–
    // console.log(this.refs.h3.innerHTML);
    // console.log(this.refs.h3.innerHTML);
}
```

### ç”Ÿå‘½å‘¨æœŸå‡½æ•°componentDidUpdate

```
// ç»„ä»¶å®Œæˆäº†æ›´æ–°ï¼Œæ­¤æ—¶ï¼Œstate ä¸­çš„æ•°æ®ã€è™šæ‹ŸDOMã€é¡µé¢ä¸Šçš„DOMï¼Œéƒ½æ˜¯æœ€æ–°çš„ï¼Œæ­¤æ—¶ï¼Œä½ å¯ä»¥æ”¾å¿ƒå¤§èƒ†çš„å»æ“ä½œé¡µé¢äº†
componentDidUpdate() {
    // console.log(this.refs.h3.innerHTML);
}
```
### æ³¨æ„ç‚¹
1. ä¸è¦åœ¨ render ä¸­ä½¿ç”¨ this.setState,å› ä¸º ä¼šé™·å…¥æ­»å¾ªç¯
    
    ```
    render() {
        //ä¼šé™·å…¥æ­»å¾ªç¯
        /*  this.setState({
          count: this.state.count + 1
        }) */
        return <div>
          <h1>è¿™æ˜¯ Counter è®¡æ•°å™¨ç»„ä»¶</h1>
          <input type="button" value="+1" id="btn" onClick={this.increment} />
          <hr />
          <h3 id="myh3" ref="h3">å½“å‰çš„æ•°é‡æ˜¯ï¼š{this.state.count}</h3>
        </div>
    }
    ```

### ç”Ÿå‘½å‘¨æœŸå‡½æ•°componentWillReceiveProps
1. ç†è®ºä¸Šæ¥è¯´propså±æ€§æ˜¯åªè¯»å±æ€§ï¼Œé‚£ä¹ˆå¦‚ä½•è®¾ç½®propså‘—ä¿®æ”¹çš„åœºæ™¯å‘¢ï¼Ÿ
2. propså±æ€§åªæ˜¯åœ¨ç»„ä»¶å†…éƒ¨ä¸èƒ½ä¿®æ”¹ï¼Œä½†æ˜¯å¯ä»¥åœ¨å¤–éƒ¨è¢«ä¿®æ”¹ã€‚
3. åœºæ™¯ï¼š
    1. è®¾ç½®ä¸€ä¸ªçˆ¶ç»„ä»¶Parentå’Œä¸€ä¸ªå­ç»„ä»¶Son
    2. è®©çˆ¶ç»„ä»¶çš„stateä½œä¸ºå­ç»„ä»¶Sonçš„propsä¼ å‚ã€‚
    3. ç‚¹å‡»çˆ¶ç»„ä»¶æŒ‰é’®å˜æ›´stateï¼Œé‚£ä¹ˆå­ç»„ä»¶çš„propså°±å˜æ›´äº†
4. åˆ›å»ºçˆ¶å­ç»„ä»¶TestReceiveProps.jsx
    
    ```
    import React from 'react'

    // çˆ¶ç»„ä»¶
    export default class Parent extends React.Component {
        constructor(props) {
            super(props)
            this.state = {
                msg: 'è¿™æ˜¯çˆ¶ç»„ä»¶ä¸­çš„ msg æ¶ˆæ¯'
            }
        }
    
        render() {
            return <div>
                <h1>è¿™æ˜¯çˆ¶ç»„ä»¶</h1>
                <input type="button" value="ç‚¹å‡»ä¿®æ”¹çˆ¶ç»„ä»¶çš„ MSG" onClick={this.changeMsg} />
                <hr />
                <Son pmsg={this.state.msg}></Son>
            </div>
        }
    
        changeMsg = () => {
            this.setState({
                msg: 'å¨ƒå“ˆå“ˆ'
            })
        }
    }
    
    // å­ç»„ä»¶
    class Son extends React.Component {
        constructor(props) {
            super(props)
            this.state = {}
        }
    
    render() {
        return <div>
            <h3>è¿™æ˜¯å­ç»„ä»¶ --- {this.props.pmsg}</h3>
            </div>
        }
    
        // ç»„ä»¶å°†è¦æ¥æ”¶å¤–ç•Œä¼ é€’è¿‡æ¥çš„æ–°çš„ props å±æ€§å€¼
        // å½“å­ç»„ä»¶ç¬¬ä¸€æ¬¡è¢«æ¸²æŸ“åˆ°é¡µé¢ä¸Šçš„æ—¶å€™ï¼Œä¸ä¼šè§¦å‘è¿™ä¸ª å‡½æ•°ï¼›
        // åªæœ‰å½“ çˆ¶ç»„ä»¶ä¸­ï¼Œé€šè¿‡ æŸäº› äº‹ä»¶ï¼Œé‡æ–°ä¿®æ”¹äº† ä¼ é€’ç»™ å­ç»„ä»¶çš„ props æ•°æ®ä¹‹åï¼Œæ‰ä¼šè§¦å‘ componentWillReceiveProps
        componentWillReceiveProps(nextProps) {
            // console.log('è¢«è§¦å‘äº†ï¼');
            // æ³¨æ„ï¼š åœ¨ componentWillReceiveProps è¢«è§¦å‘çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ this.props æ¥è·å–å±æ€§å€¼ï¼Œè¿™ä¸ªå±æ€§å€¼ï¼Œä¸æ˜¯æœ€æ–°çš„ï¼Œæ˜¯ä¸Šä¸€æ¬¡çš„æ—§å±æ€§å€¼
            // å¦‚æœæƒ³è¦è·å–æœ€æ–°çš„å±æ€§å€¼ï¼Œéœ€è¦é€šè¿‡ componentWillReceiveProps çš„å‚æ•°åˆ—è¡¨æ¥è·å–
            console.log(this.props.pmsg + ' ---- ' + nextProps.pmsg);
        }
    }
    ```
5. main.jså¯¼å…¥
    
    ```
    import Test from './components/TestReceiveProps.jsx'
    
    //renderä¸­æ¸²æŸ“
    ReactDOM.render(<div>
    <Test></Test> 
    </div>, document.getElementById('app'))
    ```

## ç»‘å®šthiså¹¶ä¼ å‚çš„ä¸‰ç§æ–¹å¼
1. å¦‚æœrenderä¸­çš„æ ‡ç­¾ç‚¹å‡»äº‹ä»¶ç»‘å®šçš„æ˜¯æ™®é€šå‡½æ•°ï¼Œé‚£ä¹ˆæ™®é€šå‡½æ•°ä¸­çš„thisæŒ‡å‘æ˜¯undefind.
2. è§£å†³æ–¹æ¡ˆï¼š
    1. ä½¿ç”¨bind
    2. ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼šæŠŠå½“å‰å‡½æ•°å˜æˆç®­å¤´å‡½æ•°
    3. ä½¿ç”¨call/apply

### æ–¹å¼ä¸€ï¼šbindç»‘å®šä¼ é€’
1. bind çš„ä½œç”¨ï¼šä¿®æ”¹å‡½æ•°å†…éƒ¨çš„thisæŒ‡å‘ï¼Œè®©å‡½æ•°å†…éƒ¨çš„thisï¼ŒæŒ‡å‘bind å‚æ•°åˆ—è¡¨ä¸­çš„ ç¬¬ä¸€ä¸ªå‚æ•°
2. bind å’Œ call/apply ä¹‹é—´çš„åŒºåˆ«ï¼šcall/apply ä¿®æ”¹å®ŒthisæŒ‡å‘åï¼Œä¼šç«‹å³è°ƒç”¨å‰é¢çš„å‡½æ•°ï¼Œä½†æ˜¯ bind åªæ˜¯ä¿®æ”¹thisæŒ‡å‘ï¼Œå¹¶ä¸ä¼šè°ƒç”¨ã€‚
3. **æ³¨æ„ï¼š** bind ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯ç”¨æ¥ä¿®æ”¹ this æŒ‡å‘çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°åé¢çš„æ‰€æœ‰å‚æ•°ï¼Œéƒ½ä¼šå½“ä½œå°†æ¥è°ƒç”¨ å‰é¢å‡½æ•° æ—¶å€™çš„å‚æ•°ä¼ é€’è¿›å»
4. åˆ›å»ºBindThis.jsxç»„ä»¶
    
    ```
    import React from 'react'
    export default class BindThis extends React.Component {
      constructor(props) {
        super(props)
        this.state = {
          msg: 'è¿™æ˜¯é»˜è®¤çš„msg'
        }
      }
      //renderä¸­çš„æ ‡ç­¾ç‚¹å‡»äº‹ä»¶ç»‘å®šçš„æ˜¯æ™®é€šå‡½æ•°
      render() {
        return <div>
          <h1>ç»‘å®šThiså¹¶ä¼ å‚çš„å‡ ç§æ–¹å¼</h1>
          {/* æ–¹å¼1ï¼šåœ¨ äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œç›´æ¥ä½¿ç”¨ bind ç»‘å®š this å¹¶ä¼ å‚ */}
          <input type="button" value="ç»‘å®šthiså¹¶ä¼ å‚çš„æ–¹å¼1" onClick={this.changeMsg1.bind(this, 'ğŸ·', 'ğŸ•')} />
          <hr />
          <h3>{this.state.msg}</h3>
        </div>
      }
    
      /**
      * æ™®é€šå®ä¾‹å‡½æ•°
      * æ³¨æ„ï¼šè¿™é‡Œçš„æ–¹å¼ï¼Œæ˜¯ä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œå› æ­¤ï¼Œåœ¨è§¦å‘çš„æ—¶å€™ï¼Œè¿™é‡Œçš„ this æ˜¯ undefined
       */
      changeMsg1(arg1, arg2,event) {
        //event,é»˜è®¤ä¼ é€’
        // console.log(this);
        this.setState({
          msg: 'ç»‘å®šthiså¹¶ä¼ å‚çš„æ–¹å¼1' + arg1 + arg2
        })
      }
    }
    ```
2. main.jså¯¼å…¥
    
    ```
    import BindThis from './components/BindThis.jsx'
    //renderä¸­æ¸²æŸ“
    ReactDOM.render(<div>
    <BindThis></BindThis>
    </div>, document.getElementById('app'))
    ```

### æ–¹å¼äºŒï¼šåœ¨æ„é€ å‡½æ•°ä¸­bindç»‘å®šå¹¶ä¼ å‚
1. **å½“ä¸€ä¸ªå‡½æ•°ï¼Œè°ƒç”¨ bind æ”¹å˜äº†thisæŒ‡å‘åï¼Œbind å‡½æ•°è°ƒç”¨çš„ç»“æœè¿”å›å€¼ï¼Œå°±æ˜¯è¢«æ”¹å˜thisæŒ‡å‘åçš„å‡½æ•°çš„å¼•ç”¨ï¼›**
2. å®ç°æ™®é€šå‡½æ•°changeMsg2
    
    ```
    changeMsg2(arg1, arg2) {
        // console.log(this);
        this.setState({
          msg: 'ç»‘å®šthiså¹¶ä¼ å‚çš„æ–¹å¼2' + arg1 + arg2
        })
      }
    ```
3. renderä¸­ç‚¹å‡»ç¬¬äºŒä¸ªæŒ‰é’®
    
    ```
    <input type="button" value="ç»‘å®šthiså¹¶ä¼ å‚çš„æ–¹å¼2" onClick={this.changeMsg2} />
    ```
4. constructorç»‘å®šthiså¹¶ä¼ å‚
    
    ```
    constructor(props) {
        super(props)
        this.state = {
          msg: 'è¿™æ˜¯é»˜è®¤çš„msg'
        }
        
        // ç»‘å®š this å¹¶ä¼ å‚çš„æ–¹å¼2: åœ¨æ„é€ å‡½æ•°ä¸­ç»‘å®šå¹¶ä¼ å‚
        // æ³¨æ„ï¼Œå½“ä¸€ä¸ªå‡½æ•°ï¼Œè°ƒç”¨ bind æ”¹å˜äº†thisæŒ‡å‘åï¼Œbind å‡½æ•°è°ƒç”¨çš„ç»“æœè¿”å›å€¼ï¼Œå°±æ˜¯è¢«æ”¹å˜thisæŒ‡å‘åçš„å‡½æ•°çš„å¼•ç”¨ï¼›
        // æ³¨æ„ï¼š bind ä¸ä¼šä¿®æ”¹ åŸå‡½æ•°çš„ this æŒ‡å‘
        this.changeMsg2 = this.changeMsg2.bind(this, 'ğŸš—', 'ğŸ‘«')
    }
    ```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨ç®­å¤´å‡½æ•°ç»‘å®šthiså¹¶ä¼ å‚
1. å®ç°ç®­å¤´å‡½æ•°changeMsg3
    
    ```
    changeMsg3 = (event,arg1, arg2) => {
        // console.log(this);
        this.setState({
          msg: 'ç»‘å®šthiså¹¶ä¼ å‚çš„æ–¹å¼3' + arg1 + arg2
        })
    }
    ```
2. renderä¸­ç‚¹å‡»ç¬¬ä¸‰ä¸ªæŒ‰é’®

    ```
    <input type="button" value="ç»‘å®šthiså¹¶ä¼ å‚çš„æ–¹å¼3" onClick={(event) => { this.changeMsg3(event,'ğŸ˜Š', 'ğŸ˜˜') }} />
    ```

## ç»‘å®šæ–‡æœ¬æ¡†ä¸stateä¸­çš„å€¼
1. æ•ˆæœï¼Ÿä¸€ä¸ªæ–‡æœ¬æ¡†è¾“å…¥ä¹‹åï¼Œå°†è¾“å…¥å†…å®¹ä¼ é€’ç»™stateå¹¶é¡µé¢å³æ—¶æ›´æ–°
2. åˆ›å»ºrenderä¸­æ·»åŠ input
    
    ```
    {/* åœ¨ Vue ä¸­ï¼Œæœ‰ v-model æŒ‡ä»¤æ¥å®ç°åŒå‘æ•°æ®ç»‘å®šï¼Œä½†æ˜¯ï¼Œåœ¨ React ä¸­ï¼Œ æ ¹æœ¬æ²¡æœ‰æŒ‡ä»¤çš„æ¦‚å¿µï¼Œå› æ­¤React é»˜è®¤ä¹Ÿä¸æ”¯æŒ åŒå‘æ•°æ®ç»‘å®š */}
    {/* React åªæ”¯æŒï¼ŒæŠŠæ•°æ®ä» state ä¸Šä¼ è¾“åˆ° é¡µé¢ï¼Œä½†æ˜¯ï¼Œæ— æ³•è‡ªåŠ¨å®ç°æ•°æ®ä» é¡µé¢ ä¼ è¾“åˆ° state ä¸­ è¿›è¡Œä¿å­˜ï¼Œä¹Ÿå°±æ˜¯ï¼ŒReact ä¸æ”¯æŒæ•°æ®çš„è‡ªåŠ¨é€†å‘ä¼ è¾“ï¼Œ åªæ˜¯å®ç°äº†æ•°æ®çš„å•å‘ç»‘å®š */}
    {/* æ³¨æ„ï¼šå¦‚æœä¸º è¡¨å•å…ƒç´ ï¼Œæä¾›äº† value å±æ€§ç»‘å®šï¼Œé‚£ä¹ˆï¼Œå¿…é¡»åŒæ—¶ä¸º è¡¨å•å…ƒç´  ç»‘å®š readOnly, æˆ–è€…æä¾›è¦ç»™ onChange äº‹ä»¶ */}
    {/* å¦‚æœæä¾›äº†readOnlyï¼Œè¡¨ç¤ºè¿™ä¸ªå…ƒç´ åªè¯»çš„ä¸èƒ½è¢«ä¿®æ”¹  */}
    {/* å¦‚æœæä¾›äº†onChange è¡¨ç¤ºï¼Œè¿™ä¸ªå…ƒç´ çš„å€¼å¯ä»¥è¢«ä¿®æ”¹ï¼Œä½†æ˜¯ï¼Œè¦è‡ªå·±å®šä¹‰ä¿®æ”¹çš„é€»è¾‘  */}
    <input type="text" style={{ width: '100%' }} value={this.state.msg} onChange={this.txtChanged} ref="txt" />
    ```
3. å®ç°this.txtChanged
    
    ```
    // ä¸º æ–‡æœ¬æ¡† ç»‘å®š txtChanged äº‹ä»¶
    txtChanged = (e) => {
        // console.log('ok');
        // å¦‚æœæƒ³è®© æ–‡æœ¬æ¡†åœ¨è§¦å‘ onChange çš„æ—¶å€™ï¼ŒåŒæ—¶æŠŠæ–‡æœ¬æ¡†æœ€æ–°çš„å€¼ï¼Œä¿å­˜åˆ° state ä¸­ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è°ƒç”¨ this.setState
        // è·å–æ–‡æœ¬æ¡†ä¸­ æœ€æ–°æ–‡æœ¬çš„3ç§æ–¹å¼ï¼š
        //  1. ä½¿ç”¨ document.getElementById æ¥æ‹¿
        //  2. ä½¿ç”¨ ref æ¥æ‹¿
        // console.log(this.refs.txt.value);
        //  3. ä½¿ç”¨ äº‹ä»¶å¯¹è±¡çš„ å‚æ•° e æ¥æ‹¿   e.target å°±è¡¨ç¤ºè§¦å‘ è¿™ä¸ªäº‹ä»¶çš„ äº‹ä»¶æºå¯¹è±¡ï¼Œå¾—åˆ°çš„æ˜¯ä¸€ä¸ªåŸç”Ÿçš„JS DOM å¯¹è±¡
        // console.log(e.target.value);
        this.setState({
            msg: e.target.value
        })
    }
    ```
    


## è¯„è®ºåˆ—è¡¨æ¡ˆä¾‹
![pic](https://gitee.com/zhonghua123/blogimgs/raw/master/img/webzh_60.png/)
    
1. åˆ›å»ºè¯„è®ºåˆ—è¡¨ç»„ä»¶CmtList.jsx
    
    ```
    import React from 'react'
    import CMTItem from './CmtItem.jsx'
    import CMTBox from './CmtBox.jsx'
    
    // è¯„è®ºåˆ—è¡¨ç»„ä»¶
    export default class CMTList extends React.Component {
      constructor(props) {
        super(props)
        this.state = {
          list: [
            { user: 'zs', content: '123' },
            { user: 'ls', content: 'qqq' },
            { user: 'xiaohong', content: 'www' }
          ]
        }
      }
    
      // åœ¨ç»„ä»¶å°šæœªæ¸²æŸ“çš„æ—¶å€™ï¼Œå°±ç«‹å³ è·å–æ•°æ®
      componentWillMount() {
        this.loadCmts()
      }
    
      render() {
        return <div>
          <h1>è¿™æ˜¯è¯„è®ºåˆ—è¡¨ç»„ä»¶</h1>
    
          {/* å‘è¡¨è¯„è®ºçš„ç»„ä»¶ */}
          {/* react ä¸­ï¼Œåªè¦æ˜¯ä¼ é€’ç»™ å­ç»„ä»¶çš„æ•°æ®ï¼Œä¸ç®¡æ˜¯ æ™®é€šçš„ç±»å‹ï¼Œè¿˜æ˜¯æ–¹æ³•ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ this.props æ¥è°ƒç”¨ */}
          <CMTBox reload={this.loadCmts}></CMTBox>
    
          <hr />
    
    
          {/* å¾ªç¯æ¸²æŸ“ä¸€äº›è¯„è®ºå†…å®¹ç»„ä»¶ */}
          {this.state.list.map((item, i) => {
            return <CMTItem key={i} {...item}></CMTItem>
          })}
        </div>
      }
    
      // ä»æœ¬åœ°å­˜å‚¨ä¸­åŠ è½½ è¯„è®ºåˆ—è¡¨
      loadCmts = () => {
        var list = JSON.parse(localStorage.getItem('cmts') || '[]')
        this.setState({
          list
        })
      }
    }
    ```
2. åˆ›å»ºè¯„è®ºitemç»„ä»¶CmtItem.jsx
    
    ```
    import React from 'react'
    // è¯„è®ºåˆ—è¡¨é¡¹ç»„ä»¶
    export default class CMTItem extends React.Component {
    
      render() {
        return <div style={{ border: '1px solid #ccc', margin: '10px 0' }}>
          <h3>è¯„è®ºäººï¼š{this.props.user}</h3>
          <h5>è¯„è®ºå†…å®¹ï¼š{this.props.content}</h5>
        </div>
      }
    }
    ```
3. åˆ›å»ºè¯„è®ºç»„ä»¶CmtBox.jsx
    
    ```
    import React from 'react'

    // è¯„è®ºåˆ—è¡¨æ¡†ç»„ä»¶
    export default class CMTBox extends React.Component {
    
      render() {
        return <div>
          <label>è¯„è®ºäººï¼š</label><br />
          <input type="text" ref="user" /><br />
          <label>è¯„è®ºå†…å®¹ï¼š</label><br />
          <textarea cols="30" rows="4" ref="content"></textarea><br />
    
          <input type="button" value="å‘è¡¨è¯„è®º" onClick={this.postComment} />
        </div>
      }
    
      postComment = () => {
        // 1. è·å–åˆ°è¯„è®ºäººå’Œè¯„è®ºå†…å®¹
        // 2. ä» æœ¬åœ°å­˜å‚¨ä¸­ï¼Œå…ˆè·å–ä¹‹å‰çš„è¯„è®ºæ•°ç»„
        // 3. æŠŠ æœ€æ–°çš„è¿™æ¡è¯„è®ºï¼Œunshift è¿›å»
        // 4. åœ¨æŠŠæœ€æ–°çš„è¯„è®ºæ•°ç»„ï¼Œä¿å­˜åˆ° æœ¬åœ°å­˜å‚¨ä¸­
        var cmtInfo = { user: this.refs.user.value, content: this.refs.content.value }
        var list = JSON.parse(localStorage.getItem('cmts') || '[]')
        list.unshift(cmtInfo)
        localStorage.setItem('cmts', JSON.stringify(list))
    
        this.refs.user.value = this.refs.content.value = ''
    
        this.props.reload()
      }
    }
    ```
4. main.jsä¸­å¼•ç”¨
    
    ```
    import React from 'react'
    import ReactDOM from 'react-dom'
    import CmtList from './components/Comment/CmtList.jsx'
    // ä½¿ç”¨ render å‡½æ•°æ¸²æŸ“ è™šæ‹ŸDOM
    ReactDOM.render(<div>
      <BindThis></BindThis>
    </div>, document.getElementById('app'))
    ```
        
## contextç‰¹æ€§
1. å¦‚æœä¸€ä¸ªç»„ä»¶1åµŒå¥—ç»„ä»¶2åµŒå¥—ç»„ä»¶3ï¼Œç»„ä»¶1ä¸ºçˆ¶ç»„ä»¶ï¼Œ2ä¸ºå­ç»„ä»¶ï¼Œ3ä¸ºå­™ç»„ä»¶ã€‚
2. å¦‚æœç»„ä»¶1è¦ç»™ç»„ä»¶3ä¼ é€’æ•°æ®ï¼Œé€šå¸¸çš„æ–¹æ³•æ˜¯é€šè¿‡propså±æ€§å±‚å±‚ä¼ é€’
    
    ```
    export default class Com1 extends React.Component {
  constructor(props) {
        super(props)
    
        this.state = {
          color: 'red'
        }
      }
    
      render() {
        return <div>
          <h1>è¿™æ˜¯ çˆ¶ç»„ä»¶ </h1>
          <Com2 color={this.state.color}></Com2>
        </div>
      }
    }
    // ä¸­é—´çš„å­ç»„ä»¶
    class Com2 extends React.Component {
      render() {
        return <div>
          <h3>è¿™æ˜¯ å­ç»„ä»¶ </h3>
          <Com3 color={this.props.color}></Com3>
        </div>
      }
    }
    
    // å†…éƒ¨çš„å­™å­ç»„ä»¶
    class Com3 extends React.Component {
      render() {
        return <div>
          <h5 style={{ color: this.props.color }}>è¿™æ˜¯ å­™å­ç»„ä»¶ </h5>
        </div>
      }
    } 
    ```
3. é€šè¿‡contextç›´æ¥ä¼ é€’
    
    ```
    // æœ€å¤–å±‚çš„çˆ¶ç»„ä»¶
    export default class Com1 extends React.Component {
      constructor(props) {
        super(props)
        this.state = {
          color: 'red'
        }
      }
    
      //   getChildContextTypes
      // 1. åœ¨ çˆ¶ç»„ä»¶ä¸­ï¼Œå®šä¹‰ä¸€ä¸ª functionï¼Œè¿™ä¸ªfunction æœ‰ä¸ªå›ºå®šçš„åç§°ï¼Œå«åš getChildContext ï¼Œå†…éƒ¨ï¼Œå¿…é¡» è¿”å›ä¸€ä¸ª å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ï¼Œå°±æ˜¯è¦å…±äº«ç»™ æ‰€æœ‰å­å­™è‡ªå»ºçš„  æ•°æ®
      getChildContext() {
        return {
          color: this.state.color
        }
      }
    
      // 2. ä½¿ç”¨ å±æ€§æ ¡éªŒï¼Œè§„å®šä¸€ä¸‹ä¼ é€’ç»™å­ç»„ä»¶çš„ æ•°æ®ç±»å‹ï¼Œ éœ€è¦å®šä¹‰ ä¸€ä¸ª é™æ€çš„ï¼ˆstaticï¼‰ childContextTypesï¼ˆå›ºå®šåç§°ï¼Œä¸è¦æ”¹ï¼‰
      static childContextTypes = {
        color: ReactTypes.string // è§„å®šäº† ä¼ é€’ç»™å­ç»„ä»¶çš„ æ•°æ®ç±»å‹
      }
      render() {
        return <div>
          <h1>è¿™æ˜¯ çˆ¶ç»„ä»¶ </h1>
          <Com2></Com2>
        </div>
      }
    }
    // ä¸­é—´çš„å­ç»„ä»¶
    class Com2 extends React.Component {
      render() {
        return <div>
          <h3>è¿™æ˜¯ å­ç»„ä»¶ </h3>
          <Com3></Com3>
        </div>
      }
    }

    // å†…éƒ¨çš„å­™å­ç»„ä»¶
    class Com3 extends React.Component {
    
      // 3. ä¸Šæ¥ä¹‹åï¼Œå…ˆæ¥ä¸ªå±æ€§æ ¡éªŒï¼Œå»æ ¡éªŒä¸€ä¸‹çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ å‚æ•°ç±»å‹
      static contextTypes = {
        color: ReactTypes.string // è¿™é‡Œï¼Œå¦‚æœå­ç»„ä»¶ï¼Œæƒ³è¦ä½¿ç”¨ çˆ¶ç»„ä»¶é€šè¿‡ context å…±äº«çš„æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨ä¹‹å‰ï¼Œä¸€å®šè¦å…ˆ åšä¸€ä¸‹æ•°æ®ç±»å‹æ ¡éªŒ
      }
    
      render() {
        return <div>
          <h5 style={{ color: this.context.color }}>è¿™æ˜¯ å­™å­ç»„ä»¶  ---  {this.context.color} </h5>
        </div>
      }
    }
    ```

