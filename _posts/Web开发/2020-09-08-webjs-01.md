---
layout: post
title: 模板引擎artTemplate
category: Web开发
tags: Web开发
description: Web开发
--- 

### 模板引擎的基础概念
1. 模板引擎
    1. 模板引擎不是Node.js本身提供的，它是Node.js的第三方模块
    2. 让开发者以更加友好的方式拼接字符串，使项目代码更加清晰、更加易于维护。
2. art-template模板引擎
    1. 该模板引擎由腾讯公司出品，目前市场运行最快的模板引擎
    2. 在命令行工具中使用`npm install art-template`命令进行下载
    3. 使用`const template = require('art-template')`引入模板引擎
    4. **渲染模板：**告诉模板引擎要拼接的数据和模板在哪 `const html = template(‘模板路径’, 数据);`
    5. 使用模板语法告诉模板引擎，模板与数据应该如何进行拼接
    6. 通常在项目中新建一个views文件夹，用于存储所有的模板，模板的代码放在`.art`文件中
3. art-template代码示例
    1. 模板引擎处理部分app.js文件
        
        ```
        // 导入模板引擎模块
        const template = require('art-template');
        // 将特定模板与特定数据进行拼接
        const html = template('./views/index.art',{
            data: { 
                name: '张三', 
                age: 20 
            } 
        });
        ```
    2. 模板部分index.art文件
        
        ```
        <div> 
            <span>{{data.name}}</span> 
            <span>{{data.age}}</span> 
        </div>
        ```
    

### 模板引擎的语法
1. 模板语法
    1. art-template同时支持两种模板语法：**标准语法和原始语法**。
    2. 标准语法可以让模板更容易读写，原始语法具有强大的逻辑处理能力。
        1. 标准语法： `{{ 数据 }}`
        2. 原始语法：`<%=数据 %>`
2. 输出
    1. 将某项数据输出在模板中，标准语法和原始语法如下：
        1. 标准语法：`{{ 数据 }}`
        2. 原始语法：`<%=数据 %>`
    2. 代码举例：
        
        ```
        <!-- 标准语法 --> 
        <h2>{{value}}</h2> 
        <h2>{{a ? b : c}}</h2> 
        <h2>{{a + b}}</h2>

        <!-- 原始语法 --> 
        <h2><%= value %></h2> 
        <h2><%= a ? b : c %></h2
        <h2><%= a + b %></h2>
        ```
3. 原文输出
    1. 如果数据中携带HTML标签，默认模板引擎不会解析标签，会将其转义后输出。
        1. 标准语法：`{{@ 数据 }}`
        2. 原始语法：`<%-数据 %>`
    2. 代码举例：
        
        ```
        <!-- 标准语法 --> 
        <h2>{{@ value }}</h2>

        <!-- 原始语法 --> 
        <h2><%- value %></h2>
        ```
4. 条件判断
    
    ```
    <!-- 标准语法 -->
    {{if 条件}} ... {{/if}} 
    {{if v1}} ... {{else if v2}} ... {{/if}} 
    <!-- 原始语法 --> 
    <% if (value) { %> ... <% } %> 
    <% if (v1) { %> ... <% } else if (v2) { %> ... <% } %>
    ```
    
5. 循环
    1. 标准语法：`{{each 数据}} {{/each}}`
    2. 原始语法：`<% for() { %> <% } %>`
    
    ```
    <!-- 标准语法 -->
    {{each target}} 
        {{$index}} {{$value}} 
    {{/each}} 
    <!-- 原始语法 --> 
    <% for(var i = 0; i < target.length; i++){ %>
        <%= i %> <%= target[i] %>
    <% } %>
    ```
6. 子模版
    1. 使用子模板可以将网站公共区块(头部、底部)抽离到单独的文件中。
        1. 标准语法：`{{include '模板'}}`
        2. 原始语法：`<%include('模板') %>`
    
        ```
        <!-- 标准语法 --> 
        {{include './header.art'}} 
        <!-- 原始语法 --> 
        <% include('./header.art') %>
        ```
    2. 代码举例：
        
        ```
        {{ include './common/header.art' }}
        <% include('./common/header.art') %>
        <div> {{ msg }} </div>
        {{ include './common/footer.art' }}
        <% include('./common/footer.art') %>
        ```
7. 模板继承
    1. 以上讲过可以将网站页面中的公共部分抽取到子模板中
    2. html骨架（html、head、body标签）也属于每个页面的公共部分，但是这部分不能抽取到子模板中
    3. 使用模板继承可以将网站HTML骨架抽离到单独的文件中，其他页面模板可以继承骨架文件。
    4. 骨架文件中是可以设置一些坑位的，比如title、css、js等坑位，用于继承者填充
    5. 模板继承示例
        1. layout.art骨架模板
            
            ```
            <!doctype html> 
            <html> 
                <head>
                    <meta charset="utf-8">
                    <title>HTML骨架模板</title> 
                    <!--设置坑位-->
                    {{block 'head'}}{{/block}} 
                </head> 
                <body> 
                    <!--设置坑位-->
                    {{block 'content'}}{{/block}} 
                </body> 
            </html>
            ```
        2. index.art继承模板
            
            ```
            <!--index.art 首页模板--> 
            <!--继承./layout.art-->
            {{extend './layout.art'}}
            <!--填坑-->
            {{block 'head'}} <link rel="stylesheet" href="custom.css"> {{/block}}
            {{block 'content'}} <p>This is just an awesome page.</p> {{/block}}
            ```
        3. app.js中引用index.art模板
8. 模板配置
    1. 向模板中导入变量 `template.defaults.imports.变量名 = 变量值;`
        1. 可以在模板文件中直接调用外面的方法函数
    2. 设置模板根目录 `template.defaults.root = 模板目录`
        3. 渲染模板时就不需要再传入路径了，直接传入模板文件名称即可：`template('文件名.后缀名', {})`
    3. 设置模板默认后缀 `template.defaults.extname = '.art'`
        1. 渲染模板时传入的文件名称可以不带后缀名了：`template('文件名', {})`
    4. 代码举例：
        1. app.js文件
            
            ```
            const template = require('art-template');
            const path = require('path');
            // 时间格式化第三方模块，在npmjs这个网站上，可以通过npm install dateformat下载
            const dateFormat = require('dateformat');
            
            // 1. 设置模板的根目录，那么渲染模板时就自动到这个模板下找对应的模板文件
            template.defaults.root = path.join(__dirname, 'views');
            
            // 2. 导入模板变量，将这个时间格式化第三方模块导入到模板中，在模板中使用
            template.defaults.imports.dateFormat = dateFormat;
            
            // 3. 配置模板的默认后缀
            // template.defaults.extname = '.art';
            // 模板也可以卸载html文件中，那么下面没有后缀名的模板，就会寻找后缀名为.html的模板了
            template.defaults.extname = '.html';
            
            // 4. 渲染模板
            // 因为上面设置了模板根目录，所以这里直接写要渲染的模板名称即可，不用再写路径了
            const html = template('06.art', {
            	time: new Date()
            });
            
            // 4. 渲染模板
            // 因为上面设置了模板后缀名，所以这里不需要加后缀名了，这里寻找到的是07.html的模板文件
            console.log(template('07', {}));
            console.log(html);
            ```
        2. 06.art模板
            
            ```
            <!--模板文件中使用外部导入的对象的函数功能-->
            {{ dateFormat(time, 'yyyy-mm-dd')}}
            ```
                 
#### 模板使用总结
1. js文件中
    1. 下载模板组件
    2. 导入模板组件
    3. 渲染模板
2. art文件
    1. 编写模板内容

### 案例
1. 案例介绍 – 学生档案管理，效果图如下：
    ![pic](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/webjs-16.png)
    
    1. 目标： 模板引擎应用，强化node.js项目制作流程。
    2. 知识点：http请求响应、数据库、模板引擎、静态资源访问。

####  服务端制作流程
1. 建立项目文件夹并生成项目描述文件
2. 创建网站服务器实现客户端和服务器端通信
3. 连接数据库并根据需求设计学员信息表
4. 创建路由并实现页面模板呈递
5. 实现静态资源访问
6. 实现学生信息添加功能
7. 实现学生信息展示功能

##### 第三方模块 router
1. 功能：实现路由
2. 使用步骤：
    1. 获取路由对象
    2. 调用路由对象提供的方法创建路由
    3. 启用路由，使路由生效
    
    ```
    const getRouter = require('router') 
    const router = getRouter();
    router.get('/add', (req, res) => {
        res.end('Hello World!')
    })
    server.on('request', (req, res) => {
        router(req, res)
    })
    ```

##### 第三方模块 serve-static
1. 功能：实现静态资源访问服务
2. 步骤：
    1. 引入serve-static模块获取创建静态资源服务功能的方法
    2. 调用方法创建静态资源服务并指定静态资源服务目录
    3. 启用静态资源服务功能
    
    ```
    const serveStatic = require('serve-static') 
    const serve = serveStatic('public')
    server.on('request', () => {
        serve(req, res)
    }) 
    server.listen(3000)
    ```

#### 添加学生信息功能步骤分析
1. 在模板的表单中指定请求地址与请求方式
2. 为每一个表单项添加name属性
3. 添加实现学生信息功能路由
4. 接收客户端传递过来的学生信息
5. 将学生信息添加到数据库中
6. 将页面重定向到学生信息列表页面

#### 学生信息列表页面分析
1. 从数据库中将所有的学生信息查询出来
2. 通过模板引擎将学生信息和HTML模板进行拼接
3. 将拼接好的HTML模板响应给客户端


