---
layout: post
title: node基础
category: Web开发
tags: Web开发
description: Web开发
--- 

### Node简介
1. Node是什么
    1. **Node是**一个基于Chrome V8引擎的JavaScript**代码运行环境**。
    2. node就是一个软件，能够运行js代码的软件
2. 运行环境
    1. 浏览器(软件)能够运行JavaScript代码，浏览器就是JavaScript代码的运行环境
    2. Node(软件)能够运行JavaScript代码，Node就是JavaScript代码的运行环境
    3. 运行环境指的就是一个软件，一个软件能够运行某种语言，那么这个软件就是这个语言的运行环境
3. Chrome V8引擎
    1. 是谷歌公司创造的一款js代码执行引擎，作用就是用来执行js代码
    2. 之所以node软件能够运行js就是因为node内部包含了这个V8引擎
4. Node.js运行环境安装
    1. 官网:[https://nodejs.org/en/](https://nodejs.org/en/)
    2. `LTS = Long Term Support` 长期支持版 稳定版
    3. `Current` 拥有最新特性 实验版
5. Node.js快速入门
    1. JavaScript 由三部分组成，ECMAScript，DOM，BOM。
    2. Node.js是**由ECMAScript及Node 环境提供的一些附加API组成的，包括文件、网络、路径等等一些更加强大的 API**。
        1. ECMAScript
        2. Node环境API
    3.  Node.js基础语法
        1. 所有ECMAScript语法在Node环境中都可以使用。
        2. 在Node环境下执行代码，使用Node命令执行后缀为.js的文件即可
            
            ```
            //test.js代码
            var first = 'hello nodejs';
            console.log(first);
            //2. 执行命令
            node /Users/mac/Desktop/test.js 
            //3. 输出
            hello nodejs
            ```
    4. Node.js全局对象global
        1. 在浏览器中全局对象是window，在Node中全局对象是global。
        2. Node中全局对象下有以下方法，可以在任何地方使用，global可以省略。
            
            ```
            console.log() 在控制台中输出
            setTimeout() 设置超时定时器
            clearTimeout() 清除超时时定时器
            setInterval() 设置间歇定时器
            clearInterval() 清除间歇定时器
            ```

### 模块加载及第三方包

#### Node.js模块化开发
1. JavaScript开发弊端
    1. JavaScript在使用时存在两大问题，**文件依赖和命名冲突。**
    2. 文件引入有前后顺序，文件之前依赖文件引入的前后顺序
    3. js文件之间各自的变量可以相互访问，导致冲突，替换
2. 软件中的模块化开发
    1. 一个功能就是一个模块，多个模块可以组成完整应用，抽离一个模块不会影响其他功能的运行。
    2. 文件与文件之间是半封闭状态，可以设置每个文件中哪些内容被别的文件访问到，不设置的不允许别其他文件访问
3. Node.js中模块化开发规范
    1. Node.js规定一个**JavaScript**文件就是一个模块，模块**内部定义的变量和函数**默认情况下在**外部无法得到**
    2. 模块内部可以使用**exports对象进行成员导出**，使用**require方法**导入其他模块。
    3. 模块成员导出
        
        ```
        // a.js
        // 在模块内部定义变量 
        let version = 1.0;
        // 在模块内部定义方法
        const sayHi = name => `您好, ${name}`; 
        // 向模块外部导出数据
        //相当于给exports对象设置属性
        exports.version = version; 
        exports.sayHi = sayHi;
        ```
    4. 模块成员的导入
        
        ```
        // b.js
        // 在b.js模块中导入模块a
        //require返回的就是exports对象
        let a = require('./a.js');
        // 输出b模块中的version变量 
        console.log(a.version);
        // 调用b模块中的sayHi方法 并输出其返回值 
        console.log(a.sayHi('rose'));
        ```
        
        1. **导入模块时后缀可以省略**:`let a = require('./a');`
    5. 模块成员导出的另一种方式
        
        ```
        module.exports.version = version;
        module.exports.sayHi = sayHi;
        ```
        
        1. **exports是module.exports的别名(地址引用关系)，导出对象最终以module.exports为准**
    6. 模块导出两种方式的联系与区别
        1. 如果没有修改都指向同一个地址，则二者相等，
        2. 如果module.exports指向修改，则以module.exports的指向为准
            
            ```
            exports.version = version;
            module.exports.version = version;
            //修改
            module.exports.version ={name:'张三'}
            ```

#### 系统模块
1. 什么是系统模块
    1. Node运行环境提供的API. 因为这些API都是以模块化的方式进行开发的, 所以我们又称**Node运行环境提供的API为系统模块**
2. 系统模块fs 文件操作
    1. f：file 文件 ，s：system 系统，文件操作系统。
    2. 导入模块
        
        ```
        const fs = require('fs');
        ```
    3. 读取文件内容
        
        ```
        fs.reaFile('文件路径/文件名称'[,'文件编码'], callback);
        ```
    4. 写入文件内容
        1. 监控错误日志，写入到文件中，便于查看
        
        ```
        fs.writeFile('文件路径/文件名称', '数据', callback);
        ```
    5. 代码举例：
        
        ```
        const content = '<h3>正在使用fs.writeFile写入文件内容</h3>';
        fs.writeFile('../index.html', content, err => { 
            if (err != null) {
                console.log(err); return;
            }
        console.log('文件写入成功'); 
        });
        ```
3. 系统模块path 路径操作
    1. 为什么要进行路径拼接
        1. 不同操作系统的路径分隔符不统一
        2. `/public/uploads/avatar`
        3. Windows 上是 `\ /`（正反斜杠都可以）
        4. Linux 上是 `/`
    2. 路径拼接语法
        1. `path.join('路径', '路径', ...)`
            
            ```
            // 导入path模块
            const path = require('path');
            // 路径拼接
            let finialPath = path.join('itcast', 'a', 'b', 'c.css');
            // 输出结果 itcast\a\b\c.css
            console.log(finialPath);
            ```
    3. 相对路径VS绝对路径
        1. 大多数情况下使用绝对路径，因为相对路径有时候相对的是命令行工具的当前工作目录
        2. 在读取文件或者设置文件路径时都会选择**绝对路径**
        3. 使用__dirname获取当前文件所在的绝对路径
            
            ```
            const fs = require('fs');
            const path = require('path');
            console.log(__dirname);
            console.log(path.join(__dirname, '01.helloworld.js'));
            
            fs.readFile(path.join(__dirname, '01.helloworld.js'), 'utf8', (err, doc) => {
            	console.log(err)
            	console.log(doc)
            });
            ```

#### 第三方模块
1. 什么是第三方模块
    1. 别人写好的、具有特定功能的、我们能直接使用的模块即**第三方模块**，由于第三方模块通常都是由多个文件组成并且被放置 在一个文件夹中，所以又名**包**。
2. 第三方模块有两种存在形式：
    1. 以js文件的形式存在，提供实现项目具体功能的API接口。
    2. **以命令行工具形式存在**，辅助项目开发
3. 获取第三方模块
    1. npmjs.com网站
        1. npmjs.com：第三方模块的存储和分发仓库
        2. 这个网站存储了80多万个第三方模块
        3. 这个网站提供了一个命令行工具叫npm，用于下载这些第三方模块
        4. 简单来说就是：**npm是一个网站存储了很多nodejs的第三方模块，然后又提供了一个npm命令行来操作这些第三方模块**
        5. npm本身也是一个第三方模块，但是这个第三方模块在安装nodejs时，自动安装了，不需要我们手动再安装
    2. npm命令行：
        1. npm (node package manager) ： node的第三方模块管理工具
        2. 下载：`npm install 模块名称`
            1. 默认下载到当前命令执行的文件夹下面
            2. 下载完成，当前文件目录会多出一个node_modules文件夹，该文件夹内部存放的就是下载的第三方模块的名称
            3. 还会多出一个packge-lock.json文件
        3. 卸载：`npm unintall package 模块名称`
            1. 将第三方模块从当前目录删除
        4. 全局安装与本地安装
            1. 命令行工具：全局安装
                1. 所有项目都能使用
            2. 库文件：本地安装
                1. 只有当前项目才能使用
    3. 第三方模块 nodemon
        1. nodemon是一个命令行工具，用以辅助项目开发。
        2. 作用：
            1. 在Node.js中，每次修改文件都要在命令行工具中重新执行该文件（`node newtest.js`），非常繁琐。
            2. nodemon作用就是每次修改文件后自动重新执行该文件
            3. 本质是监控文件的保存操作，一旦文件保存就会执行文件
        3. 使用步骤
            1. 使用`npm install nodemon -g` 下载它
            2. 在命令行工具中用nodemon命令替代node命令执行文件
                
                ```
                nodemon test.js
                ```
            3. 一旦执行，终端会一直在监控状态，可以使用`ctrl+c`终止命令
    4. 第三方模块 nrm
        1. nrm ( npm registry manager )：**npm下载地址切换工具**
        2. npm默认的下载地址(npmjs.com)在国外，国内下载速度慢
            1. 因此国内第三方公司专门建立了服务器用于存储npm的第三方模块
            2. 该网站每隔10分钟就会同步一下npmjs.com网站的内容
        3. 使用步骤
            1. 使用`npm install nrm -g` 下载它
            2. 查询国内可用下载地址列表 `nrm ls`
                
                ```
                npm -------- https://registry.npmjs.org/
                yarn ------- https://registry.yarnpkg.com/
                cnpm ------- http://r.cnpmjs.org/
                //*代表当前默认的下载地址
                * taobao ----- https://registry.npm.taobao.org/
                nj --------- https://registry.nodejitsu.com/
                npmMirror -- https://skimdb.npmjs.com/registry/
                edunpm ----- http://registry.enpmjs.org/
                ```
            3. 切换npm下载地址 `nrm use 下载地址名称`
                
                ```
                nrm use taobao
                ```
                 
##### 第三方模块 Gulp
1. Gulp是什么
    1. 基于node平台开发的前端构建工具
    2. 将机械化操作编写成任务, 想要执行机械化操作时执行一个命令行命令任务就能自动执行了
    3. 用机器代替手工，提高开发效率。
2. Gulp能做什么
    1. 项目上线，HTML、CSS、JS文件压缩合并
    2. 语法转换（es6、less ...）
    3. 公共文件抽离
    4. 修改文件浏览器自动刷新
3. Gulp使用
    1. 使用npm install gulp下载gulp库文件
    2. 在项目根目录下建立gulpfile.js文件
    3. 重构项目的文件夹结构 src目录放置源代码文件 dist目录放置构建后文件
    4. 在gulpfile.js文件中编写任务.
    5. 在命令行工具中执行gulp任务
4. Gulp中提供的方法
    1. gulp.src()：获取任务要处理的文件
    2. gulp.dest()：输出文件
    3. gulp.task()：建立gulp任务
    4. gulp.watch()：监控文件的变化
    
    ```
    const gulp = require('gulp');
    // 使用gulp.task()方法建立任务
    gulp.task('first', () => {
        // 获取要处理的文件 
        gulp.src('./src/css/base.css');
        // 将处理后的文件输出到dist目录 
        .pipe(gulp.dest('./dist/css')); 
    });
    ```
5. Gulp插件
    
    ```
    1. gulp-htmlmin ：html文件压缩
    2. gulp-csso ：压缩css
    3. gulp-babel ：JavaScript语法转化
    4. gulp-less: less语法转化
    5. gulp-uglify ：压缩混淆JavaScript
    6. gulp-file-include 公共文件包含
    7. browsersync 浏览器实时同步
    ```
    

#### package.json文件

#### Node.js中模块的加载机制


