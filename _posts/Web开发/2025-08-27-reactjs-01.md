---
layout: post
title: ReactJS语法-虚拟DOM
category: Web开发
tags: Web开发
description: Web开发
--- 

## 虚拟DOM（Virtual Document Object Model）
1. DOM的本质：就是用JS表示的UI元素，即用浏览器中的JS提供API获取html中的某个元素。
2. 虚拟DOM：并不是由浏览器提供的，而是我们程序员手动模拟实现的，类似于浏览器中的DOM，但是有着本质的区别；
3. 虚拟DOM的使用目的：为了实现DOM节点的高效更新。
    1. 场景：有个列表页面，有n行n列数据，点击每列表头可以对整个表进行升降排序。
    2. 普通实现方案：当点击x列时，首先将数据源按照该列进行排序，然后使用for循环重新生成每列元素标签，填充最新数据。
    3. 缺点：如果某次排序仅仅变动了其中的2行数据，那么每次点击整个表格部分DOM要重新创建，非常消耗浏览器性能。
    4. 理想方法：每次点击排序只需要更新这两条需要调整的元素即可。
    5. 解决方案：1. 用js对象来描述整个表格的DOM---旧DOM。2.点击排序后的数据，用JS创建新的对象DOM---新DOM 3. 将旧、新进行对比，校验出不同的地方。 4. 只更新不同数据的元素。
4. 虚拟DOM的本质：使用JS对象来模拟DOM树
    1. 用虚拟DOM实现`<p title="123">真好<span>456</span></p>`
    2. 实现虚拟DOM如下：
        
        ```
        var p = {
            tagName:"p",
            arrts:{
                title: "123",
                id: ""
            },
            children:{
                "真好",
                {
                    tagName:"span",
                    children:{
                        "456"
                    }
                }
            }
        }
        ```
5. React框架已经实现了虚拟DOM的，无需自己麻烦创建。
6. 新旧DOM如何进行比对呢？-----Diff算法

### Diff算法
 1. tree diff:新旧DOM树，逐层对比的方式，就叫做 tree diff,每当我们从前到后，把所有层的节点对比完后，必然能够找到那些 需要被更新的元素；
 2. component diff：在对比每一层的时候，组件之间的对比，叫做 component diff;当对比组件的时候，如果两个组件的类型相同，则暂时认为这个组件不需要被更新，如果组件的类型不同，则立即将旧组件移除，新建一个组件，替换到被移除的位置；
 3. element diff:在组件中，每个元素之间也要进行对比，那么，元素级别的对比，叫做 element diff；
 4. key：key这个属性，可以把 页面上的 DOM节点 和 虚拟DOM中的对象，做一层关联关系；