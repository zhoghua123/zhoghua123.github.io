---
layout: post
title: MFC-第二节 MFC入门
category: CPP基础
tags: CPP基础
description: CPP基础
---

> 第一节是用windows系统API的C语言源码编写一个窗口
> 本节使用MFC来创建一个窗口

## MFC入门
1. 什么是MFC?
    1. 微软基础类库（英语：Microsoft Foundation Classes，简称MFC）是微软公司提供的一个类库（class libraries），**以C++类的形式封装了Windows API**，并且包含一个应用程序框架，以减少应用程序开发人员的工作量。
    2. 其中包含大量Windows句柄封装类和很多Windows的内建控件和组件的封装类。
    3. MFC把Windows SDK API函数包装成了几百个类，MFC给Windows操作系统提供了面向对象的接口，支持可重用性、自包含性以及其他OPP原则。
    4. MFC通过编写类来封装窗口、对话框以及其他对象，引入某些关键的虚函数（覆盖这些虚函数可以改变派生类的功能）来完成，并且MFC设计者使类库带来的总开销降到了最低。
    5. **即MFC就是Windows API的一层C++封装**

### 编写一个MFC程序
1. 代码的编写
    1. 项目的创建和之前一样，只是此次的源文件后缀为.cpp，因为MFC是由C++编写的，编写MFC程序需要包含`#include <afxwin.h>`头文件。
    2. 代码如下:
        
        ```
        //mfc.h文件
        #pragma once

        #include<afxwin.h>//mfc头文件
        //应用程序类CWinApp,派生类（子类）
        //CWinApp就相当于iOS的UIApplication
        class MyApp:public CWinApp
        {
        public:
        	//重写父类的虚函数
        	//MFC程序的入口地址
        	virtual  BOOL InitInstance();
        
        };
        
        //窗口框架类：CFrameWnd，派生类
        class MyFrame:public CFrameWnd
        {
        public:
        	MyFrame();//无参构造函数
        
        };
        
        //mfc.cpp文件
        #include"mfc.h"
        MyApp app;//有且只有一个全局的应用程序类对象
        BOOL MyApp::InitInstance() { //程序的入口地址
        	MyFrame *frame = new MyFrame;//1. 创建框架类对象
        	frame->ShowWindow(SW_SHOWNORMAL);//2. 显示窗口
        	frame->UpdateWindow();//3. 更新窗口
        	m_pMainWnd = frame;//4. 保存你的线程的主窗口对象的指针
        	return TRUE;//初始化正常返回true
        }
        
        MyFrame::MyFrame() {
        	Create(NULL, TEXT("MFC WINDOW"));//创建窗口
        }
        ```
    3. 配置环境后，代码才可编译运行：
        1. 右击项目->属性->常规->MFC的使用->选择“在共享DLL中使用MFC”->应用，确定
        2. 右击项目->属性->常规->字符集->使用unicode字符集(**必须设置**)
    4. 程序执行流程
        1. 程序开始时，先实例化应用程序对象(有且只有一个)
        2. 执行程序的入口函数InitInstance()
        3. 给框架类MyFrame对象动态分配空间（自动调用它的构造函数），在其构造函数内部，通过CWnd::Create创建窗口
        4. 框架类对象显示窗口CWnd::ShowWindow
        5. 框架类对象更新窗口CWnd::UpdateWindow
        6. 保存框架类对象指针CWinThread::m_pMainWnd
    5. 代码分析:
        1. CFrameWnd 框架窗口类
            1. CFrameWnd是从CWnd(窗口基类)派生出来的。CFrameWnd模仿框架窗口行为，我们可以把框架窗口作为顶层窗口看待，它是应用程序与外部世界的主要接口。
            2. 如果想要创建一个窗口，可以在此类中调用CWnd::Create或CWnd::CreateEX函数：
                
                ```
                virtual BOOL Create(
                	LPCTSTR lpszClassName,
                	LPCTSTR lpszWindowName,
                	DWORD dwStyle,
                	const RECT& rect,
                	CWnd* pParentWnd,
                	UINT nID,
                	CCreateContext* pContext = NULL
                	);
                ```
                
                * Create接收的8个参数后6个有默认值定义。
                * lpszClassName指定了窗口基于WNDCLASS类的名称，为此将其设定为NULL将创建一个基于已注册的WNDCLASS类的默认框架窗口。
                * lpszWindowName参数指定将在窗口的标题栏出现的文字。
        2. CWinApp应用程序类
            1. **MFC应用程序的核心就是基于CWinApp类的应用程序对象。**CWinApp提供了消息循环来检索消息并将消息调度给应用程序窗口。它还包括可被覆盖的、用来自定义应用程序行为的主要虚函数。
            2. **一个MFC程序可以有且仅有一个应用程序对象**，此对象必须声明为在全局范围内有效，以便它在程序开始时即在内存中被实例化。
        3. InitInstance函数
            1. CWinApp::InitInstance函数是一个虚函数，其默认操作仅有一条语句：
                
                ```
                BOOL MyApp::InitInstance()//程序入口地址
                {
                	return TRUE;
                }
                ```
            2. InitInstance的目的是给应用程序提供一个自身初始化的机会，其返回值决定了框架接下来要执行的内容，如果返回FALSE将关闭应用程序，如果初始化正常返回TRUE以便允许程序继续进行。此函数是MFC应用程序的入口。
        4. m_pMainWnd 成员变量
            1. 在CWinApp中有一个名为`CWinThread::m_pMainWnd`的成员变量。 该变量是一个CWnd类型的指针，它保存了应用程序框架窗口对象的指针。也就是说，是指向CFramWnd对象（框架窗口类对象）的指针。
2. 消息映射
    1. **消息映射是一个将消息和成员函数相互关联的表**。比如，框架窗口接收到一个鼠标左击消息，MFC将搜索该窗口的消息映射，如果存在一个处理WM_LBUTTONDOWN消息的处理程序，然后就调用OnLButtonDown。
    2. 下面是是将消息映射添加到一个类中所做的全部工作：
        1. 所操作类中，声明消息映射宏。
        2. 通过放置标识消息的宏来执行消息映射，相应的类将在对BEGIN_MESSAGE_MAP和END_MESSAGE_MAP的调用之间处理消息。
        3. 代码如下:
            
            ```
            //窗口框架类：CFrameWnd，派生类
            class MyFrame:public CFrameWnd
            {
            public:
            	MyFrame();//无参构造函数
            
            	//声明消息映射，必须用在类声明中
            	DECLARE_MESSAGE_MAP();
            	//鼠标左击处理函数声明
            	afx_msg void OnLButtonDown(UINT,CPoint);
            
            };
            
            //mfc.cpp文件
            
            //定义消息宏，必须用在类实现中
            BEGIN_MESSAGE_MAP(MyFrame, CFrameWnd)
            	ON_WM_LBUTTONDOWN()
            END_MESSAGE_MAP()//结束
            //鼠标左击处理函数定义
            void MyFrame::OnLButtonDown(UINT, CPoint)
            {
            	MessageBox(TEXT("鼠标点击左键"));
            }
            
            MyFrame::MyFrame() {
            	Create(NULL, TEXT("MFC WINDOW"));//创建窗口
            }
            ```

### 帮助文档的使用
1. 帮助文档有2种方式
    1. MSDN搜索
        1. 下载MSDN，打开，点击索引，既可以搜索想要查找的类
    2.  VC++之MFC类库中文手册（直接百度搜索这个名字，百度上很多）
        1. 通过此手册查找，必须加上成员所属的类作用域(类名::)，否则，无法查找到匹配的关键字。
        2. 比如:`CWnd::MessageBox`
        3. 也是先下载，然后打开搜索使用
        4. 改手册滑动到最底层，全部是“消息映射”相关的文档。

### Widnows字符集

