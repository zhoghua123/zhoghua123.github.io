---
layout: post
title: 第二章 内联函数、引用、const
category: CPP基础
tags: CPP基础
description: CPP基础
---  

## 内联函数(inline function) 
1. 使用inline修饰函数的声明或者实现，可以使其变成内联函数
    1. 建议声明和实现都增加inline修饰
    2. 但是注意：有默认参数的函数，只能加在声明上，不能加载实现上。
2. 特点
    1. 编译器会将函数调用直接展开为函数体代码 
        1. 将VS设置为release
        2. 点击项目属性->属性->C/C++->优化设置为“已禁用”，而且内联函数扩展设置为“任何适用项”
        3. 编译，然后将.exe拖入到IDA可以看到，main函数中的汇编代码
        4. sum函数没有添加inline时，有调用： call sum
        5. 没有inline修饰时，没有调用call sum 语句。
    2. 可以减少函数调用的开销
    3. 会增大代码体积 
        
        ```
        //内联函数声明
        inline int sum(int a, int b);
        
        int main() {
        
        	//内联函数
        	cout << sum(10, 20) << endl;
        	//上面的本质就是：
        	//cout << 10 +20 << endl;
        
        	getchar();
        	return 0;
        }
        //内联函数实现
        inline int sum(int a, int b) {
        	return a + b;
        }
        ```
3. 注意
    1. 尽量不要内联超过10行代码的函数
    2. 有些函数即使声明为inline，也不一定会被编译器内联，比如**递归函数**
        1. inline仅仅是建议编译器内联，但是如果代码很多编译器不一定内联。
        2. 递归是没办法内联的。
4. 内联函数使用场合
    1. 函数代码不是很多
    2. 函数的调用频率较高

### 内联函数与宏 
1. 内联函数与宏都是替换，那么他们有什么区别呢？
    1. 内联函数和宏，都可以减少函数调用的开销
    2. 都在编译阶段替换掉
    3. 对比宏，内联函数多了语法检测和函数特性 
2. 思考以下代码的区别
    
    ```
    #define sum(x) (x + x)
    inline int sum(int x) { return x + x; } 
    int a = 10; sum(a++);
    
    //宏:简单的替换
    a++ + a++
    
    //内联函数,只有一次++
    int x = a++;
    sum(x);
    ```
    
## `#`pragma once 
1. 我们用VS新建一个.h文件，这个头文件内部会默认一个`#pragma once`,那么它是什么作用呢？
2. 我们经常使用`#ifndef、#define、#endif`来防止头文件的内容被重复包含
3. `#pragma once`可以防止整个文件的内容被重复包含
4. 区别
    1. `#ifndef、#define、#endif`受C\C++标准的支持，不受编译器的任何限制
    2. 有些编译器不支持#pragma once(较老编译器不支持，如GCC 3.4版本之前)，兼容性不够好
    3. `#ifndef、#define、#endif`可以针对一个文件中的部分代码，而#pragma once只能针对整个文件


