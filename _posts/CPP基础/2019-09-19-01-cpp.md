---
layout: post
title: QT-第三节 QMainWindow、对话框QDialog
category: CPP基础
tags: CPP基础
description: CPP基础
--- 

## QMainWindow
1. 第一节讲过，QT创建项目有三大基类：QWidget、QMainWindow、QDialog
2. 前面已经简单的介绍了QWidget基类，下面来介绍一下QMainWindow基类
    1. QMainWindow继承自QWidget
    2. QMainWindow是一个为用户提供主窗口程序的类，包含一个菜单栏（menu bar）、多个工具栏(tool bars)、多个锚接部件(dock widgets)（可以拖动的）、一个状态栏(status bar)及一个中心部件(central widget)，是许多应用程序的基础，如文本编辑器，图片编辑器等。
    3. 如下图：
        
        ![图4](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/cpp61.png)
3. 项目的简单创建
    1. 新建项目->选择Application->Qt Widgets Application->选择【Choose】
    2. 设置项目名称和路径
    3. 选择编译器类型：Kits
    4. Details:选择基类为QMainWindow，类名为：MyQMainWindow,”创建界面“不勾选，
    5. summary：先不设置git，完成
    6. 项目有4个文件：mymainwindow.h、mymainwindow.cpp、main.cpp和一个pro文件
     
### 菜单栏   
1. 一个主窗口最多只有一个菜单栏。位于主窗口顶部、主窗口标题栏下面。
    1. 创建菜单栏，通过QMainWindow类的menubar（）函数获取主窗口菜单栏指针
        
        ```
        QMenuBar *	menuBar() const
        ```
    2. 创建菜单，调用QMenu的成员函数addMenu来添加菜单
        
        ```
        QAction* addMenu(QMenu * menu)
        QMenu* addMenu(const QString & title)
        QMenu* addMenu(const QIcon & icon, const QString & title)
        ```
    3. 创建菜单项，调用QMenu的成员函数addAction来添加菜单项
        
        ```
        QAction* activeAction() const
        QAction* addAction(const QString & text)
        QAction* addAction(const QIcon & icon, const QString & text)
        QAction* addAction(const QString & text, const QObject * receiver,
         const char * member, const QKeySequence & shortcut = 0)
        QAction* addAction(const QIcon & icon, const QString & text, 
        const QObject * receiver, const char * member, 
        const QKeySequence & shortcut = 0)
        ```
2. Qt 并没有专门的菜单项类，只是使用一个QAction类，抽象出公共的动作。当我们把QAction对象添加到菜单，就显示成一个菜单项，添加到工具栏，就显示成一个工具按钮。用户可以通过点击菜单项、点击工具栏按钮、点击快捷键来激活这个动作。

###  工具栏
1. 主窗口的工具栏上可以有多个工具条，通常采用一个菜单对应一个工具条的的方式，也可根据需要进行工具条的划分。
    1. 直接调用QMainWindow类的addToolBar（）函数获取主窗口的工具条对象，每增加一个工具条都需要调用一次该函数。
    2. 插入属于工具条的动作，即在工具条上添加操作。
        1. 通过QToolBar类的addAction函数添加。
    3. 工具条是一个可移动的窗口，它的停靠区域由QToolBar的allowAreas决定，包括：
        1. Qt::LeftToolBarArea 停靠在左侧
        2. Qt::RightToolBarArea 停靠在右侧
        3. Qt::TopToolBarArea 停靠在顶部
        4. Qt::BottomToolBarArea  停靠在底部
        5. Qt::AllToolBarAreas 以上四个位置都可停靠
    4. 使用setAllowedAreas（）函数指定停靠区域：
        
        ```
        setAllowedAreas（Qt::LeftToolBarArea | Qt::RightToolBarArea）
        ```
    5. 使用setMoveable（）函数设定工具栏的可移动性：
        
        ```
        setMoveable（false）//工具条不可移动, 只能停靠在初始化的位置上
        ```
    
### 状态栏
1. 派生自QWidget类，使用方法与QWidget类似，QStatusBar类常用成员函数：
2. 状态栏也只能最多有一个
    
    ```
    void addWidget(QWidget * widget, int stretch = 0)
    //插入小部件
    int	insertWidget(int index, QWidget * widget, int stretch = 0)
    //删除小部件
    void removeWidget(QWidget * widget)
    ```

### 铆接部件
1. 铆接部件 QDockWidget，也称浮动窗口，可以有多个。
    
    ```
    QDockWidget * dock = new QDockWidget("标题",this);
    addDockWidget(Qt::LeftDockWidgetArea,dock);
dock->setAllowedAreas(Qt::LeftDockWidgetArea | Qt::RightDockWidgetArea | Qt::TopDockWidgetArea);  设置区域范围
    ```

### 核心部件（中心部件）
1. 除了以上几个部件，中心显示的部件都可以作为核心部件，例如一个记事本文件，可以利用QTextEdit做核心部件
    
    ```
    QTextEdit * edit = new QTextEdit(this);
    setCentralWidget(edit);
    ```

### 代码举例：

```
#include "mymainwindow.h"
#include<QMenuBar>
#include<QToolBar>
#include<QStatusBar>
#include<QLabel>
#include<QDockWidget>
#include<QTextEdit>

MyMainWindow::MyMainWindow(QWidget *parent)
    : QMainWindow(parent)
{
    resize(600,400);
    /*----------------菜单栏----------------*/
    //1. 创建菜单栏
    //包含菜单栏，只能有一个
    QMenuBar *bar =  menuBar();
    //2. 将菜单栏放入窗口中
    this->setMenuBar(bar);
    //3. 网菜单栏中添加菜单（注意要导入头文件QMenuBar）
    QMenu *fileMenu =  bar->addMenu("文件");
    QMenu *editMenu =  bar->addMenu("编辑");
    //4. 添加菜单项
    //给文件菜单添加菜单项
    QAction *nesAction =  fileMenu->addAction("新建");
    //添加分割线
    fileMenu->addSeparator();
    QAction *openAction =  fileMenu->addAction("打开");

    /*----------------工具栏----------------*/
    //工具栏可以有多个
    //1. 创建工具栏，导入QToolBar文件
    QToolBar *tool = new QToolBar(this);
    //2. 往菜单栏中添加工具栏,工具栏可进行拖拽移动
//    addToolBar(tool);
    //toolBar默认在左边
    addToolBar(Qt::LeftToolBarArea,tool);
    //3. 限制toolbar的移动位置(只能左侧或者右侧移动)
    /*
     *  void setAllowedAreas(Qt::ToolBarAreas areas);
     * Qt::ToolBarAreas是一个枚举类型
    */
    tool->setAllowedAreas(Qt::LeftToolBarArea | Qt::RightToolBarArea);
    //4. 设置浮动(禁止浮动)
    tool->setFloatable(false);
    //5. 设置移动（不允许拖拽移动了）
//    tool->setMovable(false);

    //6. 工具栏添加工具项
    tool->addAction(nesAction);
    //添加分割线
    tool->addSeparator();
    tool->addAction(openAction);

 /*----------------状态栏----------------*/
    //1. 获取状态栏，只能有一个
    QStatusBar *statusbar =  statusBar();
    //2. 添加状态栏
    setStatusBar(statusbar);
    //3. 往状态栏中添加文本信息
    QLabel *label = new QLabel("左侧提示信息",this);
    //添加到左侧
    statusbar->addWidget(label);
    //添加在右侧
    QLabel *label1 = new QLabel("右侧提示信息",this);
    statusbar->addPermanentWidget(label1);

     /*----------------铆接部件----------------*/
    //铆接部件，移动窗口，可以有多个
    QDockWidget *dock = new QDockWidget("这是一个铆接部件",this);
    //添加铆接部件到窗口中:默认位置，铆接部件
    //注意：当没有核心部件时，铆接部件无论设置什么位置，都在上面
    addDockWidget(Qt::BottomDockWidgetArea,dock);
    //限制铆接部件在窗口中移动的位置
    dock->setAllowedAreas(Qt::TopDockWidgetArea|Qt::BottomDockWidgetArea);

    /*----------------核心部件----------------*/
    
    //文本编辑框 
    QTextEdit *text = new QTextEdit(this);
    setCentralWidget(text);
}

MyMainWindow::~MyMainWindow()
{

}

```
    
### 资源文件
1. Qt 资源系统是一个跨平台的资源机制，用于将程序运行时所需要的资源以二进制的形式存储于可执行文件内部。
2. 如果你的程序需要加载特定的资源（图标、文本翻译等），那么，将其放置在资源文件中，就再也不需要担心这些文件的丢失。
3. 也就是说，如果你将资源以资源文件形式存储，它是会编译到可执行文件内部。

#### 创建项目勾选UI的使用
1. 新建一个项目QMainWindow_ui，继承QMainWindow基类，这一次勾选“创建界面”，即创建“mainwindow.ui”
2. 可以看到新的项目中会多一个`mainwindow.ui`文件,相当于iOS的main.storyboard
3. 而且`mainwindow.cpp`文件有所不一样
    1. 导入文件多了一个头文件`#include "ui_mainwindow.h"`
    2. 构造、析构函数不一样
        
        ```
        #include "mainwindow.h"
        #include "ui_mainwindow.h"
        
        //构造函数初始化列表多传了一个参数 new Ui::MainWindow
        MainWindow::MainWindow(QWidget *parent) :
            QMainWindow(parent),
            ui(new Ui::MainWindow)
        {
            //在当前窗口中初始化UI
            ui->setupUi(this);
        }
        
        MainWindow::~MainWindow()
        {
            //释放UI
            delete ui;
        }
        ```
4. 双击打开`mainwindow.ui`文件，可以在UI界面上布局菜单栏、状态栏、工具栏等。
5. 注意所有布局的空间在Qt的中心屏幕下面都有列表，如果想复用之前的直接在列表中往界面上拖拽即可
6. 如何在代码中即mainwindow.cpp中找到相应的控件呢？
    1. 点击新添加的控件
    2. 在右下角可以看到该控件的属性，同时在这里可以修改该控件的一些性能，找到objectName（这个名字可以自己定义），比如当前的objectName为actionnew
    3. 在mainwindow.cpp的构造方法中找到
        
        ```
        MainWindow::MainWindow(QWidget *parent) :
            QMainWindow(parent),
            ui(new Ui::MainWindow)
        {
            //在当前窗口中初始化UI
            ui->setupUi(this);
            //找到菜单栏的文件菜单下的新建项
            ui->actionnew->setText("新建2");
        }
        ```

#### 设置资源文件
1. 创建、添加资源文件
    1. 使用 Qt Creator 可以很方便地创建资源文件。我们可以在工程上点右键，选择“添加新文件…（add new...）”，选择 “Qt ”，选择“Qt 资源文件（Qt Resoutce File）”：->close
    2. 设置文件名称：QMainWindow_uiResource 路径直接使用默认，点击完成
    3. 此时项目中多了一个Resources文件夹，且文件夹下有个QMainWindow_uiResource.qrc文件
    4. 将已经准备好的图片文件夹：images拖入到当前项目根目录下
    5. 右击QMainWindow_uiResource.qrc文件，选择“open in editor”
    6. 点击添加->添加前缀：`/img`  ,下一步
    7. 点击添加->添加文件：选择之前拖入到根目录下的images文件夹->打开，选择images文件夹中的所有图片->点击打开即可
    8. 资源文件创建、添加完毕，编译一下，编译完之后可以在QMainWindow_uiResource.qrc展开的目录下看到添加的资源文件
2. 使用资源文件
    1. 使用资源文件 `":+ /前缀名 +/文件名"`
        
        ```
        MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent), ui(new Ui::MainWindow)
        {
            //在当前窗口中初始化UI
            ui->setupUi(this);
            //找到菜单栏的文件菜单下的新建项
            ui->actionnew->setText("新建2");
            //使用资源文件":+ /前缀名 +/文件名"
            ui->actionnew->setIcon(QIcon(":/img/images/Luffy.png"));
        }
        ```
    
## 对话框QDialog


