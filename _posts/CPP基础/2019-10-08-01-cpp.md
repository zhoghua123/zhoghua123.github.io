---
layout: post
title: MFC-第一节 
category: CPP基础
tags: CPP基础
description: CPP基础
---

## MFC入门

### 为什么学习MFC ？
1. 什么是MFC?
    1. 微软基础类库（英语：Microsoft Foundation Classes，简称MFC）是微软公司提供的一个类库（class libraries），以C++类的形式封装了Windows API，并且包含一个应用程序框架，以减少应用程序开发人员的工作量。
    2. 其中包含大量Windows句柄封装类和很多Windows的内建控件和组件的封装类。
    3. **即MFC就是Windows API**
2. 如果你是在Windows平台上做GUI开发，MFC(微软基础类库)是一个很好的选择，毕竟Windows累积用户群庞大，市场接受程度高
    1. GUI: 图形用户界面（Graphical User Interface，简称 GUI，又称图形用户接口）是指采用图形方式显示的计算机操作用户界面。
    2. 与早期计算机使用的命令行界面相比，图形界面对于用户来说在视觉上更易于接受
    
### windows的消息机制
1. 要想熟练掌握 Windows 应用程序的开发， 首先需要理解 Windows 平台下程序运行的内部机制。
2. 如果想要更好的学习掌握 MFC，必须要先了解Windows 程序的内部运行机制

#### 基本概念解释
1. 我们在编写标准C程序的时候,经常会调用各种库函数来辅助完成某些功能：初学者使用得最多的C库函数就是printf了，这些库函数是**由你所使用的编译器厂商提供的**。
2. 在Windows平台下，也有类似的函数可供调用：不同的是，这些函数是**由Windows操作系统本身提供的**。

##### SDK和API
1. SDK： 软件开发工具包（Software Development Kit），一般都是一些被软件工程师用于为特定的软件包、软件框架、硬件平台、操作系统等建立应用软件的开发工具的集合。
2. API函数： 
    1. Windows操作系统提供给应用程序编程的接口（Application Programming Interface）。
    2. **Windows应用程序API函数是通过C语言实现的，所有主要的 Windows 函数都在 Windows.h 头文件中进行了声明。**
    3. Windows 操作系统提供了 1000 多种 API函数。

##### 窗口和句柄
1. 窗口：
    1. 窗口是 Windows 应用程序中一个非常重要的元素，**一个 Windows 应用程序至少要有一个窗口，称为主窗口**。
    2. 窗口是屏幕上的一块矩形区域，是 Windows 应用程序与用户进行交互的接口。利用窗口可以接收用户的输入、以及显示输出。
    3. 一个应用程序窗口通常都包含标题栏、菜单栏、系统菜单、最小化框、最大化框、 可调边框，有的还有滚动条。如下图：
        ![图4](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/cpp67.png)
    4. 窗口可以分为客户区和非客户区， 如上图。 
        1. **客户区**是窗口的一部分， 应用程序通常在客户区中显示文字或者绘制图形。 
        2. 标题栏、 菜单栏、 系统菜单、 最小化框和最大化框、 可调边框统称为窗口的**非客户区**， **它们由 Windows 系统来管理， 而应用程序则主要管理客户区的外观及操作**。
    5. 窗口可以有一个父窗口， 有父窗口的窗口称为子窗口。除了上图所示类型的窗口外， 对话框和消息框也是一种窗口。 在对话框上通常还包含许多子窗口， 这些子窗口的形式有按钮、 单选按钮、 复选框、 组框、 文本编辑框等。（**万物皆窗口**）
2. 句柄
    1. **在 Windows 应用程序中， 窗口是通过窗口句柄（ HWND） 来标识的。 我们要对某个窗口进行操作， 首先就要得到这个窗口的句柄。**

    2. 句柄（ HANDLE） 是 Windows 程序中一个重要的概念， 使用也非常频繁。（**资源号**）
        1. 在 Windows 程序中， 有各种各样的资源（ 窗口、 图标、光标,画刷等），系统在创建这些资源时会为它们分配内存， 并返回标识这些资源的标识号， 即**句柄**。 
        2. 在后面的内容中我们还会看到图标句柄（ HICON）、 光标句柄（ HCURSOR） 和画刷句柄（ HBRUSH）。
    
##### 消息与消息队列
1. Windows 程序设计是一种完全不同于传统的 DOS 方式的程序设计方法。**它是一种事件驱动方式的程序设计模式，主要是基于消息的。**
2. 每一个 Windows 应用程序开始执行后， 系统都会为该程序创建一个消息队列， 这个消息队列用来存放该程序创建的窗口的消息。
    1. 例如，当用户在窗口中画图的时候，按下鼠标左键，此时，操作系统会感知到这一事件，于是将这个事件包装成一个消息，投递到应用程序的消息队列中，等待应用程序的处理。
    2. 然后应用程序通过一个**消息循环**不断地从消息队列中取出消息，并进行响应、分发给操作系统处理
    3. 操作系统处理过程中，也会给应用程序“ 发送消息”。所谓“ 发送消息”，**实际上是操作系统调用程序中一个专门负责处理消息的函数，这个函数称为窗口过程。**
    4. 如下图：
        ![图4](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/cpp68.png)
        
##### WinMain函数
1. 当Windows操作系统启动一个程序时，它调用的就是该程序的WinMain函数（ 实际是由插入到可执行文件中的启动代码调用的）。 
2. **WinMain是Windows程序的入口点函数，与DOS程序的入口点函数main的作用相同，当WinMain 函数结束或返回时，Windows应用程序结束。**
3. 由于是在windows平台上开发，所以因该由windows规定入口


### Windows 编程模型
1. 一个完整的Win32程序(`#include <windows.h>`)，该程序实现的功能是创建一个窗口，并在该窗口中响应键盘及鼠标消息，程序的实现步骤为：
    1. WinMain函数的定义
    2. 创建一个窗口
    3. 进行消息循环
    4. 编写窗口过程函数

#### 创建项目
1. 打开vs2017->新建->项目
2. 点击Visual C++ -> win32项目
3. 重名项目名、选择路径->确定
4. 选择windows应用程序、空项目(其他选项默认)->完成 (以上步骤，或者之间选择一个空项目即可，默认就是win32的)
5. 添加源文件
    1. 右击源文件->新建项目->创建一个windows.c文件（因为底层是C语言的API）

#### WinMain函数的定义

```
int WINAPI WinMain(
	HINSTANCE hInstance,	//应用程序实例
	HINSTANCE hPrevInstance,	//上一个应用程序实例
	LPSTR lpCmdLine,		//命令行参数
	int nShowCmd);		//窗口显示的样式
```

* WINAPI：是一个宏，它代表的是__stdcall（注意是两个下划线），表示的是参数传递的顺序：从右往左入栈，同时在函数返回前自动清空堆栈。
* hInstance：表示该程序当前运行的实例的句柄，这是一个数值。当程序在Windows下运行时，它唯一标识运行中的实例（注意，只有运行中的程序实例， 才有实例句柄）。一个应用程序可以运行多个实例，每运行一个实例，系统都会给该实例分配一个句柄值，并通过hInstance参数传递给 WinMain 函数。
    * 应用程序的实例句柄，相当于iOS的UIAPPlication对象
* hPrevInstance：表示当前实例的前一个实例的句柄。在Win32环境下，这个参数总是NULL，即在Win32环境下，这个参数不再起作用。
* lpCmdLine：是一个以空终止的字符串， 指定传递给应用程序的命令行参数，相当于C或C++中的main函数中的参数char *argv[]。
* nShowCmd：表示一个窗口的显示，表示它是要最大化显示、最小化显示、正常大小显示还是隐藏显示。

#### 创建一个窗口
1. 创建一个完整的窗口，需要经过下面几个步骤：
    1. 设计窗口类
    2. 注册窗口类
    3. 创建窗口类
    4. 显示和更新窗口
    5. 通过循环取消息
    6. 处理消息（窗口过程）

##### 设计窗口类


