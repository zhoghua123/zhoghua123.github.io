---
layout: post
title: MFC-第三节 基于对话框编程
category: CPP基础
tags: CPP基础
description: CPP基础
---

## 基于对话框编程
1. 对话框是一种特殊类型的窗口，绝大多数Windows程序都通过对话框与用户进行交互。在Visual C++中，对话框既可以单独组成一个简单的应用程序，又可以成为文档/视图结构程序的资源。

### 创建基于对话框的 MFC 应用程序框架
1. 选择“文件 | 新建 |　项目”菜单； 
2. 在“新建项目”对话框中，选择“ MFC 应用程序 ”，输入工程名称（MFCDialog），选择“确定”。
3. 应用程序类型：选择“ 基于对话框”，即创建基于对话框的应用程序，选择“完成

### 对话框应用程序框架介绍
1. 资源视图
    1. 创建基于对话框的应用程序框架（假定工程名为 MFCDialog ）后，项目工作区上增加了一个“资源视图”选项卡。或者，通过视图找到“资源视图”选项卡
    2. 点击该选项卡，展开项目目录，找到Dialog文件目录下会看到2个文件"IDD_ABOUTBOX"/"IDD_MFCDIALOG_DIALOG"
    3. 在 MFC中，与用户进行交互的对话框界面被认为是一种资源。
        1. ID为IDD_MFCDIALOG_DIALOG：
            1. 中间部分（MFCDIALOG）与项目名称相同，对应中间的对话框设计界面。不管在何时，只要双击对话框资源的ID，对话框设计界面就会显示在中间。
        2. IDD_ABOUTBOX：
            1. 关于对话框，用于说明当前应用程序的一些信息
    4. 运行demo，显示的视窗，就是IDD_MFCDIALOG_DIALOG资源，相当于iOS的sb，点击左上角的图标弹出系统菜单，点击”关于...“,弹出的就是关于对话框IDD_ABOUTBOX资源
    5. 右击IDD_MFCDIALOG_DIALOG资源，属性，找到Caption设置内容，这便是对话框的标题设置
2. 类视图
    1. 在类视图中，可以看到生成了3 个类：CAboutDlg、CMFCDialogApp和CMFCDialogDlg。
        * CAboutDlg：对应生成的版本信息对话框。
        * CDialogApp：应用程序类，从 CWinApp 继承过来，封装了初始化、运行、终止该程序的代码。
        * CDialogDlg：对话框类，从CdialogEx继承过来的，在程序运行时看到的对话框就是它的一个具体对象
            1. DoDataExchange函数：该函数主要完成对话框数据的交换和校验。
            2. OnInitDialog函数：相当于对对话框进行初始化处理。
3. 工具箱：
    1. 视图->工具箱
    2. 各种控件用于丰富资源界面

### 模态对话框与非模态对话框

#### 模态对话框
1. 当模态对话框显示时，程序会暂停执行，直到关闭这个模态对话框之后，才能执行程序中的其他任务。
2. 实现点击”模态对话框“按钮，则弹出一个模态对话框
    1. 主界面添加”模态对话框“按钮
        1. 通过工具箱在主界面上放一个Button，右击->属性，找到caption修改名字为模态对话框
        2. 双击此按钮即可跳转到按钮处理函数：会看到是在MFCDialogDlg.cpp文件中
            1. 除了双击,还有2种方法,添加点击按钮的实现
                1. 右击按钮->属性->点击右边的闪电图标(控件事件)->BN_CLICKED->右边的下来箭头Add...
                2. 右击按钮->添加事件处理程序->选择事件类型、修改处理程序名称->添加编辑即可
    2. 添加模态对话框的资源视图
        1. 资源视图 -> Dialog -> 右击 -> 插入 Dialog：会看到资源视图的Dialog文件夹下多了一个IDD_DIALOG1资源视图
        2. 设置当前视图名称为”模态对话框“
        3. 修改对话框的ID，在属性中找到ID,修改为IDD_EXEC
    3. 当前模态对话框添加相应的类
        1. 点击对话框模板 -> 右击 -> 添加类：
        2. 设置类名(CDlgEexec)点击确定,即可
        3. 类视图中多了一个自定义类CDlgEexec：这个类就是与这个对话框关联的类
    4. 主界面按钮处理函数创建对话框，以模态方式运行。
        1. 实现模态对话框的创建需要调用CDialog类的成员函数CDialog::DoModel，该函数的功能就是创建并显示一个对话框:
        2. 在MFCDialogDlg.cpp文件中
            1. 导入CDlgEexec.h文件
            2. 找到”模态对话框“按钮相应函数
            
            ```
            void CMFCDialogDlg::OnBnClickedButton1()
            {
            	// TODO: 在此添加控件通知处理程序代码
            	CDlgEexec dlg;
            	dlg.DoModal();//以模态的方式运行
            }
            ```
    
#### 非模态对话框
1. 当非模态对话框显示时，运行转而执行程序中的其他任务，而不用关闭这个对话框
2. 实现点击”非模态对话框“按钮，则弹出一个非模态对话框
    1. 图形界面操作过程和模态对话框一样,ID为IDD_SHOW,类名为CDlgShow
    2. 在CMFCDialogDlg类的成员函数中添加成员属性
        
        ```
        // MFCDialogDlg.h: 头文件
        #pragma once
        #include "CDlgShow.h"
   
        // CMFCDialogDlg 对话框
        class CMFCDialogDlg : public CDialogEx
        {
        // 构造
        public:
        	...
        // 实现
        protected:
        	...
        	   //这个要保存到成员属性中强引用，否则就会释放掉
           CDlgShow  dlg;
        };
        ```
    3. 在OnInitDialog函数中create
        1. 这个方法就相当于iOS的viewDidLoad
        
        ```
        // CMFCDialogDlg 消息处理程序
        BOOL CMFCDialogDlg::OnInitDialog()
        {
        	...
        	// TODO: 在此添加额外的初始化代码
        	//该方法不允许多次创建，只能创建一次，因此可以把它放在CMFCDialogDlg类的OnInitDialog函数中
        	dlg.Create(IDD_SHOW);
        	return TRUE;  // 除非将焦点设置到控件，否则返回 TRUE
        }
        ```
    4. 实现非模态按钮点击方法
        
        ```
        void CMFCDialogDlg::OnBnClickedButton2()
        {
        	// TODO: 在此添加控件通知处理程序代码
        	//这个要保存到成员属性中强引用，否则就会释放掉
        	//CDlgShow  dlg;
        	//该方法不允许多次创建，只能创建一次，因此可以把它放在CMFCDialogDlg类的OnInitDialog函数中
        	//dlg.Create(IDD_SHOW);
        	dlg.CenterWindow();//居中显示
        	dlg.ShowWindow(SW_SHOWNORMAL);
        }
        ```

