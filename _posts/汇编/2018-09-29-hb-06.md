---
layout: post
title: 第三章：汇编语言程序设计（二）
category: 汇编
tags: 汇编
description: 汇编
---

## 汇编语言程序格式

### 汇编语言数据的定义
> 在程序中用到的所有数据必须指定其类型，数据分为常量和变量

#### 常量
1. 汇编源程序中具有固定值的数称为常量；
2. 常量可以以多种数制及字符形式出现
3. 汇编程序中常使用一下两种类型的常量
    1. 数字常量
        1. 二进制数：10100001B
        2. 八进制：76Q,335O
        3. 十进制： 98,4330
        4. 十六进制： 0FE65H
    2. 字符串常量
        1. 字符串常量表示为包含在两个单引号之间的字符，如：`’AB‘,‘123’`等
        2. 程序经编译后，单引号内的每个字符实际上是其ASCII码的形式，例如：`'AB'`,可以看成是4142H.

#### 变量的定义
1. 变量是用户为存放数据的内存单元所起的名字
2. 变量名实际上是内存单元的符号地址
3. 通常这些内存单元被分配在数据段、附加段或堆栈段，这些单元的数据在程序的运行期间可以随时修改。
4. 在汇编程序中，用数据定义伪指令为变量分配内存单元，同时可以将这些内存单元预置初值。
    1. 字节定义语句 DB
        1. 定义字节存储单元，其后的每个操作数占有一个字节单元，可以连续存放。
        2. 格式：`[变量名] DB 操作数 [,....操作数]`
        3. 举例：
            
            ```
            //单字节数据
            X DB 10   ;为变量X分配一个字节，初值是10
            Y DB ?    ;为变量Y分配一个字节，不设置初值，初值是随机值
            
            //多字节数据
            BUFFER DB 3,4,-5,-2    ;从地址BUFFER开始，连续分配4个字节，其内容分别是03H,04H,0FBH,0FEH(负数是以补码的形式在计算机中存在的)
            
            //定义字符串
            
            STRING DB 'ABCD'     ;从地址STRING开始，连续分配4个字节，其内容分别是41H,42H,43H,44H
            //定义重复数据
            BUF DB 100 DUP(0)    ;从地址BUF开始，连续分配100个字节，并将其全部赋值为0.
            复制操作符DUP用来复制某个或某些连续的存储空间，并且可以嵌套使用。
            ```
    2. 自定义语句 DW
        1. 定义字存储单元，其后的每个操作数占据两个字节，地位字节在低地址，高位字节在高地址，可以连续存放。
        2. 自定义单元的定义格式与操作数的形式与字节定义语句DB类似。
        3. 注意： 如果DW后的操作数是地址（变量名），则存入对应字单元的是地址（变量名）的偏移地址部分。
                
            ```
            DAT SEGMENT
              X DB 3,4
              Y DW -2
              ADDR DW Y
            DAT ENDS
            其中，ADDR字单元内存储的事变量Y的偏移地址
            ```
    3. 其他数据定义语句DD/DQ/DT等
        1. DD定义双字存储单元，其后的每个操作数占据4个字节
        2. DQ定义的每个数据单元占8个字节
        3. DT定义的每个数据单元占10个字节

#### 变量的属性
1. 由于存储器是分段使用的，所以对源程序中定义的变量都有以下3种属性。
    1. 段属性： 变量所在段的段基址，为该段所对应的段寄存器的值。
    2. 偏移属性：变量距段起始地址的字节数，为16位二进制无符号数。
    3. 类型属性： 变量在存储单元所占的字节长度，为整数数值，主要有BYTE(1),WORD(2),DWORD(4),DQ(8),DT(10)等。

### 汇编语言的标号
1. 标号的概念
    1. 标号是用户为程序中某条指令所起的名字，实质上是**代码段**中该指令所对应的**目标代码**在存储器内的存放地址。
    2. 标号经常在转移、调用指令中引用，作为程序转移的目标地址。
2. 标号的属性
    1. 段属性： 标号所在段的段基址，为该段所对应的段寄存器的值，即CS的值。
    2. 偏移属性： 标号所代表的指令相对于代码段首地址的字节数，为16位二进制无符号数
    3. 类型属性： 若标号所代表的指令与引用标号的指令在同一代码段内，则为NEAR类型，用0FFFFH(1)表示；否则为FAR类型，用0FFFEH（-2）表示。
    4. 可见：变量代表的事数据存储单元的地址，而标号代表的是指令存储单元的地址。

### 汇编语言的运算符和表达式
1. 汇编语言的数据或者操作数除了表示为常量、变量和标号的形式外，还可以表示成表达式的形式。
2. 注意： **表达式并不是命令，其计算或操作都是在汇编时由汇编程序完成的，在程序运行时表达式已经被他的运算结果取代了**
3. 表达式根据其运算结果的类型分为数值表达式和地址表达式。
    1. 数值表达式的运算结果是数值，没有别的属性；
    2. 地址表达式的运算结果是地址，具有段属性、偏移属性和类型属性
5. 构成表达式的运算符有5种，分别是算术运算符、逻辑运算符、关系运算符、分析运算符合合成运算符。
    1. 所有运算符如课本表：4.1 p119
    2. 这积累运算符的优先级： 4.2 p119

#### 算术运算符
1. 算术运算符共包括：加（+）、减（-）、乘（*）、除（/）、取余（MOD）、左移（SHL）、右移（SHR）共7种
2. 说明：
    1. 参加运算的数值和运算结果均是整数
    2. “/”运算的结果取两个运算数商的整数部分，“MOD”是取两个运算数商的余数部分；
    3. SHL/SHR表示的是在**汇编阶段**对一个具体的整数值进行左移、右移运算
    4. **注意：**左移算术运算符SHL与逻辑左移指令SHL是完全不同的两种操作，左移运算符是在**汇编程序时**完成的操作； 逻辑左移指令是在**程序运行时**进行的操作，如下指令：
        
        ```
        SHL BL, 1       ; 执行到该指令时，寄存器BL的内容左移一位。
        ```
3. 算术运算符都可以用于数值表达式，其中的“+”、“-” 还可以用于地址表达式，有以下3种形式
    1. 地址表达式 + 常数
        1. 运算结果为偏移地址，与地址表达式的类型和段基址相同，但偏移地址是地址表达式的偏移地址加上常数个字节。
    2. 地址表达式 - 常数
        1. 运算结果为偏移地址，与地址表达式的类型和段基址相同，但偏移地址是地址表达式的偏移地址减去常数个字节。
    3. 地址表达式1 - 地址表达式2
        1. 结果是一个**数值**，表示两偏移地址间距的字节数。 需要注意的是，地址表达式1和地址表达式2必须在同一个逻辑段中，即这两个地址必须有同一个段基址。

#### 逻辑运算符
1. 逻辑运算符包括与（AND）、或（OR）、非（NOT）、异或（XOR）4种
2. 逻辑运算符所处理的操作数均是数值型整数，在两个整数之间按位进行二进制运算，结果也是整数。

#### 关系运算符
1. 关系运算符包括等于（EQ）、不等于（NE）、小于（LT）、小于等于（LE）、大于（GT）大于等于（GE）6种
2. 关系运算符用于比较两个表达式，这两个表达式可以是常数表达式或同一段内的地址（变量）表达式。
3. 若为常数表达式，按照无符号数的规则进行比较，若为你同一段内的地址（变量）表达式，则比较他们的偏移地址。
4. 关系运算符的结果有两种，若关系成立，结果为逻辑真值，用0FFFH表示；否则，为逻辑假值，用0表示。

#### 分析运算符
> 分析运算符用来分析一个操作数（**变量或标号**）的属性，即将其不同的属性（段地址、偏移地址、类型、字节总数、数据项总数）用数值表示出来

1. SEG 运算符
    1. 格式 ： SEG 变量或标号
    2. 功能： 返回变量或标号所在段的段基址，为16位二进制数。
2. OFFSET 运算符
    1. 格式： OFFSET 变量或标号
    2. 功能： 返回变量或标号的段内偏移地址，为16位二进制数
3. TYPE 运算符
    1. 格式： TYPE 变量或标号
    2. 功能： 返回变量或标号的类型值
    3. 对变量而言，类型返回值分别为： 1（DB）,2(DW),4(DD),8(DQ),10(DT)等，
    4. 对标号而言，类型返回值分别为： -1（NEAR）和 -2（FAR）
4. LENGTH 运算符
    1. 格式： LENGTH 变量
    2. 返回所占内存储单元内变量的个数
    3. LENGTH 操作符只与定义变量的伪指令后的第一个参数有关，若第一个参数的形式为“n DUP(表达式)”，则LENGTH运算的结果为n，否则为1
5. SIZE 运算符
    1. 格式 SIZE 变量
    2. 功能:  返回所占存储单元内变量的总字节数，即： SIZE = LENGTH * TYPE
6. HIGH 和 LOW 运算符
    1. 格式： HIGH 表达式       LOW 表达式
    2. 功能： 分离运算符，取字操作数的高位字节和低位字节
    3. 注意： 表达式必须具有常量值，如常数，地址表达式的偏移量等。HIGH 和 LOW 运算符不能对存储器或寄存器操作数进行分离。

#### 合成运算符
1. PTR 运算符
    1. 格式：新类型 PTR 变量 或 标号
    2. 功能： 将原有变量或标号的类型改变成新类型，这种改变是临时的，仅在有此操作符的语句内有效。
    3. 举例： 
        
        ```
        DAT DD 12345678H    ; 定义DAT 为双字类型的变量
        MOV AX WORD PTR DAT ; 从DAT中去一个字放置AX,(AX) = 5678H
        ```
2. THIS 运算符
    1. 格式： 变量或标号  EQU THIS 类型
    2. 功能： 定义变量或标号的类型为指定的类型。
    3. 如果指定的事变量，该变量的段地址和偏移地址与下一个定义的存储单元相同；
    4. 如果指定的事标号，则标号表示的是下一条指令的地址。
    5. 举例：
        
        ```
        NEXT1 EQU THIS FAR      ; 标号 NEXT1 被定义成FAR 类型，地址与NEXT相同
        NEXT: XOR AX, AX        ; 标号NEXT默认为NEAR 类型
        ···
        JMP  NEXT               ; 段内转移
        ···
        JMP NEXT1               ; 段间转移
        ```
3. SHORT 运算符
    1. 格式： SHORT 标号
    2. 功能： 说明其后的标号在距当前指令一个字节的范围内（-128 ~ 127），常用于转移指令，限制转移的目标地址的范围。

