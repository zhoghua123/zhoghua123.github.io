---
layout: post
title: 第三章：汇编语言程序设计
category: 汇编
tags: 汇编
description: 汇编
---

## 简介
1. 汇编语言的特点： 
    1. 汇编语言是一种用**符号表示**的，面向**CPU指令系统**的程序设计语言。
    2. 汇编语言对机器的依赖性很大，每种机器都有他专用的汇编语言。
    3. 用户必须对机器的硬件及软件资源有足够的了解才能设计汇编语言的程序。
2. 汇编语言的编译过程
    1. 源程序： 用汇编语言编写的程序称为**源程序**，文件的扩展名为**".asm"**.
        1. 可以用各种文件编辑软件编写ASM文件，该文件为ASCII码文件。
    2. 汇编： 用汇编语言编写的源程序在交付计算机执行之前，需要翻译成机器可直接识别和运行的二进制代码形式，这个翻译过程称为**汇编**，完成汇编任务的程序称为**汇编程序**
        1. 常用的汇编程序为MASM.EXE，此文件的作用是将ASCII码的源程序转换成用二进制代码表示的目标程序，也称为**OBJ文件**
        2. 在这个转换过程中，如果源程序中有语法错误，汇编程序将指出源程序中错误的位置及种类，提示用户修改源程序，知道源程序中没有语法错误，才能生成OBJ文件。
    3. 可执行程序（.EXE）
        1. CPU仍然不能运行由汇编程序汇编后生成的目标程序（OBJ）文件，必须经过**连接程序（LINK.EXE）**连接后，才能形成**可执行程序（.EXE）**。
        2. 因为目标程序文件中的有些指令的地址还未完全确定，另外可能需要将多个目标程序组合成一个功能更强的程序，或要和某些高级语言的目标程序进行连接，这些都需要由连接程序连接后才能形成可执行程序。
    4. 整个过程如下： 
        
         ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/huibian01.png)
3. 汇编语言语句分类
    1. 指令语句： 就是前面学习的指令系统
    2. 伪指令语句： 
        1. 伪指令语句不产生机器语言目标代码，而是指示、引到**汇编程序**在汇编过程中做一些操作，例如界定段的起始位置，为数据分配合适的存储单元
        2. 伪指令是在**汇编程序**运行时执行，在汇编阶段已经全部完成。
        3. 在目标程序中，不存在伪指令语句。
    3. 宏指令语句
        1. 宏指令是用户按照一定的规则自己设计的指令，是若干指令的集合，也就是用一条宏指令语句代替若干条指令语句，使用宏指令语句的目的主要是为了简化源程序
        2. 在汇编程序汇编时，还是将宏指令语句还原会指令语句的形式，转换成一条条机器目标代码的形式。
        3. 支持宏指令语句的汇编程序称为**“宏汇编程序”**，MASM.EXE就是宏汇编程序。
    
## 汇编语言程序的结构
### 汇编语言程序生成的可执行文件的结构
1. 汇编语言源程序（.ASM文件）经过汇编和连接后，通常生成EXE结构的可执行程序（扩展名为.EXE的文件），改文件由**操作系统**装入**内存**后才能运行。
2. EXE文件可以包含多个段，如代码段、数据段、堆栈段等，还可以有多个**逻辑**代码段和数据段。
3. 其在内存的具体结构如图所示：        
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/huibian02.png)
    1. 用户程序区占用内存的一部分，各个逻辑段的基地址一般是由系统指定的，可重装定位
    2. EXE程序由**文件头**和程序本身的二进制代码两部分组成。
    3. **文件头**也称为程序段前缀（PSP），占用256个字节，其中的信息时DOS装载可执行文件时自动生成的。
    4. DOS通过PSP向用户程序传递参数，为用户程序提供正常结束和异常结束时返回DOS的路径。。。。，总之，DOS是通过PSP管理用户程序的。
    5. 当程序结束返回DOS后，用户程序和他的程序段前缀所占用的空间均被释放，交换DOS另行分配。
    6. DOS自动给DS，ES,SS和CS赋值，使得DS = ES = 存放PSP的基地址，CS:IP = 用户程序的启动地址，SS:SP指向堆栈的栈顶，在这以后，DOS才把控制权交给用户程序。

### 汇编源程序的结构
> 8086/8088汇编语言源程序采用**分段结构**，一个完整的源程序可以包含多个逻辑段，如数据段、堆栈段和代码段等。
> 常用的伪指令如下:

1. 段定义伪指令
    


