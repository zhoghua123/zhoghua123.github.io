---
layout: post
title: 汇编进阶- 知识整合（二）
category: 汇编
tags: 汇编
description: 汇编
---

## 11. emu8086
1. 安装8086CPU模拟器
    1. `emu8086`双击安装，然后输入注册码即可
2. emu8086常用快捷键 
    1. F5：调试运行
    2. F4：重新加载
    3. F8：下一步（单步执行）
    4. F9：直接一步到位运行整个程序
    5. Ctrl + F8：跳过前面代码，断点到单击选中的代码那行
    6. 注意：emu8086的语法检查并非100%严格（比较严谨的还是使用MASM进行编译）

## 12. 编写完整的汇编程序
1. 前面的实验都是利用Debug程序进行模拟测试的，并没有编写一个完整的汇编程序
2. 使用汇编语言编写一个完整的程序，步骤大致如下
    1. 编写源代码，文件名拓展名为.asm
    2. 编译、链接（可以使用微软的MASM编译器）
    3. 调试、运行
3. 汇编语言的组成 
    1. 汇编语言由2类指令组成
        1. 汇编指令
            1. `如：mov、add、sub等`
            2. 有对应的机器指令，可以被编译为机器指令，最终被CPU执行
        2. 伪指令
            1. `如assume、 segment、ends、end等`
            2. 没有对应的机器指令，由编译器解析，最终不被CPU执行
    2. 注释以分号开头
4. 伪指令 – segment、ends、end 
    1. segment和ends的作用是定义一个段，segment代表一个段的开始，ends代表一个段的结束，使用格式为
        
        ```
        段名 segment
            ...
        段名 ends
        ```
    2. 一个有意义的汇编程序中，至少要有一个段作为代码段存放代码
    3. assume
        1. 声明一下code段是cs段、代码段
        2. `assume cs ： 段名`
    2. end
        2. 编译器遇到end时，就结束对源程序的编译
5. 退出程序
    1. 下面2句代码的作用是退出程序
        
        ```
        mov ah，4ch
        int 21h
        ```
    2. 也可以写成
        
        ```
        mov ax, 4c00h
        int 21h
        ```

## 13. 中断
1. 中断
    1. 中断是由于软件的或硬件的信号，使得CPU暂停当前的任务，转而去执行另一段子程序
    2. 也就是说，在程序运行过程中，系统出现了一个必须由CPU立即处理的情况，此时，CPU暂时中止当前程序的执行转而处理这个新情况的过程就叫做中断
2. 中断的分类
    1. 硬中断（外中断），由外部设备(比如网卡、硬盘)随机引发的，比如当网卡收到数据包的时候，就会发出一个中断
    2. 软中断（内中断），由执行中断指令产生的，可以通过程序控制触发
3. 可以通过指令int n产生中断
    1. n是中断码，内存中有一张中断向量表，用来存放中断码对应中断处理程序的入口地址
    2. CPU在接收到中断信号后，暂停当前正在执行的程序，跳转到中断码对应的中断向量表地址处，去执行中断处理程序
4. 常见中断
    1. `int 10h`用于执行BIOS中断
    2. `int 3`是“断点中断”，用于调试程序
    3. `int 21h`用于执行DOS系统功能调用，AH寄存器存储功能号
        1. DOS系统有很多功能子程序,每个子程序用**功能号**表示，那么，怎么知道调用哪一个呢？ 
        2. AH寄存器就是制定调用DOS系统的哪一个功能子程序。
            
            ```
            ; 调用DOS系统的功能号为9h的子程序-屏幕显示字符串
            mov ah,9h ;相当于函数的参数
            int 21h    ;相当于调用函数
            ```
4. 中断可以简单的理解为操作系统自带的一些编写好的程序，这些程序可以实现一些功能，可以通过硬件设备、代码直接调用
5. DOS系统功能调用 
    1. 由DOS提供的一组实现特殊功能的子程序供程序员在编写自己的程序时调用，以减轻编程的工作量
    2. 涉及屏幕显示、文件管理、I/O管理等等
    3. 每个子程序都有一个功能号，所有的功能调用的格式都是一致的。调用的步骤大致如下：
        1. 系统功能号送到寄存器AH中；
        2. 入口参数送到指定的寄存器中；
        3. 用INT 21H指令执行功能调用；
        4. 根据出口参数分析功能调用执行情况 
6. 代码举例：打印字符串
    
    ```
    assume cs:code, ds:data

    ; 数据段
    data segment
        db 40, 41, 42, 64, 'Hello World!$' 
    data ends
    
    ; 代码段
    code segment  
         ;start：  程序标号，告诉系统程序从这里开始 
    start:    
        ; 设置ds的值
        mov ax, data
        mov ds, ax   
        ;DOS系统打印字符串的要求:所打印的字符串必须由DS:DX给出
        mov dx, 4h
        
        ; DOS系统打印ds:dx所指的字符串 
        mov ah, 9h
        int 21h
    
        ; 退出程序
        mov ax, 4c00h
        int 21h
    code ends  
      ; 程序入口在start
    end start 

    ```


