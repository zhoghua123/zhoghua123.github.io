---
layout: post
title: 汇编一 - 简介、总线、内存、寻址
category: 汇编
tags: 汇编
description: 汇编
---

##  汇编语言简介

### 汇编语言的发展
1. 机器语言
    1. 由0和1组成
2. 汇编语言（Assembly Language）
    1. 用符号代替了0和1，比机器语言便于阅读和记忆
3. 高级语言
    1. C\C++\Java\Swift等，更接近人类自然语言
4. 操作：将寄存器BX的内容送入寄存器AX
    1. 机器语言：1000100111011000
    2. 汇编语言：mov ax, bx
    3. 高级语言：ax = bx;
5. 如下图：

    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/hbjj01.png)
    
    1. **汇编语言**与**机器语言**一一对应，每一条机器指令都有与之对应的汇编指令
    2. 汇编语言可以通过编译得到机器语言，机器语言可以通过反汇编得到汇编语言
    3. 高级语言可以通过编译得到汇编语言\机器语言，但汇编语言\机器语言**几乎不可能**还原成高级语言
        1. 因为高级语言写不同的代码可能汇编语言是一样的。
  
### 汇编语言的特点
1. 可以直接访问、控制各种硬件设备，比如存储器、CPU等，能最大限度地发挥硬件的功能
2. 汇编指令是机器指令的助记符,同机器指令一一对应。每一种CPU都有自己的机器指令集\汇编指令集，所以汇编语言不具备可移植性
3. 知识点过多，开发者需要对CPU等硬件结构有所了解，不易于编写、调试、维护
4. **不区分大小写**，比如mov和MOV是一样的
    
### 汇编语言的用途
1. 编写驱动程序、操作系统（比如Linux内核的某些关键部分）
2. 对性能要求极高的程序或者代码片段，可与高级语言混合使用（内联汇编）
3. 软件安全
    1. 病毒分析与防治
    2. 逆向\加壳\脱壳\破解\外挂\免杀\加密解密\漏洞\黑客
4. 是理解整个计算机系统的最佳起点和最有效途径
5. 为编写高效代码打下基础

### 汇编语言的种类
1. 目前讨论比较多的汇编语言有
    1. 8086汇编（8086处理器是16bit的CPU）
    2. Win32汇编
    3. Win64汇编
    4. AT&T汇编（Mac、iOS模拟器）
        1. 因为iOS的模拟器是运行在MAC上的，所以是MAC
    5. ARM汇编（嵌入式、iOS设备）
    6. ...
2. 入门建议先从学些8086汇编开始
    1. 结构简洁、经典
    2. 参考书籍：王爽《汇编语言》
    
### 学前须知
1. 要想学好汇编语言，首先要对CPU等硬件结构有一定的了解
2. 软件\程序的执行过程如下：
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/hbjj02.png)
3. 最为关键的是需要了解CPU和内存
4. 在学习汇编语言过程中，遇到的绝大部分指令都是跟内存、CPU有关的
    
## 总线
1. 每一个CPU芯片都有许多管脚，这些管脚和总线相连，CPU通过总线跟外部器件进行交互
2. 总线：一根根导线的集合
3. 总线的分类
    1. 地址总线
    2. 数据总线
    3. 控制总线
4. 视图：
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/hbjj03.png)
    
5. 三种总线的使用：
    1. CPU从内存的3号单元读取数据
       ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/hbjj04.png) 
        1. 通过地址总线将3这个数据输送到内存，内存就会知道要访问第3个单元的数据
            1. 即地址总线用来寻址，寻找某个内存空间
            2. 用数电知识来解析就是存储器的哪些单元的引脚有效
        2. 控制总线告诉内存是要读取还是写这个单元，此时为读
            1. 用于控制读写
            2. 用数电的知识解析就是用来控制数据总线连接的晶闸管正向还是逆向导通。
        3. 这个时候就会通过数据总线将这个数据（08）传送给CPU。
            1. 用来传送数据
            2. 用数电的知识解析就是通过数据总线上的电平高低来获取二进制数据。
6. 地址总线
    1. 它的宽度决定了CPU的寻址能力
    2. 8086的地址总线宽度是20，所以寻址能力是1M（ 2^20  ）
7. 数据总线
    1. 它的宽度决定了CPU的单次数据传送量，也就是数据传送速度
    2. 8086的数据总线宽度是16，所以单次最大传递2个字节的数据
8. 控制总线
    1. 它的宽度决定了CPU对其他器件的控制能力、能有多少种控制

## 内存
1. 各类存储器的逻辑连接情况
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/hbjj05.png) 
    
    1. RAM与ROM区别？
        1. ROM: read Only memory 只读存储器，一般存放的以设备硬件相关的东西。
        2. RAM: 随机存储器，可读可写的。
2. 8086的内存
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/hbjj06.png) 
    
    1. 所有的内存单元都有唯一的地址，叫做物理地址
    2. 各类存储器的物理地址情况
        1. 内存地址空间的大小受CPU地址总线宽度的限制。8086的地址总线宽度为20，可以定位2^20个不同的内存单元（内存地址范围0x00000~0xFFFFF），所以8086的内存空间大小为1MB
        2. 0x00000~0x9FFFF：主存储器。可读可写
        3. 0xA0000~0xBFFFF：向显存中写入数据，这些数据会被显卡输出到显示器。可读可写
        4. 0xC0000~0xFFFFF：存储各种硬件\系统信息。只读
3. 下图是各类存储器的逻辑连接-物理地址对应图
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/hbjj07.png) 

## 8086的寻址方式
1. CPU访问内存单元时，要给出内存单元的地址
2. 8086有20位地址总线，可以传送20位的地址，1M的寻址能力
3. 但它又是16位结构的CPU，它内部能够一次性处理、传输、暂时存储的地址为16位。如果将地址从内部简单地发出，那么它只能送出16位的地址，表现出来的寻址能力只有64KB  

    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/hbjj08.png) 
4. 8086采用一种在内部用2个16位地址合成的方法来生成1个20位的物理地址
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/hbjj09.png) 
    
    1. CUP中的相关部件提供2个16位的地址，一个称为段地址，另一个称为偏移地址
    2. 段地址和偏移地址通过内部总线送入一个称为地址加法器的部件
    3. 地址加法器将两个16位地址合成为一个20位物理地址
    4. 地址加法器通过内部总线将20位物理地址送入输入输出控制电路
    4. 输入输出控制电路将20位物理地址送上地址总线
    5. 20位物理地址被地址总线传送到存储器
5. 地址加法器采用**物理地址= 段地址*16 + 偏移地址**的方法，用段地址和偏移地址合成物理地址。


