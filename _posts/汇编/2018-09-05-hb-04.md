---
layout: post
title: 第二章：8086/8088的指令系统（三）
category: 汇编
tags: 汇编
description: 汇编
---

### 串操作指令
1. 简介
    1. 计算机在处理数据时，经常要对一组数据进行处理，这样的一组数据称为数据串
    2. 由字节组成的数据串称为字节串；同理由字组成的数据串最长可达64KB。
    3. 针对数据块或者字符串的操作。
    4. 可实现存储器到存储器的数据传送
2. 8086/8088指令系统中有专门的串操作指令，可以对数据串进行多种操作，但所有串操作指令必须遵循一些基本的规则。
    1. 无论是字节串还是字串，所处理数据的**个数**都存放在**CX**中，在有**串前缀**的前提下，每执行一次操作CX自动减1，直至减到0，串操作自动停止； 如果**没有串前缀**，需要有指令设置并判断CX。     
    2. 串操作指令的源操作数src和目的操作数dest都在内存中，是唯一一条从内存到内存的指令。串所在的区域及首地址：
        1. 源串**一般**存放在数据段，偏移地址由SI指定，即DS:[SI]，支持段超越
        2. 目的串**必须**在附加段，偏移地址有DI指定，即ES:[DI]
    3. 在串操作前要首先设置方向标志位DF。当DF = 1，指示源和目的操作数位置的偏移地址（SI）和（DI）自动由高至低，减量进行串操作，当串为字节串时，每操作一次，（SI）和（DI）减1，当串为字串时，每操作一次，（SI）和（DI）减2； 当DF = 0时，指示源和目的操作数位置的偏移地址（SI）和（DI）自动由低至高，增量进行串操作，当串为字节串时，每操作一次，（SI）和（DI）加1，当串为字串时，每操作一次，（SI）和（DI）加2
    4. 串前缀：（重复前缀）
        1. 无条件重复
            1. REP
            2. 当CX != 0时，REP后的指令将继续重复执行
            3. 常用于传送类指令前：未传完则继续传送
        2. 条件重复
            1. 相等（相减为零）重复： REPE(REPZ)
                1. CX != 0 && ZF == 1，则前缀后的指令将继续重复执行。
            2. 不相等（相减不为零）重复： REPNE(REPNZ)
                1. CX != 0 && ZF == 0，则前缀后的指令将继续重复执行。
            3. 条件前缀常用于运算类指令前，两个数的比较
3. 串操作指令实际流程
    1. 取源串地址
    2. 取目标串地址
    3. 设串长度
    4. 设操作方向
    5. 完成一个字节或字操作
    6. 修改地址指针
    7. 修改串长度值
    8. 判断是否完成
    9. 没完成回到第5步
    10. 完成结束

#### 串传送指令
1. 格式：`MOVSB ;字节传送  MOVSW ;字传送`
2. 指令功能：
    1. 将位于DS段，由（SI）所指出的存储单元的字节或字数据传送到位于ES段，由（DI）所指的存储单元中，即DS:[SI]->ES:[DI],若DF=1,(DI)-n->(DI),(SI)-n->(SI);若DF = 0,(DI)+n->(DI),(SI)+n->(SI).
    2. 其中，当使用指令MOVSW时，n=1；使用指令MOVSW时，n=2。
3. 串传送指令常于无条件重复前缀连用

#### 串比较指令
1. 格式：`CMPSB;字节比较 CMPSW ;字比较`
2. 指令功能：（目标串-源串，结果丢弃）
    1. 将位于DS段由（SI）所指出的存储单元的字节或字数据与ES段由（DI）所指的字节或字数据相比较，比较结果仅影响标志位。
    2. 通过串前缀REPZ的控制，可以在两个数据串中寻找第一个不相等的字节或字数据；
    3. 通过串前缀PEPNZ的控制，可以在两个数据串中寻找一个相等的字节或字数据。

#### 串检索指令
1. 格式：`SCASB;字节 SCASW ;字`
2. 功能：
    1. 将AL或AX中的值与位于ES段由(DI)所指出的存储单元中的字节或字数据进行比较，比较结果仅影响标志位
    2. 通过串前缀REPZ的控制，可以在数据串中寻找第一个与AL或AX不相等的字节或字数据；
    3. 通过串前缀REPBZ的控制，可以在数据串中寻找第一个与AL或AX相等的字节或字数据；
    4. 比较之后自动按照串操作指令的规则修改操作数地址指针。即（AL）-ES: [DI]或(AX)-ES:[DI+1][DI],若DF = 1,(DI)-n->(DI);若DF = 0,(DI)+n->(DI),其中，字是n = 2，字节n = 1；

#### 读数据串指令
1. 格式： `LODSB;字节 LODSW ;字`
2. 功能：
    1. 将位于DS段由（SI）所指出的存储单元的字节或者字数据传送至（AL）或（AX），并自动按照串操作指令的规则修改操作数地址指针。
    2. 即： DS:[SI]->(AL)或 DS:[SI+1][SI]->(AX),若DF = 1,(SI)-n ->(SI); 若DF = 0,(SI)+n -> (SI) ; n 同上

#### 写数据串指令
1. 格式： `STOSB;字节 STOSW ;字`
2. 指令功能：
    1. 将AL或AX中的字节或字数据写入位于ES段由（DI）所指出的存储单元中，并自动按照串操作指令的规则修改操作数地址指针。
    2. 即 （AL）->ES:[DI] 或 （AX）->ES:[DI+1][DI],若DF=1,(DI)-n->(DI);若DF=0,(DI)+n->(DI).

