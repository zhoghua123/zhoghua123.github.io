---
layout: post
title: ARM64汇编
category: iOS底层
tags: ARM64
description: ARM64
---

## 简介
1. 学习汇编主要学习一下几点
    1. 寄存器
    2. 指令系统
    3. 堆栈
    4. 中断系统（嵌入式才学）
2. lldb 汇编相关常用指令：
    1. memory read
        1. 读取所有寄存器的值
        2. 用这个指令也可以看RAM64总共有那些寄存器。
    2. memory write  寄存器  值
        1. 给某个寄存器写入值
    3. po $x0：打印方法调用者
    4. x/s $x1：打印方法名
    5. po $x2：打印参数（以此类推，x3、x4也可能是参数）
    6. 如果是非arm64，寄存器就是r0、r1、r2


## 寄存器
1. 通用寄存器
    1. 64bit􏰋􏰌的：x0 ~ x28
    2. 32bit􏰋􏰌的：w0 ~ w28（􏰍􏰎􏰏属于x0 ~ x28􏰋􏰐的低32bit􏰑）
    3. x0 ~ x7通常拿来存放函数的参数，更多的参数使用堆栈来传递
    4. x0 通常拿来存放函数的返回值。
2. 程序计数器
    1. pc􏰍 (Program Counter􏰑)
    2. 记录CPU当前指令的是哪一条指令。
    3. 存储着当前CPU正在执行的指令的地址。
    4. 类似于8086汇编的IP寄存器
3. 堆栈指针
    1. sp􏰍(Stack Pointer􏰑)
    2. fp(􏰍Frame Pointer􏰑􏰙􏰼􏰽􏰭)，也就是x29
4. 链接寄存器
    1. lr(􏰍Link Register),也就是X30
    2. 存储着函数的返回地址
5. 程序状态寄存器
    1. cpsr (􏰍Current Program Status Register􏰑􏰑)
    2. spsr 􏰍(Saved Program Status Register􏰑􏰙􏱂􏰒􏱀􏱁􏱃􏰜􏰊),异常状态下使用
        ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/CPSR01.png)
        ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/CPSR02.png)
    
## ARM64常用的指令
1. mov
    1. 格式：`mov 目的寄存器，源操作数`
    2. 作用：指令可完成从另一个寄存器、被移位的寄存器或将一个立即数加载到目的寄存器
    3. 这个方式跟8086相同
2. ret
    1. 作用：函数返回
    2. 将lr（x30）寄存器的值复制给PC寄存器。   
3. ADD
    1. 格式为: ADD 目的寄存器，操作数 1，操作数 2
    2. 作用： ADD 指令用于把两个操作数相加，并将结果存放到目的寄存器中。操作数 1 应是一个寄存器，操
作数 2 可以是一个寄存器，被移位的寄存器，或一个立即数。
    3. 举例：
        1. `ADD x0，x1，x2 ; x0 = x1+x2`
4. SUB 指令
    1. 格式为: SUB 目的寄存器，操作数 1，操作数 2
    2. 作用：SUB 指令用于把操作数 1 减去操作数 2，并将结果存放到目的寄存器中。操作数 1 应是一个寄存 器，操作数 2 可以是一个寄存器，被移位的寄存器，或一个立即数。该指令可用于有符号数或无符 号数的减法运算。
5. CMP 指令
    1. 格式为: CMP 操作数 1，操作数 2
    2. 作用:CMP 指令用于把一个寄存器的内容和另一个寄存器的内容或立即数进行比较，同时更新 CPSR 中条件标志位的值。该指令进行一次减法运算，但不存储结果，只更改条件标志位。标志位表示的是 操作数 1 与操作数 2 的关系(大、小、相等)，例如，当操作数 1 大于操作操作数 2，则此后的有 GT 后缀的指令将可以执行。
6. B 指令
    1. 格式为: B 目标地址
    2. 作用：B 指令是最简单的跳转指令。一旦遇到一个 B 指令，ARM 处理器将立即跳转到给定的目标地址，从那里继续执行。
7.

## ARM指令系统注意事项
1. 立即数都要以#开头
    1. 比如：`mov x1, #0x2`


