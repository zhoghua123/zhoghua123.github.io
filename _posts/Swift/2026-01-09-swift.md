---
layout: post
title: Swift第十二章 函数式编程
category: Swift
tags: Swift
description: Swift
---

## Array的map与flatMap
### Array的常见操作
1. 代码示例
    
    ```
    var arr = [1, 2, 3, 4]
    // [2, 4, 6, 8],遍历数组每一个元素，然后对每个元素进行处理，最后生成一个新的数组
    var arr2 = arr.map { $0 * 2 }
    
    // [2, 4]，过滤，遍历数组每一个元素，然后能够被2整除的数保留，最后生成一个新的数组
    var arr3 = arr.filter { $0 % 2 == 0 }
    
    //遍历数组每一个元素，reduce(0)中的为初始值0，用每个元素+初始值结果作为下一次遍历的初始值，然后将最后累加结果作为返回值。
    // 10  $0上一次遍历返回的结果（初始值为0），$1每次遍历的元素值
    var arr4 = arr.reduce(0) { $0 + $1 }
    // 10
    var arr5 = arr.reduce(0, +)
    
    func double(_ i: Int) -> Int { i * 2 }
    var arr = [1, 2, 3, 4]
    // [2, 4, 6, 8] 将double作为参数传递给map
    print(arr.map(double))
    
    var arr = [1, 2, 3]
    // [[1], [2, 2], [3, 3, 3]]
    var arr2 = arr.map { Array.init(repeating: $0, count: $0) }
    // [1, 2, 2, 3, 3, 3]  ，将所有数组都合并成一个数组
    var arr3 = arr.flatMap { Array.init(repeating: $0, count: $0) }
    
    var arr = ["123", "test", "jack", "-30"]
    // [Optional(123), nil, nil, Optional(-30)]
    var arr2 = arr.map { Int($0) }
    // [123, -30]  只保存，转化成功的结果
    var arr3 = arr.compactMap { Int($0) } 
    
    // 使用reduce实现map、filter的功能
    var arr = [1, 2, 3, 4]
    // [2, 4, 6, 8]
    print(arr.map { $0 * 2 })
    print(arr.reduce([]) { $0 + [$1 * 2] })
    
    // [2, 4]
    print(arr.filter { $0 % 2 == 0 })
    print(arr.reduce([]) { $1 % 2 == 0 ? $0 + [$1] : $0 })
    ```

### lazy的优化
1. 示例
    
    ```
    let arr = [1, 2, 3]
    //使用了lazy之后，可以发现当需要真正使用到result的某个元素之后，才会真正的去map遍历
    let result = arr.lazy.map {
    (i: Int) -> Int in
    print("mapping \(i)")
    return i * 2
    }
    print("begin-----")
    print("mapped", result[0])
    print("mapped", result[1])
    print("mapped", result[2])
    print("end----")
    ```
2. 打印：
    
    ```
    begin----
    mapping 1
    mapped 2
    mapping 2
    mapped 4
    mapping 3
    mapped 6
    end----
    ```