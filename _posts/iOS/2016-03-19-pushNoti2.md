---
layout: post
title: æ¨é€é€šçŸ¥(äºŒ)-iOS>10çš„æ¨é€é€šçŸ¥
category: iOSå¼€å‘
tags: æ¨é€é€šçŸ¥
description: æ¨é€é€šçŸ¥
---

> æ¥ä¸‹æ¥ä¸»è¦è®²çš„æ˜¯iOS10çš„æ¨é€é€šçŸ¥

## ç®€ä»‹
1. iOS10æ–°åŠ äº†ä¸€ä¸ªç‹¬ç«‹æ¡†æ¶ï¼š**UserNotification.framework**,åºŸå¼ƒäº† UILocalNotificationï¼ˆåœ¨UIKit.frameworkä¸­ï¼‰è¿™ä¸ªç±»ï¼Œé‡‡ç”¨äº†å…¨æ–°çš„UserNotifications.frameworkæ¥æ¨é€é€šçŸ¥ï¼Œä»æ­¤æ¨é€é€šçŸ¥ä¹Ÿæœ‰äº†è‡ªå·±çš„æ ‡ç­¾UNï¼ˆ,ä»¥åŠå¯¹æ¨é€åŠŸèƒ½çš„ä¸€ç³»åˆ—å¢å¼ºæ”¹è¿›ï¼ˆä¸¤ä¸ªextension,å»¶å±•)å’Œç•Œé¢çš„ä½“éªŒä¼˜åŒ–ï¼‰ã€‚
2. åºŸè¯ä¸å¤šè¯´,å­¦ä¹ ä¸€ä¸ªæ–°çš„æ¡†æ¶å½“ç„¶å°±æ˜¯ä»ä»–å¸¸ç”¨çš„ç±»å¼€å§‹

## å¸¸è§ç±»ä¹‹é—´çš„å…³ç³»
1. è¯¥æ¡†æ¶çš„ç±»çš„ç»“æ„åˆ†ä¸º2éƒ¨åˆ†
    1. ç®¡ç†é€šçŸ¥ç›¸å…³çš„ç±»     
        ![å›¾1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/ç®¡ç†é€šçŸ¥ç›¸å…³ç±».png)  
    2. åˆ›å»ºé€šçŸ¥ç›¸å…³çš„ç±»     
        ![å›¾1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/åˆ›å»ºé€šçŸ¥ç›¸å…³ç±».png)  

## æœ¬åœ°é€šçŸ¥
1. è®¾ç½®é€šçŸ¥å†…å®¹
    1. åˆ›å»ºé€šçŸ¥å†…å®¹å¯¹è±¡
    2. è®¾ç½®å±æ€§
    3. è®¾ç½®é€šçŸ¥çš„é™„ä»¶:è§†é¢‘/éŸ³é¢‘/å›¾ç‰‡/gif
    4. è®¾ç½®äº’äº¤ç±»å‹
2. è®¾ç½®é€šçŸ¥è§¦å‘æœºåˆ¶
3. åˆ›å»ºä¸€ä¸ª`UNNotificationRequest`ç±»çš„å®ä¾‹    
    1. ä¸€å®šè¦ä¸ºå®ƒè®¾ç½®`identifier`, åœ¨åé¢çš„æŸ¥æ‰¾ï¼Œæ›´æ–°ï¼Œ åˆ é™¤é€šçŸ¥ï¼Œè¿™ä¸ªæ ‡è¯†æ˜¯å¯ä»¥ç”¨æ¥åŒºåˆ†è¿™ä¸ªé€šçŸ¥ä¸å…¶ä»–é€šçŸ¥
    2. å¦‚æœå¦ä¸€ä¸ª`request`å…·æœ‰å’Œä¹‹å‰`request`ç›¸åŒçš„æ ‡è¯†ï¼Œä¸åŒçš„å†…å®¹ï¼Œ å¯ä»¥è¾¾åˆ°æ›´æ–°é€šçŸ¥çš„ç›®çš„
4. æŠŠ`request`åŠ åˆ°`UNUserNotificationCenter`ï¼Œ å¹¶è®¾ç½®è§¦å‘å™¨ï¼Œç­‰å¾…è§¦å‘
3. ä»£ç ä¸¾ä¾‹å¦‚ä¸‹:
    
    ```javascript
    //æ¨é€æœ¬åœ°é€šçŸ¥ï¼š//ä½¿ç”¨UNNotificationæœ¬åœ°é€šçŸ¥
    -(void)sendLocalNotification{
        //1. è®¾ç½®é€šçŸ¥å†…å®¹
        //éœ€åˆ›å»ºä¸€ä¸ªåŒ…å«å¾…é€šçŸ¥å†…å®¹çš„UNMutableNotificationContentå¯¹è±¡ï¼Œæ³¨æ„ä¸æ˜¯UNNotificationContent ,æ­¤å¯¹è±¡ä¸ºä¸å¯å˜å¯¹è±¡ã€‚
        UNMutableNotificationContent *content = [[UNMutableNotificationContent alloc] init];
        //é€šçŸ¥ä¸»æ ‡é¢˜
        content.title = @"ä¸»æ ‡é¢˜";
        //é€šçŸ¥å­æ ‡é¢˜
        content.subtitle = @"å­æ ‡é¢˜";
        //è®¾ç½®é€šçŸ¥çš„å†…å®¹
        content.body = @"è¿™æ˜¯é€šçŸ¥çš„å†…å®¹????????????????????????";
        //æˆ–è€…ä¹Ÿå¯ä»¥è¿™æ ·åˆ›å»ºï¼š
        //content.title = [NSString localizedUserNotificationStringForKey:@"ä¸»æ ‡é¢˜" arguments:nil];
        //content.body= [NSString localizedUserNotificationStringForKey:@"Hello_message_body" arguments:nil];
        //è®¾ç½®åº”ç”¨ç¨‹åºå›¾æ ‡å³ä¸Šè§’çš„æ•°å­—
        content.badge = @0;
        //è®¾ç½®æœ‰é€šçŸ¥æ—¶çš„éŸ³æ•ˆ
        UNNotificationSound *sound = [UNNotificationSound defaultSound];
        content.sound = sound;
        
        //è®¾ç½®é€šçŸ¥çš„é™„ä»¶:é€šçŸ¥å³è¾¹çš„å›¾ç‰‡
        //å°†æœ¬åœ°å›¾ç‰‡çš„è·¯å¾„å½¢æˆä¸€ä¸ªå›¾ç‰‡é™„ä»¶ï¼ŒåŠ å…¥åˆ°contentä¸­
        NSString *path = [[NSBundle mainBundle] pathForResource:@"beautiful" ofType:@"png"];
        NSError *error = nil;
        UNNotificationAttachment *img_attachment = [UNNotificationAttachment attachmentWithIdentifier:@"att1" URL:[NSURL fileURLWithPath:path] options:nil error:&error];
        content.attachments = @[img_attachment];
        
        //è®¾ç½®ä¸º@""ä»¥åï¼Œè¿›å…¥appå°†æ²¡æœ‰å¯åŠ¨é¡µ
        content.launchImageName = @"";
        
        //é€šçŸ¥çš„äº’äº¤ç±»å‹,Identifierå¯ä¸æ˜¯ä¹±å†™çš„è€Œæ˜¯,åœ¨æ³¨å†Œé€šçŸ¥æ—¶è®¾ç½®å¥½çš„
        content.categoryIdentifier = @"seeCategory1";
        //è®¾ç½®é¢å¤–ä¿¡æ¯(æ¯”å¦‚:å‘Šè¯‰appç‚¹å‡»é€šçŸ¥æ—¶è·³è½¬åˆ°å“ªä¸€ä¸ªç•Œé¢)
        content.userInfo = @{@"type" : @1 };
        
        //2. è®¾ç½®é€šçŸ¥è§¦å‘æœºåˆ¶
        //é€šçŸ¥è§¦å‘æœºåˆ¶
        //UserNotificationsæä¾›äº†ä¸‰ç§è§¦å‘å™¨ï¼š
        //UNTimeIntervalNotificationTriggerï¼šä¸€å®šæ—¶é—´åè§¦å‘ï¼ˆè‹¥é‡å¤æé†’ï¼Œæ—¶é—´é—´éš”è¦å¤§äº60sï¼‰
        //UNCalendarNotificationTriggerï¼šåœ¨æŸæœˆæŸæ—¥æŸæ—¶è§¦å‘
        //UNLocationNotificationTriggerï¼šåœ¨ç”¨æˆ·è¿›å…¥æˆ–æ˜¯ç¦»å¼€æŸä¸ªåŒºåŸŸæ—¶è§¦å‘
        //UNPushNotificationTrigger: è¿œç¨‹æ¨é€
        //è®¾ç½®é€šçŸ¥å‘å‡ºçš„æ—¶é—´
        UNTimeIntervalNotificationTrigger *time_trigger = [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:5 repeats:NO];
        
        //3.åˆ›å»ºé€šçŸ¥è¯·æ±‚
        //åˆ›å»ºUNNotificationRequesté€šçŸ¥è¯·æ±‚å¯¹è±¡//åˆ›å»ºä¸€ä¸ªå‘é€è¯·æ±‚
        //é€šçŸ¥è¯·æ±‚æ ‡è¯†,ä¾¿äºç®¡ç†è¯¥é€šçŸ¥
        NSString *requestIdentifer = @"time interval request";
        UNNotificationRequest *request = [UNNotificationRequest requestWithIdentifier:requestIdentifer content:content trigger:time_trigger];
        
        //4.å°†é€šçŸ¥è¯·æ±‚æ·»åŠ åˆ°é€šçŸ¥ä¸­å¿ƒ
        [[UNUserNotificationCenter currentNotificationCenter] addNotificationRequest:request withCompletionHandler:^(NSError * _Nullable error) {}];
    }

    ```
4. æ ¹æ®ä¸Šé¢å†…å®¹ï¼Œå¤§å®¶ä¼šå‘ç°åœ¨åˆ›å»ºUNNotificationRequestçš„æ—¶å€™ï¼Œä¼šéœ€è¦UNMutableNotificationContentä»¥åŠUNTimeIntervalNotificationTriggerè¿™ä¸¤ä¸ªç±»ã€‚ä¸‹é¢æˆ‘å°±å¯¹ç›¸å…³çš„ç±»ï¼Œä»¥åŠç±»æ‰©å±•ï¼Œåšç›¸åº”çš„è¯´æ˜

### UNNotificationContentä»¥åŠUNMutableNotificationContentï¼ˆé€šçŸ¥å†…å®¹å’Œå¯å˜é€šçŸ¥å†…å®¹ï¼‰
1. é€šçŸ¥å†…å®¹åˆ†ä¸ºå¯å˜çš„ä»¥åŠä¸å¯å˜çš„ä¸¤ç§ç±»å‹ï¼Œç±»ä¼¼äºå¯å˜æ•°ç»„è·Ÿä¸å¯å˜æ•°ç»„ã€‚
2. åç»­æˆ‘ä»¬é€šè¿‡æŸä¸€ç‰¹å®šæ ‡è¯†ç¬¦æ›´æ–°é€šçŸ¥ï¼Œä¾¿æ˜¯ç”¨å¯å˜é€šçŸ¥äº†ã€‚
3. ä¸ç®¡æ˜¯å¯å˜é€šçŸ¥è¿˜æ˜¯ä¸å¯å˜é€šçŸ¥ï¼Œéƒ½æœ‰ä»¥ä¸‹çš„å‡ ä¸ªå±æ€§ï¼š
    1. é™„ä»¶æ•°ç»„ï¼Œå­˜æ”¾UNNotificationAttachmentç±»
    
        ```
        @property (NS_NONATOMIC_IOSONLY, copy) NSArray <UNNotificationAttachment *> *attachments ;
        ```
    2. åº”ç”¨ç¨‹åºè§’æ ‡ï¼Œ0æˆ–è€…ä¸ä¼ ï¼Œæ„å‘³ç€è§’æ ‡æ¶ˆå¤±
        
        ```
        @property (NS_NONATOMIC_IOSONLY, copy, nullable) NSNumber *badge;
        ```
    3. ä¸»ä½“å†…å®¹
        
        ```
        @property (NS_NONATOMIC_IOSONLY, copy) NSString *body ;
        ```
    4. ç‚¹å‡»é€šçŸ¥å¯åŠ¨appæ—¶çš„å›¾æ ‡
        1. ç¨‹åºåœ¨åå°æ—¶,æ­¤æ—¶ç¨‹åºæ²¡æœ‰æ€æ­»
        2. è®¾ç½®ä»»æ„å­—ç¬¦ä¸²å³å¯,åªä¼šæ˜¾ç¤ºå¯åŠ¨å›¾ç‰‡çš„å›¾æ ‡
        
        ```
        @property (NS_NONATOMIC_IOSONLY, copy) NSString *launchImageName;
        ```
    5. `UNNotificationSound`ç±»ï¼Œå¯ä»¥è®¾ç½®é»˜è®¤å£°éŸ³ï¼Œæˆ–è€…æŒ‡å®šåç§°çš„å£°éŸ³
        
        ```
        @property (NS_NONATOMIC_IOSONLY, copy, nullable) UNNotificationSound *sound ;
        ```
    6. æ¨é€å†…å®¹çš„å­æ ‡é¢˜
        
        ```
        @property (NS_NONATOMIC_IOSONLY, copy) NSString *subtitle ;
        ```
    7. é€šçŸ¥çº¿ç¨‹çš„æ ‡è¯†
        
        ```
        @property (NS_NONATOMIC_IOSONLY, copy) NSString *threadIdentifier;
        ```
    8. æ¨é€å†…å®¹çš„æ ‡é¢˜
        
        ```
        @property (NS_NONATOMIC_IOSONLY, copy) NSString *title ;
        ```
    9. è¿œç¨‹é€šçŸ¥é™„åŠ çš„é¢å¤–ä¿¡æ¯
        
        ```
        @property (NS_NONATOMIC_IOSONLY, copy) NSDictionary *userInfo;
        ```
    10. é€šçŸ¥çš„äº’äº¤ç±»å‹
        1. Identifierå¯ä¸æ˜¯ä¹±å†™çš„,è€Œæ˜¯åœ¨é€šçŸ¥ä¸­å¿ƒ(`UNUserNotificationCenter`)åœ¨ç¨‹åºå¯åŠ¨æ³¨å†Œåº”ç”¨é€šçŸ¥æ—¶ç»™æ•´ä¸ªåº”ç”¨ç¨‹åºè®¾ç½®çš„æ‰€æœ‰äº’äº¤ç±»å‹,å¹¶ä¸”æ¯ä¸ªäº’äº¤ç±»å‹éƒ½æœ‰å®ƒçš„Identifier
        
        ```
        @property (NS_NONATOMIC_IOSONLY, copy) NSString *categoryIdentifier;
        ```
    
    
#### UNNotificationAttachment
 1. åœ¨UNNotificationContentç±»ä¸­ï¼Œæœ‰ä¸ªé™„ä»¶æ•°ç»„çš„å±æ€§ï¼Œè¿™å°±æ˜¯åŒ…å«UNNotificationAttachmentç±»çš„æ•°ç»„äº†ã€‚
 2. è‹¹æœçš„è§£é‡Šè¯´ï¼ŒUNNotificationAttachmentï¼ˆé™„ä»¶é€šçŸ¥ï¼‰æ˜¯æŒ‡å¯ä»¥åŒ…å«éŸ³é¢‘ï¼Œå›¾åƒæˆ–è§†é¢‘å†…å®¹ï¼Œå¹¶ä¸”å¯ä»¥å°†å…¶å†…å®¹æ˜¾ç¤ºå‡ºæ¥çš„é€šçŸ¥ã€‚
 3. ä½¿ç”¨æœ¬åœ°é€šçŸ¥æ—¶ï¼Œå¯ä»¥åœ¨é€šçŸ¥åˆ›å»ºæ—¶ï¼Œå°†é™„ä»¶åŠ å…¥å³å¯ã€‚
 4. å¯¹äºè¿œç¨‹é€šçŸ¥ï¼Œåˆ™å¿…é¡»å®ç°ä½¿ç”¨`UNNotificationServiceExtension`ç±»é€šçŸ¥æœåŠ¡æ‰©å±•ã€‚   
 5. åˆ›å»ºé™„ä»¶çš„æ–¹æ³•æ˜¯
 
    ```
    + (nullable instancetype)attachmentWithIdentifier:(NSString *)identifier URL:(NSURL *)URL options:(nullable NSDictionary *)options error:(NSError *__nullable *__nullable)error;
    ```
    
    1. åœ¨ä½¿ç”¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šä½¿ç”¨æ–‡ä»¶é™„ä»¶çš„å†…å®¹ï¼Œå¹¶ä¸”æ–‡ä»¶æ ¼å¼å¿…é¡»æ˜¯æ”¯æŒçš„ç±»å‹ä¹‹ä¸€ã€‚
    2. åˆ›å»ºé™„ä»¶åï¼Œå°†å…¶åˆ†é…ç»™å†…å®¹å¯¹è±¡çš„é™„ä»¶å±æ€§ã€‚
    3. å¯¹äºè¿œç¨‹é€šçŸ¥ï¼Œæ‚¨å¿…é¡»ä»æ‚¨çš„æœåŠ¡æ‰©å±•åšåˆ°è¿™ä¸€ç‚¹ã€‚
 6. é™„ä»¶é€šçŸ¥æ”¯æŒçš„ç±»å‹å¦‚ä¸‹å›¾ï¼š   
     ![å›¾1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/attachment.png) 
7. æ³¨æ„ï¼šURLå¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„ï¼Œä¸ç„¶ä¼šæŠ¥é”™
8. optionså‚æ•°æ˜¯ä¸€ä¸ªå­—å…¸,ä½†æ˜¯å…¶keyå®æšä¸¾,å¦‚ä¸‹;
    1. `UNNotificationAttachmentOptionsTypeHintKey`:
        1. æ­¤é”®çš„å€¼(value)æ˜¯ä¸€ä¸ªæè¿°æ–‡ä»¶ç±»å‹çš„ç»Ÿä¸€ç±»å‹æ ‡è¯†ç¬¦ï¼ˆUTIï¼‰ä¸€ä¸ªNSStringã€‚
        2. å¦‚æœä¸æä¾›è¯¥é”®ï¼Œé™„ä»¶çš„æ–‡ä»¶æ‰©å±•åæ¥ç¡®å®šå…¶ç±»å‹
        3. å¸¸ç”¨çš„ç±»å‹æ ‡è¯†ç¬¦æœ‰:`kUTTypeImage,kUTTypeJPEG2000,kUTTypeTIFF,kUTTypePICT,kUTTypeGIF ,kUTTypePNG,kUTTypeQuickTimeImageç­‰ã€‚`
        4. ä½¿ç”¨è¿™äº›æ ‡è¯†ç¬¦ä¹‹å‰è¦å¯¼å…¥`#import<MobileCoreServices/MobileCoreServices.h>`æ¡†æ¶
        5. ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š
            
            ```
            dict[UNNotificationAttachmentOptionsTypeHintKey] = (__bridge id _Nullable)(kUTTypeImage);
            ```
    2. `UNNotificationAttachmentOptionsThumbnailHiddenKey`: 
        1. æ˜¯ä¸€ä¸ªBOOLå€¼,ä¸ºYESæ—¶å€™ï¼Œç¼©ç•¥å›¾å°†éšè—(å³é€šçŸ¥ä¸­(å³ä¸­)å¸¦çš„å›¾ç‰‡)ï¼Œé»˜è®¤ä¸ºNOã€‚
        2. ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:
            
            ```
             dict[UNNotificationAttachmentOptionsThumbnailHiddenKey] =  @YES;
            ```
    3. `UNNotificationAttachmentOptionsThumbnailClippingRectKey`
        1. å‰ªè´´çŸ©å½¢çš„ç¼©ç•¥å›¾ã€‚
        2. ä½¿ç”¨æ–¹æ³•; 
            
            ```
            dict[UNNotificationAttachmentOptionsThumbnailClippingRectKey] = (__bridge id _Nullable)((CGRectCreateDictionaryRepresentation(CGRectMake(0.5, 0.5, 0.25 ,0.25))));
            ```
        3. `(0.5, 0.5, 0.25 ,0.25)`è¿™å¥è¯çš„æ„æ€æ˜¯,ä»¥åŸç¼©ç•¥å›¾å·¦ä¸Šè§’ä¸ºåŸç‚¹æˆªå–ä¸€ä¸ªxåæ ‡ä¸º:`0.5*é•¿åº¦`,yåæ ‡ä¸º:`0.5*å®½åº¦`,å®½åº¦ä¸º:`0.25*å®½åº¦`,é•¿åº¦ä¸º:`0.25*é•¿åº¦`çš„çŸ©å½¢å›¾ç‰‡ä½œä¸ºæ–°çš„ç¼©ç•¥å›¾(å³é€šçŸ¥å³ä¸­çš„å›¾ç‰‡).
    4. `UNNotificationAttachmentOptionsThumbnailTimeKey`
        1. ä¸€èˆ¬å½±ç‰‡é™„ä»¶ä¼šç”¨åˆ°ï¼ŒæŒ‡çš„æ˜¯ç”¨å½±ç‰‡ä¸­çš„æŸä¸€ç§’æ¥åšè¿™ä¸ªç¼©ç•¥å›¾ï¼›
        2. ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š
            
            ```
dict[UNNotificationAttachmentOptionsThumbnailTimeKey] =@10;
            ```
        3. è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼ é€’ä¸€ä¸ªNSNumberçš„æ•°å€¼ï¼Œæ¯”å¦‚ä½¿ç”¨å½±ç‰‡ç¬¬10sçš„ç”»é¢æ¥åšç¼©ç•¥å›¾å°±æŒ‰ç…§ä¸Šé¢çš„æ¥å†™ã€‚æ­¤å¤–ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªç§’æ•°å¿…é¡»æ˜¯è¿™ä¸ªå½±ç‰‡é•¿åº¦èŒƒå›´å†…çš„ï¼Œä¸ç„¶æŠ¥é”™ã€‚
        
#### UNTimeIntervalNotificationTrigger

1. `UNPushNotificationTrigger`
    1. ï¼ˆè¿œç¨‹é€šçŸ¥è§¦å‘ï¼‰ä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šä½¿ç”¨çš„
2. `UNTimeIntervalNotificationTrigger`
    1. ï¼ˆæœ¬åœ°é€šçŸ¥ï¼‰ ä¸€å®šæ—¶é—´ä¹‹åï¼Œé‡å¤æˆ–è€…ä¸é‡å¤æ¨é€é€šçŸ¥ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®timeIntervalï¼ˆæ—¶é—´é—´éš”ï¼‰å’Œrepeatsï¼ˆæ˜¯å¦é‡å¤ï¼‰ã€‚
    2. ä½¿ç”¨æ–¹æ³•ï¼š
        
        ```
        UNTimeIntervalNotificationTrigger *triggerOne = [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:5 repeats:NO];
        ```
    3. è§£é‡Šï¼šä¸Šé¢çš„æ–¹æ³•æ˜¯æŒ‡5ç§’é’Ÿä¹‹åæ‰§è¡Œã€‚`repeats`è¿™ä¸ªå±æ€§ï¼Œå¦‚æœéœ€è¦ä¸ºé‡å¤æ‰§è¡Œçš„ï¼Œåˆ™`TimeInterval`å¿…é¡»å¤§äº60s,å¦åˆ™ä¼šæŠ¥: ` Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'time interval must be at least 60 if repeating'`çš„é”™è¯¯!
3. `UNCalendarNotificationTrigger`
    1. ï¼ˆæœ¬åœ°é€šçŸ¥ï¼‰ ä¸€å®šæ—¥æœŸä¹‹åï¼Œé‡å¤æˆ–è€…ä¸é‡å¤æ¨é€é€šçŸ¥ 
    2.  ä¾‹å¦‚ï¼Œä½ æ¯å¤©8ç‚¹æ¨é€ä¸€ä¸ªé€šçŸ¥ï¼Œåªéœ€è¦dateComponentsä¸º8ã€‚å¦‚æœä½ æƒ³æ¯å¤©8ç‚¹éƒ½æ¨é€è¿™ä¸ªé€šçŸ¥ï¼Œåªè¦repeatsä¸ºYESå°±å¯ä»¥äº†ã€‚
    3. ä»£ç ä¸¾ä¾‹:
        
        ```
        // å‘¨ä¸€æ—©ä¸Š 8ï¼š00 ä¸Šç­
        NSDateComponents *components = [[NSDateComponents alloc] init];
        // æ³¨æ„ï¼Œweekdayæ˜¯ä»å‘¨æ—¥å¼€å§‹çš„ï¼Œå¦‚æœæƒ³è®¾ç½®ä¸ºä»å‘¨ä¸€å¼€å§‹ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±æƒ³æƒ³~
        components.weekday = 2;
        components.hour = 8;
        UNCalendarNotificationTrigger *trigger = [UNCalendarNotificationTrigger triggerWithDateMatchingComponents:components repeats:YES];
        ```
    4. `UNLocationNotificationTrigger`
        1. (æœ¬åœ°é€šçŸ¥ï¼‰åœ°ç†ä½ç½®çš„ä¸€ç§é€šçŸ¥ï¼Œä½¿ç”¨è¿™ä¸ªé€šçŸ¥ï¼Œä½ éœ€è¦å¯¼å…¥
        2. `#import<CoreLocation/CoreLocation.h>`è¿™ä¸ªç³»ç»Ÿç±»åº“ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š
        
            ```
            //1ã€å¦‚æœç”¨æˆ·è¿›å…¥æˆ–è€…èµ°å‡ºæŸä¸ªåŒºåŸŸä¼šè°ƒç”¨ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•
            - (void)locationManager:(CLLocationManager *)manager
                didEnterRegion:(CLRegion *)region
            - (void)locationManager:(CLLocationManager *)manager
                didExitRegion:(CLRegion *)regionä»£ç†æ–¹æ³•åé¦ˆç›¸å…³ä¿¡æ¯
            
            //2ã€ä¸€åˆ°æŸä¸ªç»çº¬åº¦å°±é€šçŸ¥ï¼Œåˆ¤æ–­åŒ…å«æŸä¸€ç‚¹ä¹ˆ
            // ä¸å»ºè®®ä½¿ç”¨ï¼ï¼ï¼ï¼ï¼ï¼CLRegion *region = [[CLRegion alloc] init];// ä¸å»ºè®®ä½¿ç”¨ï¼ï¼ï¼ï¼ï¼ï¼
            
            
            CLCircularRegion *circlarRegin = [[CLCircularRegion alloc] init];
            [circlarRegin containsCoordinate:(CLLocationCoordinate2D)];
            
            UNLocationNotificationTrigger *trigger4 = [UNLocationNotificationTrigger triggerWithRegion:circlarRegin repeats:NO];

            ```
        3. æ³¨æ„ï¼Œè¿™é‡Œå»ºè®®ä½¿ç”¨`CLCircularRegion`è¿™ä¸ªç»§æ‰¿è‡ª`CLRegion`çš„ç±»ï¼Œå› ä¸ºæˆ‘çœ‹åˆ°è‹¹æœå·²ç»åºŸå¼ƒäº†`CLRegion`é‡Œé¢æ˜¯å¦åŒ…å«è¿™ä¸€ç‚¹çš„æ–¹æ³•ï¼Œå¹¶ä¸”æ¨èæˆ‘ä»¬ä½¿ç”¨`CLCircularRegion`è¿™ä¸ªç±»å‹

## ç‚¹å‡»é€šçŸ¥(åŒ…å«è¿œç¨‹å’Œæœ¬åœ°)
1. ç¬¬ä¸€æ­¥åœ¨`Appdelegate.m`ä¸­å¯¼å…¥`#import <UserNotifications/UserNotifications.h>`
2. æˆ‘ä»¬æœ€å¥½å†™æˆè¿™ç§å½¢å¼

    ```
    #ifdef NSFoundationVersionNumber_iOS_9_x_Max
    #import <UserNotifications/UserNotifications.h>
    #endif
    ```
    
### didFinishLaunchingWithOptionsçš„å¤„ç†(åŒ…å«æœ¬åœ°å’Œè¿œç¨‹)

1. è¯·æ±‚ç”¨æˆ·æˆæƒ/æ³¨å†Œè¿œç¨‹é€šçŸ¥
    1. è·å–åº”ç”¨çš„é€šçŸ¥ç®¡ç†ä¸­å¿ƒUNUserNotificationCenter,æ¥ç®¡ç†æ¨é€é€šçŸ¥

        ```
         UNUserNotificationCenter* center = [UNUserNotificationCenter   currentNotificationCenter];
        ```
    2. è®¾ç½®æ¨é€é€šçŸ¥ä¸­å¿ƒçš„ä»£ç†,å®ç°ä»£ç†æ–¹æ³•,ç›‘å¬é€šçŸ¥çš„æ¨é€
        1. æ³¨æ„ï¼š`UNUserNotificationCenter`çš„`delegate`å¿…é¡»åœ¨`application:willFinishLaunchingWithOptions: or application:didFinishLaunchingWithOptions:`æ–¹æ³•ä¸­å®ç°ï¼›
            
            ```
            center.delegate = self;
            ```
    3. è®¾ç½®é¢„è®¾å¥½çš„äº¤äº’ç±»å‹ï¼Œ`NSSet`é‡Œé¢æ˜¯è®¾ç½®å¥½çš„`UNNotificationCategory`
        1. å°±æ˜¯å½“æ¥æ”¶åˆ°é€šçŸ¥æ—¶,æ‹–æ‹½å‘ä¸‹,ä¼šçœ‹åˆ°äº’äº¤æ§ä»¶:æ˜¯æŒ‰é’®ç‚¹å‡»/è¿˜æ˜¯æ–‡æœ¬è¾“å…¥,ä¸è®¾ç½®æ²¡æœ‰æŒ‰é’®
        2. ä¹Ÿå°±æ˜¯æœ¬åœ°é€šçŸ¥ä¸­`UNMutableNotificationContent`ç±»çš„`categoryIdentifier`å±æ€§è¦åœ¨è¿™äº›è®¾ç½®å¥½çš„äº’äº¤ç±»å‹ä¸­é€‰æ‹©
            
            ```
             [center setNotificationCategories:[self createNotificationCategoryActions]];
            ```
    4. è¯·æ±‚ç”¨æˆ·æˆæƒ
        
        ```
        //è¯·æ±‚è·å–é€šçŸ¥æƒé™ï¼ˆè§’æ ‡ï¼Œå£°éŸ³ï¼Œå¼¹æ¡†ï¼‰
        [center requestAuthorizationWithOptions:(UNAuthorizationOptionBadge | UNAuthorizationOptionSound | UNAuthorizationOptionAlert) completionHandler:^(BOOL granted, NSError * _Nullable error) {
            if (granted) {
                //è·å–ç”¨æˆ·æ˜¯å¦åŒæ„å¼€å¯é€šçŸ¥
                NSLog(@"request authorization successed!");
            }
        }];
        ```
    5. æ³¨å†Œè¿œç¨‹é€šçŸ¥(åªç”¨æœ¬åœ°æ—¶ä¸éœ€è¦)
        1. è°ƒç”¨è¯¥æ–¹æ³•å°±æ˜¯å‘è‹¹æœçš„apnsæœåŠ¡å™¨å‘é€è¯¥è®¾å¤‡çš„udidå’Œbundle id,è¿”å›deviceToken
        2. å¦‚æœè·å–ä¸åˆ°deviceTokenï¼ŒXcode8ä¸‹è¦æ³¨æ„å¼€å¯Capability->Push Notificationã€‚
            
            ```
             [application registerForRemoteNotifications];
            ```
2. äº¤äº’ç±»å‹çš„è‡ªå®šä¹‰æ–¹æ³•
   
    ```
    -(NSSet *)createNotificationCategoryActions{
    //1.è®¾ç½®äº¤äº’ç±»å‹1:seeCategory 2ä¸ªæŒ‰é’®
    //1.1 å®šä¹‰æŒ‰é’®çš„äº¤äº’button action
    //Identifier:äº’äº¤çš„æ ‡è¯†,å½“ç”¨æˆ·ç‚¹å‡»æ—¶å¯ä»¥å†ç”¨æˆ·ç‚¹å‡»æ–¹æ³•ä¸­æŸ¥çœ‹ç‚¹å‡»æ˜¯å“ªä¸ªbtn
    //title:æ ‡é¢˜
    UNNotificationAction * likeButton = [UNNotificationAction actionWithIdentifier:@"see1" title:@"I love it~ğŸ˜˜" options:UNNotificationActionOptionAuthenticationRequired|UNNotificationActionOptionDestructive|UNNotificationActionOptionForeground];
    UNNotificationAction * dislikeButton = [UNNotificationAction actionWithIdentifier:@"see2" title:@"I don't care~ğŸ˜³" options:UNNotificationActionOptionAuthenticationRequired|UNNotificationActionOptionDestructive|UNNotificationActionOptionForeground];
    //1.2 å°†è¿™äº›actionå¸¦å…¥category
    //Identifier:åˆ›å»ºé€šçŸ¥æ—¶ä¼šä½¿ç”¨åˆ°è¿™ä¸ª,æ ¹æ®è¿™ä¸ªæŸ¥çœ‹åˆ°åº•é€‰æ‹©å“ªç§äº’äº¤æ–¹å¼
    UNNotificationCategory * choseCategory = [UNNotificationCategory categoryWithIdentifier:@"seeCategory" actions:@[likeButton,dislikeButton] intentIdentifiers:@[@"see1",@"see2"] options:UNNotificationCategoryOptionNone];
    
    //2. è®¾ç½®äº¤äº’ç±»å‹2:seeCategory1  æ–‡æœ¬æ¡†è¾“å…¥ç±»å‹
    //2.1 åˆ›å»ºtextAction
    UNTextInputNotificationAction * text = [UNTextInputNotificationAction actionWithIdentifier:@"text" title:@"How about it~?" options:UNNotificationActionOptionAuthenticationRequired|UNNotificationActionOptionDestructive|UNNotificationActionOptionForeground];
    //2.2 å°†actionåŠ å…¥UNNotificationCategory
    UNNotificationCategory * comment = [UNNotificationCategory categoryWithIdentifier:@"seeCategory1" actions:@[text] intentIdentifiers:@[@"text"] options:UNNotificationCategoryOptionNone];
    
    //3. å°†äº¤äº’ç±»å‹æ’å…¥NSSetä¸­,ç„¶åç»™æ•´ä¸ªappåº”ç”¨è®¾ç½®
    return [NSSet setWithObjects:choseCategory,comment,nil];
    }
    ```
3. ç›‘å¬deviceTokençš„è·å–(è¿œç¨‹é€šçŸ¥ä½¿ç”¨)
    1. è·å¾—Device Tokençš„æ–¹æ³•æ˜¯æ²¡æœ‰æ”¹å˜çš„ã€‚
        
        ```
        // ç›‘å¬è‹¹æœè¿”å›devicetoken
        -(void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken{
            //4.å°†DeviceTokenä¼ ç»™æœåŠ¡å™¨
            NSLog(@"%@", deviceToken.description);
        }
        //å‘apnsè¯·æ±‚å¤±è´¥
        -(void)application:(UIApplication *)application didFailToRegisterForRemoteNotificationsWithError:(NSError *)error{
            NSLog(@"===è¯·æ±‚devicetokenå¤±è´¥==%@",error);
        }
        ```
4. `UNUserNotificationCenter`çš„å…¶ä»–ä½¿ç”¨æ–¹æ³•:
    1. è·å–å½“å‰åº”ç”¨çš„é€šçŸ¥è®¾ç½®
    2. `UNNotificationSettings`æ˜¯åªè¯»å¯¹è±¡ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œåªèƒ½é€šè¿‡ä»¥ä¸‹æ–¹æ³•è·å–

 

