---
layout: post
title: 多线程篇一:多线程基础
category: iOS开发
tags: 多线程
description: 多线程
--- 

### 线程和进程
1. 什么是进程
    1. 进程是指在系统中正在运行的一个应用程序
    2. 每个进程之间是独立的，每个进程均运行在其专用且受保护的**内存空间**内
    3. 比如同时打开迅雷、Xcode，系统就会分别启动2个进程
    4. 通过“活动监视器”可以查看Mac系统中所开启的进程
2. 什么是线程
    1. 1个进程（应用程序）要想执行任务，必须得有线程（每1个进程至少要有1条线程） 
    2. 一个进程（程序）的所有任务都在线程中执行
    3. 比如使用酷狗播放音乐、使用迅雷下载电影，都需要在线程中执行   
    
#### 多线程      
1. 线程的串行
    1. 1个线程中任务的执行是**串行**的
        1. 如果要在1个线程中执行多个任务，那么只能一个一个地按顺序执行这些任务
        2. 也就是说，在同一时间内，1个线程**只能**执行1个任务
        3. 因此，也可以认为线程是进程中的1条执行路径
    2. 比如在1个线程中下载3个文件（分别是文件A、文件B、文件C）
2. 什么是多线程
    1. 1个进程中可以开启多条线程，每条线程可以并行（同时）执行不同的任务
    2. 进程<=>车间，线程<=>车间工人
    3. 多线程技术可以提高程序的执行效率
    4. 比如同时开启3条线程分别下载3个文件（分别是文件A、文件B、文件C）
3. 多线程的原理
    1. 同一时间，CPU**只能**处理1条线程，只有1条线程在工作（执行）
    2. 多线程并发（同时）执行，其实是CPU快速地在多条线程之间调度（切换）
    3. 如果CPU调度线程的时间足够快，就造成了多线程并发执行的假象
    4. 思考：如果线程非常非常多，会发生什么情况？
        1. CPU会在N多线程之间调度，CPU会累死，消耗大量的CPU资源
        2. 每条线程被调度执行的频次会降低（线程的执行效率降低）
4. 多线程的优缺点 
    1. 多线程的优点
        1. 能适当提高程序的执行效率
        2. 能适当提高资源利用率（CPU、内存利用率）
    2. 多线程的缺点
        1. 创建线程是有开销的，iOS下主要成本包括：内核数据结构（大约1KB）、栈空间（子线程512KB、主线程1MB，也可以使用-setStackSize:设置，但必须是4K的倍数，而且最小是16K），创建线程大约需要90毫秒的创建时间
        2. 如果开启大量的线程，会降低程序的性能
        3. 线程越多，CPU在调度线程上的开销就越大
        4. 程序设计更加复杂：比如线程之间的通信、多线程的数据共享

#### 多线程在iOS开发中的应用
1. 什么是主线程
    1. 一个iOS程序运行后，默认会开启1条线程，称为“主线程”或“UI线程”
2. 主线程的**主要作用**
    1. 显示\刷新UI界面
    2. 处理UI事件（比如点击事件、滚动事件、拖拽事件等）
3. 主线程的使用注意
    1. 别将比较耗时的操作放到主线程中
    2. 耗时操作会卡住主线程，严重影响UI的流畅度，给用户一种“卡”的坏体验

#### iOS中多线程的实现方案

```
技术方案            简介                          语言      线程生命周期    使用频率

              1. 一套通用的多线程API
pthread       2. 适用于Unix\Linux\Windows等系统    C        程序员管理     几乎不用
              3. 跨平台\可移植
              4. 使用难度大
              
NSThread      1. 使用更加面向对象                  OC        程序员管理     偶尔使用
              2.简单易用，可直接操作线程对象       
              
GCD           1.旨在替代NSThread等线程技术          C        自动管理       经常使用
              2.充分利用设备的多核
              
              1.基于GCD（底层是GCD）
NSOperation   2.比GCD多了一些更简单实用的功能        OC        自动管理      经常使用
              3.使用更加面向对象
```


