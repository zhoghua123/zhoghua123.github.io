---
layout: post
title: 推送通知
category: iOS开发
tags: 单元测试
description: 单元测试
--- 

## 简介
1. 推送通知跟NSNotification区别
    1. NSNotification是抽象的，不可见的
    2. 推送通知是可见的（能用肉眼看到）
2. iOS中提供了2种推送通知
    1. 本地推送通知（Local Notification）
    2. 远程推送通知（Remote Notification）
3. 推送通知的作用
    1. 可以让**不在前台运行的app**，告知用户app内部发生了什么事情
4. 推送通知的呈现效果
    1. 在屏幕顶部显示一块横幅（显示具体内容)
    2. 在屏幕中间弹出一个UIAlertView（显示具体内容）
    3. 在锁屏界面显示一块横幅（锁屏状态下，显示具体内容）
    4. 更新app图标的数字（说明新内容的数量）
    5. 播放音效（提醒作用）
5. 推送通知呈现的效果设置.
    1. 显示横幅还是UIAlertView，取决于用户的设置
    2. 手机->设置->通知中心-> 相应应用-> 选择通知样式.
    3. 在该界面,用户也可以决定是否要开启以下4个功能：
        1. 显示App图标数字
        2. 播放音效
        3. 锁屏显示
        4. 显示在“通知中心” 
6. 推送通知的使用细节
    1. 发出推送通知时，如果程序正运行在前台，那么推送通知就不会被呈现出来
    2. 点击推送通知后，默认会自动打开发出推送通知的app
    3. 不管app打开还是关闭，推送通知都能如期发出

## 本地推送通知
1. 定义: 
    1. 顾名思义，就是不需要联网就能发出的推送通知（不需要服务器的支持）
2. 本地推送通知的使用场景
    1. 常用来定时提醒用户完成一些任务，比如:清理垃圾、记账、买衣服、看电影、玩游戏
    
### 如何发送本地通知
1. 创建本地推送通知对象
    
    ```
    UILocalNotification *ln = [[UILocalNotification alloc] init];
    ```
2. 设置本地推送通知属性
    1. 推送通知的触发时间（何时发出推送通知）
        
        ```
        @property(nonatomic,copy) NSDate *fireDate;
        ```
    2. 推送通知的具体内容
        
        ```
        @property(nonatomic,copy) NSString *alertBody;
        ```
    3. 锁屏界面显示的小标题（完整小标题：“滑动来” + alertAction）
        
        ```
        @property(nonatomic,copy) NSString *alertAction;
        ```
    4. 音效文件名(有通知时发送声音)
        
        ```
        @property(nonatomic,copy) NSString *soundName;
        ```
    5. app图标数字
        
        ```
        @property(nonatomic) NSInteger applicationIconBadgeNumber;
        ```
3. 调度本地推送通知（调度完毕后，推送通知会在特地时间fireDate发出）

    ```
    [[UIApplication sharedApplication] scheduleLocalNotification:ln];
    ```
4. 获得被调度的所有本地推送通知(等待发出的通知)
    1. （已经发出且过期的推送通知就算调度结束，会自动从这个数组中移除）

    ```
    @property(nonatomic,copy) NSArray *scheduledLocalNotifications;
    ```
5. 取消调度本地推送通知
    
    ```
    - (void)cancelLocalNotification:(UILocalNotification *)notification;
    - (void)cancelAllLocalNotifications;
    ```
6. 立即发出本地推送通知(使用价值：app在后台运行的时候)
    
    ```
    - (void)presentLocalNotificationNow:(UILocalNotification *)notification;
    ```
    
### 本地推送通知的其他属性
1. 每隔多久重复发一次推送通知
    
    ```
    @property(nonatomic) NSCalendarUnit repeatInterval;
    ```
2. 点击推送通知打开app时显示的启动图片
    1. 注意: 该字符串无论写什么,都会显示app最初设置的那个启动图片(没卵用)
    
    ```
    @property(nonatomic,copy) NSString *alertLaunchImage;
    ```
3. 附加的额外信息
    
    ```
    @property(nonatomic,copy) NSDictionary *userInfo;
    ```
4. 时区
    
    ```
    @property(nonatomic,copy) NSTimeZone *timeZone;
（一般设置为[NSTimeZone defaultTimeZone] ，跟随手机的时区）
    ```

### 点击本地推送通知
1. 当用户点击本地推送通知，会自动打开app，这里有2种情况
2. app并没有关闭，一直隐藏在后台
    1. 让app进入前台，并会调用AppDelegate的下面方法（并非重新启动app）
        
        ```
        - (void)application:(UIApplication *)application didReceiveLocalNotification:(UILocalNotification *)notification;
        ```
3. app已经被关闭（进程已死）
    1. 启动app，启动完毕会调用AppDelegate的下面方法
        
        ```
        - (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions;
launchOptions参数通过UIApplicationLaunchOptionsLocalNotificationKey取出本地推送通知对象
        ```

