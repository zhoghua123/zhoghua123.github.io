---
layout: post
title: 跨平台开发RN-组件Navigator
category: iOS开发
tags: React Native 
description: 跨平台开发的研究
--- 

## Navigator组件
1. 处理应用程序中不同场景之间的转换。Navigator 是跨平台的导航组件，不管在 iOS 还是 Android 系统下都能使用。Navigator 默认没有包含导航栏，我们可以实现一个自定义导航栏，也可以使用 NavigatorBar 组件来实现
2. Navigator安装
    1. 从0.44版本开始，Navigator被从react native的核心组件库中剥离到了一个名为`react-native-deprecated-custom-components`的单独模块中
    2. 导入navigator
        1. 打开终端，cd 到你的文件目录
            
            ```
            // 导入navigator
            npm  install   react-native-deprecated-custom-components  --save
            ```
3. 很多时候，我们需要导航器来应对不同场景（页面）间的切换。它通过路由对象来分辨不同的场景，我们这里采用的就是 `renderScene` 方法，根据指定的路由来渲染。

### 常用的属性
1. `initialRoute ={{ name: 'home', component: HomeScene }}`
    1. 这个指定了默认的页面，也就是启动的组件页面
2. `configureScene` 设置页面跳转样式
    1. `configureScene`函数应该返回一个场景配置对象用来定义页面切换的动画。可用场景配置选项为:
        
        ```
        PushFromRight(默认)
        FloatFromRight
        FloatFromLeft
        FloatFromBottom
        FloatFromBottomAndroid
        FadeAndroid
        SwipeFromLeft
        HorizontalSwipeJump
        HorizontalSwipeJumpFromRight
        HorizontalSwipeJumpFromLeft
        VerticalUpSwipeJump
        VerticalDownSwipeJump
        ```
   2. 使用：
        
        ```
        configureScene ={() => {
        return Navigator. SceneConfigs .HorizontalSwipeJump;
        }}
        ```
3. `renderScene`
    1. 具体是方法如下:
        
        ```
        (route, navigator) =><MySceneComponent title={route.title} navigator={navigator} />
        ```
    2. 两个参数中的route包含的是initial的时候传递的name和component，而navigator是一个我们需要用的Navigator的对象；
    3. 所以当我们拿到route中的component的时候，我们就可以将navigator传递给它，正因为如此，我们的组件`HomeScene`才可以通过 `this.props.navigator`，拿到路由。
4. `initialRouteStack [object] `参数对象数组
    1. 这是一个初始化的路由数组进行初始化。如果`initalRoute`属性没有设置的话，那么就必须设置`initialRouteStack`属性，使用该最后一项作为初始路由。 如果`initalRouteStack`属性没有设置的话，该会生成只包含`initalRoute`值的数组
5. `navigationBar node`
    1. 该为可选的参数，在页面切换中用来提供一个导航栏
6. `navigator object`
    1. 该为可选参数，可以从父类导航器中获取导航器对象
7. `sceneStyle 样式风格`
    1. 该继承了View视图的所有样式风格，用于设置每个页面容器的风格
8. `onWillFocus: `
    1. 每个navigator组件转换之前，会回调onWillFocus函数。
9. `onDidFocus:`
    1. 每个navigator组件转换之后，会回调onDidFocus函数。
    

### 常用的导航器方法
1. 当获取了导航器对象的引用，我们可以进行调用以下一些方法来实现页面导航功能:
2. 如下：
    1. `getCurrentRoutes()`
        1. 该进行返回存在的路由列表信息
    2. `jumpBack()`
        1. 该进行回退操作 但是该不会卸载(删除)当前的页面
    3. `jumpForward()`
        1. 进行跳转到相当于当前页面的下一个页面
    4. `jumpTo(route)`
        1. 根据传入的一个路由信息，跳转到一个指定的页面(该页面不会卸载删除)    
    5. `push(route)`
        1. 导航切换到一个新的页面中，新的页面进行压入栈。通过jumpForward()方法可以回退过去
    6. `pop()`
        1. 当前页面弹出来，跳转到栈中下一个页面，并且卸载删除掉当前的页面
    7. `replace(route)`
        1. 只用传入的路由的指定页面进行替换掉当前的页面
    8. `replaceAtIndex(route,index)`
        1. 传入路由以及位置索引，使用该路由指定的页面跳转到指定位置的页面
    9. `replacePrevious(route)`
        1. 传入路由，通过指定路由的页面替换掉前一个页面
    10. `resetTo(route)`
        1. 进行导航到新的界面，并且重置整个路由栈
    11. `immediatelyResetRouteStack(routeStack)`
        1. 该通过一个路由页面数组来进行重置路由栈
    12. `popToRoute(route)`
        1. 进行弹出相关页面，跳转到指定路由的页面，弹出来的页面会被卸载删除
    13. `popToTop()`
        1. 进行弹出页面，导航到栈中的第一个页面，弹出来的所有页面会被卸载删除

### 默认写法

```
<Navigator
initialRoute = {{ name: defaultName, component: defaultComponent }}
configureScene={()=>{
    return Navigator.SceneConfigs.PushFromRight;
}}
renderScene={(route,navigator)=>{
    let Component = route.component;
    return <Component {...route.passProps} navigator={navigator}/>;
    }}
/>
```

### 代码示例

```
import React, {Component} from 'react';
import {View, StyleSheet, Text, Image, TouchableOpacity} from 'react-native';
import TabNavigator from 'react-native-tab-navigator';
import TabNavigatorItem from 'react-native-tab-navigator/TabNavigatorItem';
import {Navigator} from 'react-native-deprecated-custom-components';
import Home from './ZHHome';
import Find from './ZHFind';
import Mine from './ZHMine';
import Message from './ZHMessage';

class Main extends Component {
  constructor(props) {
    super(props);
    this.state = {
      //设置默认被选中的Item
      selectedTabBarItem: 'home',
    };
  }
  render() {
    return (
      <View style={styles.container}>
        {/*TabBar部分*/}
        <TabNavigator
          //设置tabBar的样式
          tabBarStyle={{height: 49, backgroundColor: 'white'}}>
          <TabNavigatorItem
            title="首页"
            //判断当前是否被选中
            selected={this.state.selectedTabBarItem == 'home'}
            //监听item点击
            onPress={() => this.setState({selectedTabBarItem: 'home'})}
            //未选中图标
            renderIcon={() => (
              <Image
                source={require('../img/tabbar_h.png')}
                style={{width: 25, height: 25}}
              />
            )}
            //选中图标
            renderSelectedIcon={() => (
              <Image
                source={require('../img/tabbar_hs.png')}
                style={{width: 25, height: 25}}
              />
            )}
            //选中标题颜色
            selectedTitleStyle={{color: 'orange'}}>
            <Navigator
              initialRoute={{title: '首页', component: Home}}
              configureScene={(route, navigator) => {
                return Navigator.SceneConfigs.FloatFromBottom;
              }}
              renderScene={(route, navigator) => {
                let Component = route.component;
                return <Component {...route.passProps} navigator={navigator} />;
              }}
              navigationBar={
                <Navigator.NavigationBar
                  style={styles.navStyleBase}
                  routeMapper={NavigationBarRouteMapper}
                  // routeMapper={{
                  //   LeftButton: (route, navigator, index, navState) => {
                  //     return <Text>cancel</Text>;
                  //   },
                  //   RightButton: (route, navigator, index, navState) => {
                  //     return <Text>done</Text>;
                  //   },
                  //   Title: (route, navigator, index, navState) => {
                  //     return <Text>{route.title}</Text>;
                  //   },
                  // }}
                />
              }
            />
          </TabNavigatorItem>
          <TabNavigatorItem
            //判断当前是否被选中
            selected={this.state.selectedTabBarItem == 'second'}
            //监听item点击
            onPress={() => this.setState({selectedTabBarItem: 'second'})}
            title="发现"
            renderIcon={() => (
              <Image
                source={require('../img/tabbar_d.png')}
                style={{width: 25, height: 25}}
              />
            )}
            //选中图标
            renderSelectedIcon={() => (
              <Image
                source={require('../img/tabbar_ds.png')}
                style={{width: 25, height: 25}}
              />
            )}
            //选中标题颜色
            selectedTitleStyle={{color: 'orange'}}>
            <Navigator
              initialRoute={{name: '发现', component: Find}}
              configureScene={(route, navigator) => {
                return Navigator.SceneConfigs.FloatFromBottom;
              }}
              renderScene={(route, navigator) => {
                let Component = route.component;
                return <Component {...route.passProps} navigator={navigator} />;
              }}
            />
          </TabNavigatorItem>
          <TabNavigatorItem
            //判断当前是否被选中
            selected={this.state.selectedTabBarItem == 'three'}
            //监听item点击
            onPress={() => this.setState({selectedTabBarItem: 'three'})}
            title="消息"
            renderIcon={() => (
              <Image
                source={require('../img/tabbar_m.png')}
                style={{width: 25, height: 25}}
              />
            )}
            //选中图标
            renderSelectedIcon={() => (
              <Image
                source={require('../img/tabbar_ms.png')}
                style={{width: 25, height: 25}}
              />
            )}
            //选中标题颜色
            selectedTitleStyle={{color: 'orange'}}>
            <Navigator
              initialRoute={{name: '消息', component: Message}}
              configureScene={(route, navigator) => {
                return Navigator.SceneConfigs.FloatFromBottom;
              }}
              renderScene={(route, navigator) => {
                let Component = route.component;
                return <Component {...route.passProps} navigator={navigator} />;
              }}
            />
          </TabNavigatorItem>
          <TabNavigatorItem
            //判断当前是否被选中
            selected={this.state.selectedTabBarItem == 'four'}
            //监听item点击
            onPress={() => this.setState({selectedTabBarItem: 'four'})}
            title="我的"
            renderIcon={() => (
              <Image
                source={require('../img/tabbar_p.png')}
                style={{width: 25, height: 25}}
              />
            )}
            //选中图标
            renderSelectedIcon={() => (
              <Image
                source={require('../img/tabbar_ps.png')}
                style={{width: 25, height: 25}}
              />
            )}
            //选中标题颜色
            selectedTitleStyle={{color: 'orange'}}>
            <Navigator
              initialRoute={{name: '我的', component: Mine}}
              configureScene={(route, navigator) => {
                return Navigator.SceneConfigs.FloatFromBottom;
              }}
              renderScene={(route, navigator) => {
                let Component = route.component;
                return <Component {...route.passProps} navigator={navigator} />;
              }}
            />
          </TabNavigatorItem>
        </TabNavigator>
      </View>
    );
  }
}

var NavigationBarRouteMapper = {
  // 标题
  Title(route, navigator, index, navState) {
    return <Text style={styles.navTitleStyle}>{route.title}</Text>;
  },
  // 左键
  LeftButton(route, navigator, index, navState) {
    //当index>0时
    if (index > 0) {
      return (
        <View>
          <TouchableOpacity
            underlayColor="transparent"
            onPress={() => {
              if (index > 0) {
                navigator.pop();
              }
            }}>
            <Text style={styles.navLeftButtonStyle}>返回</Text>
          </TouchableOpacity>
        </View>
      );
    } else {
      return (
        <TouchableOpacity onPress={() => {}}>
          <Image
            source={require('../img/navigationbar_ps.png')}
            style={{width: 25, height: 25, marginLeft: 10, marginTop: 10}}
          />
        </TouchableOpacity>
      );
    }
  },
  RightButton(route, navigator, index, navState) {
    // if (route.onPress) {
    return (
      <TouchableOpacity onPress={() => {}}>
        <Image
          source={require('../img/navigationbar_fs.png')}
          style={{width: 25, height: 25, marginRight: 10, marginTop: 10}}
        />
      </TouchableOpacity>
    );
  },
  // },
};
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: 'gray',
  },
  navStyleBase: {
    backgroundColor: 'white',
    height: 64,
  },
  navTitleStyle: {
    color: 'black',
    fontSize: 16,
    textAlign: 'center',
    flex: 1,
    fontWeight: 'bold',
    marginVertical: 5,
  },
  navLeftButtonStyle: {
    color: 'black',
    marginLeft: 10,
    fontSize: 15,
    marginTop: 5,
  },
  navRightButtonStyle: {
    color: 'black',
    marginRight: 10,
    fontSize: 15,
  },
});
export default Main;
```


