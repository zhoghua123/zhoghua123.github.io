---
layout: post
title: 跨平台开发RN-RN组件的生命周期
category: iOS开发
tags: React Native 
description: 跨平台开发的研究
--- 

## 生命周期
1. 在React Native中，组件的生命周期大致可以分为3个阶段:**实例化阶段，存在阶段，销毁阶段**，其中最常接触的为**实例化阶段**，这个阶段负责组件的构建和展示的时间，需要我们根据几个函数的调用过程，控制好组件的展示和逻辑处理。
    
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/reactive-05.png)

### 实例化阶段函数功能分析
1. `getDefaultProps:` 
    1. 该函数用于初始化一些默认的属性，通常会将固定的内容放到这个函数中进行初始化和赋值。相当于iOS的`+load`方法。**只会调用一次**。
    2. 在组件使用中，我们可以利用`this.props`获取在这里初始化的属性值，由于组件初始化后，再次使用该组件不会调用`getDefaultProps`函数，所以组件自己不可以修改`props`，只可由其他组件调用它时再外部进行修改。
2. `getInitialState：`
    1. 该函数用于对组件一些状态进行初始化，最新的修改为`constructor：`方法，**相当于iOS中设置对象的成员变量**
    2. 该函数不同于getDefaultProps,在以后的过程中，会再次调用，所以可以将控制控件状态的一些变量放在这里初始化，比如控件上显示的文字，可以通过this.state来获取值，通过this.setState来修改state值。
    3. **注意：**一旦调用了this.setState方法，组件一定会调用render方法，对组件进行再次渲染，不过，React框架会根据DOM的状态自动判断是否需要真正渲染.**从而达到了数据驱动视图**
    4. 举例使用
        
        ```
        constructor(props) {
            super(props);
            this.state = {
              clickText: "开始点击按钮",
              count: 1,
              detailContent: true
            }
          }
            ...
        clickButton(){
            const { count } = this.state;
            this.setState({
              clickText: "我点击了按钮",
              count: count + 1,
              detailContent: false
            })
          }
        
        render() {
            console.log("render1111");
            return (
              <View style={styles.container}>
                <Text>欢迎来到首页</Text>
                <TouchableOpacity
                  onPress={() => Actions.notice()}
                >
                  <Text>跳转到公告页</Text>
                </TouchableOpacity>
                <Text style={{color: 'blue', fontSize: 40}}>{this.state.count}</Text>
                <TouchableOpacity
                  style={styles.button}
                  onPress={() => this.clickButton()}
                >
                  <Text>{this.state.clickText}</Text>
                </TouchableOpacity>
                <HomeDetails detailContent={this.state.detailContent}/>
              </View>
            )
        }
        ```
3. `componentWillMount:`
    1. 组件将要被加载到视图之前调用,相当于iOS的`ViewVillAppear`
4. `render:`
    1. 相当于iOS的ViewDidLoad
    2. render是一个组件必须有的方法，本质上是一个函数，并返回JSX或其他组件来构成DOM.
    3. 注意：**只能返回一个顶级元素。**
    4. 此外在render中，可以通过`this.props/this.state`来访问在之前初始化的值。
5. componentDidMount:
    1. 在调用了render方法，组件加载成功并被成功渲染出来之后，所要执行的后续操作，一般都会在这个函数中进行，比如**经常要面对的网络请求等加载数据操作**
    2. 因为UI已经成功渲染，而且这里面是**异步**的，所以放在这个函数进行数据的请求等复杂的操作，不会出现UI错误

### 存在阶段函数功能分析

```
shouldComponentUpdate:一般用于优化，可以返回false或true来控制是否进行渲染(true 的话进行下2步操作，false不会进行下去)
componentWillUpdate: 组件刷新前调用
componentDidUpdate：更新后
componentWillReceiveProps:指父元素对组件的props或state进行了修改
```

### 销毁阶段函数功能分析
1. `componentWillUnmount`
    1. 用于清理一些无用的内容，比如：定时器清除


### 生命周期方法总结

![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/reactive-06.png)

