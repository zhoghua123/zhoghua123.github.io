---
layout: post
title: 网络篇N:Socket
category: iOS开发
tags: 网络
description: 网络
--- 

## Socket的概念
1. Socket又称"套接字”
2. 网络上的两个程序通过一个**双向的通信连接实现数据的交换**，这个连接的一端称为一个**socket**。
3. 应用程序通常通过"套接字"向网络发出请求或者应答网络请求

    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/socket1.png) 

## 进行网络通信的要素
1. Socket:网络上的请求就是通过**Socket来建立连接然后互相通信**
2. IP地址:（网络上主机设备的唯一标识）
3. Port端口号:(定位程序/应用进程)
    1. 网络通信实际上是两个主机上的应用进程之间的通信,IP地址只能定位到主机,但是还需要定位到该台主机上的应用进程,因此就需要用端口号来唯一标识这台主机上的应用进程 
    2. 用于标示进程的逻辑地址，不同进程的标示（简单的理解，一个进程就是一个应用程序）
    3. 有效端口：0~65535，其中0~1024由系统使用或者保留端口，开发中建议使用1024以上的端口
4. 传输协议:（用什么样的方式进行交互）
    1. 通讯的规则
    2. 常见协议：TCP、UDP 
        
        李四给张三发送消息: "请你吃饭"
     ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/socket2.png) 
        手机app的登录请求
      ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/socket3.png) 

## 传输协议
1. 协议:定义规则
2. TCP/UDP 协议
3. HTTP/HTTPS/XMPP 协议
4. eg举例:
    1. http:实现网络数据交换的一种协议
    2. 协议头(请求头/响应头)/协议体(请求体/响应体)
    3. 请求/响应
    4. 定义数据的传输格式!

### TCP & UDP 协议
1. TCP（传输控制协议）
    1. 建立连接，形成传输数据的通道
    2. 在连接中进行大数据传输（数据大小不收限制）
    3. 通过三次握手完成连接，是可靠协议，安全送达
    4. 必须建立连接，效率会稍低
2. UDP（用户数据报协议）
    1. 将数据及源和目的封装成数据包中，不需要建立连接
    2. 每个数据报的大小限制在64K之内
    3. 因为无需连接，因此是不可靠协议
    4. 不需要建立连接，速度快

### Socket-TCP通信流程图
 ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/socket4.png) 
从右边服务端TCP开始         

1. socket(): 每个端(客户端/服务端)都有一个socket,用来建立通信
2. bind():绑定端口号,服务器端每一个应用都有对应的端口号,就是创建一个服务应用,给这个应用设置一个端口号
3. listen(): 监听客户端随时发送的请求.(相当于有人按门铃)
4. accept(): 是否接受外部的请求(是否开门)
5. connect(): 客户端TCP开始建立连接
6. write(): 客户端向服务器发送请求
7. read(): 服务端开始读取客户端发送来的数据,然后处理
8. write(): 服务端处理数据后,将数据发送到客户端
9. read(): 客户端读取服务器发送来的数据,就这样重复6-8步骤,知道客户端发送close
10. close(): 请求完成,客户端发送关闭通道
11. read() : 服务器端接收客户端发送的请求,然后关闭close()

### 实例:实现socket服务端的监听
1. 主要实现的是socket编程,而不是http编程,有两种方式:
    1. 使用C语言实现，
    2. 使用CocoaAsyncSocket第三方框，内部是对C的封装成对象.用于socket编程
2. 用Telnet命令来代替客户端请求
    1. 使用: telnet host port(telnet + 主机+ 端口号)
    2. 举例: telnet 192.168.10.10 5288
    3. telnet命令作用是: 连接服务器上的某个端口对应的服务,说白了,就是代替客户端,进行连接服务器.
3. 步骤: 
    1. 服务器绑定端口
    2. 监听客户端的连接
    3. 允许客户端建立连接
    4. 读取客户端的请求数据
    5. 处理客户端的请求数据
    6. 响应客户端的请求数据
4.  CocoaAsyncSocket框架:
    1. 下载框架后,在目录中: source->GCD->可以发现有2个.m文件: `GCDAsyncSocket`/`GCDAsyncUdpSocket`
    2. socket又分为TCP和UDP传输协议,TCP需要建立连接,UDP不需要建立连接.
    3. `GCDAsyncSocket`是TCP,`GCDAsyncUdpSocket`是UDP
    4. 因此,我们使用的时候只需要`GCDAsyncSocket`就可以了.
5. 创建项目
    1. 打开Xcode新建项目: macOS->command Line Tool->创建
    2. 把GCDAsyncSocket.h/GCDAsyncSocket.m两个文件导入到项目中
    2. 


