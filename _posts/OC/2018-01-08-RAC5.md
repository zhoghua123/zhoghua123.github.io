---
layout: post
title: RAC系列4之 软件架构MVC与MVVM
category: iOS开发
tags: RAC
description: RAC
---

## MVC都是怎么回事?
### 控制器都干了什么?
1. 展示UI(添加/赋值/刷新UI)
2. 逻辑控制(界面跳转/各个子控件之间的逻辑)
3. 处理数据
    1. 请求数据,获得模型数组
    2. 搜集界面的数据,处理上传到服务器

### view都干了什么?
1. 拿到数据源(model)赋值展示数据(cell)
2. 封装:实现子view之间的逻辑,自身的功能
3. 用户交互改变模型的数据

### model都干了什么?
1. 数据都转为属性
2. 添加辅助属性
    1. 有时候服务器返回的数据并不能直接展示,需要处理后才能直接展示到view上,该属性一般为readonly,.m中自己添加下划线的成员变量,从写get方法,处理过程放在get方法中

## MVVM想干啥?
1. 抽取掉控制器中的不必要代码到viewModel中
2. 从MVC中可以看出,控制器中哪些不必要呢?
    1. 各个子控件之间的逻辑过程
    2. 网络请求处理过程
    3. 网络上传数据处理的过程
3. 抽取之后会变成什么效果呢?
    1. 控制器用viewModel来获取网络数据,处理数据源,更新模型数据
    2. 控制器用viewModel来搜集数据,上传服务器数据
    3. 控制器用viemModel来控制各个子控件的逻辑

## iOS中MVC的标准架构
> 这里就不扯什么高大上的语言了,直接上代码

### 代码举例:
1. 控制器C

    ```javascript
    #import "ViewController.h"
    #import "PersonModel.h"
    #import "PeopleViewCell.h"
    @interface ViewController ()<UITableViewDataSource,UITableViewDelegate>
    @property (nonatomic,weak) UITableView *tableView;
    //数据源
    @property (nonatomic,strong) NSMutableArray *dataSource;
    @end
    
    @implementation ViewController
    -(NSMutableArray *)dataSource{
        if (_dataSource == nil) {
            _dataSource = [NSMutableArray array];
        }
        return _dataSource ;
    }
    - (void)viewDidLoad {
        [super viewDidLoad];
        //1.初始化UI
        UITableView *tableView = [[UITableView alloc] initWithFrame:self.view.bounds];
        tableView.dataSource = self;
        tableView.delegate = self;
        [self.view addSubview:tableView];
        self.tableView = tableView;
        [tableView registerNib:[UINib nibWithNibName:@"PeopleViewCell" bundle:nil] forCellReuseIdentifier:@"PeopleViewCell"];
        //2. 网络请求
        [self requestAction];
    }
    
    #pragma mark - UITableViewDataSource
    
    - (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath{
        return 130;
    }
    
    - (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section{
        return self.dataSource.count;
    }
    - (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
        PeopleViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"PeopleViewCell"];
        //只给cell传递模型,不暴露cell的其他属性
        cell.model = self.dataSource[indexPath.row];
        return cell;
    }
    
    
    #pragma mark - 网络请求
    -(void)requestAction{
        //1.相当于网络请求
      NSString *filePath =  [[NSBundle mainBundle] pathForResource:@"data.plist" ofType:nil];
        NSMutableArray *data1 = [[NSMutableArray alloc] initWithContentsOfFile:filePath];
        //2.拿到数据: 字典数组转为模型数组
        for (NSDictionary *dic in data1) {
            PersonModel *model = [[PersonModel alloc] initWithDict:dic];
            [self.dataSource addObject:model];
        }
        //3. 刷新界面
        [self.tableView reloadData];
        NSLog(@"%@",data1);
    }
    @end
    ```

2. 模型(Model)

    ```javascript
    #import <Foundation/Foundation.h>
    
    @interface PersonModel : NSObject
    @property (nonatomic,copy) NSString *userNickName;
    @property (nonatomic,copy) NSString *province;
    @property (nonatomic,copy) NSString *city;
    @property (nonatomic,copy) NSString *village;
    @property (nonatomic,copy) NSString *town;
    @property (nonatomic,copy) NSString *userSex;
    
    //辅助属性(因此有些逻辑不一定非要放到控制器中)
    @property (nonatomic,copy) NSString *familyAdress;
    @property (nonatomic,copy) NSString *sex;
    
    -(instancetype)initWithDict:(NSDictionary *)dic;
    @end
    
    #import "PersonModel.h"
    
    @implementation PersonModel
    -(instancetype)initWithDict:(NSDictionary *)dic{
        if (self = [super init]) {
            _userNickName = dic[@"userNickName"];
            _province = dic[@"province"];
            _city = dic[@"city"];
            _village = dic[@"village"];
            _town = dic[@"town"];
            _userSex = dic[@"userSex"];
        }
        return self;
    }
    -(NSString *)sex{
        _sex = [_userSex boolValue] ?  @"女": @"男";
        return _sex;
    }
    -(NSString *)familyAdress{
        _familyAdress = [NSString stringWithFormat:@"%@%@%@%@",_province,_city,_village,_town];
        return _familyAdress;
    }
    @end
    ```
    
3. view(xib定义的cell)

    ```javascript
    #import <UIKit/UIKit.h>
    @class PersonModel;
    @interface PeopleViewCell : UITableViewCell
    @property (nonatomic,strong) PersonModel *model;
    @end

    #import "PeopleViewCell.h"
    #import "PersonModel.h"
    @interface PeopleViewCell()
    @property (weak, nonatomic) IBOutlet UILabel *nameLabel;
    @property (weak, nonatomic) IBOutlet UILabel *sexLabel;
    @property (weak, nonatomic) IBOutlet UILabel *adressLabel;
    
    @end
    @implementation PeopleViewCell
    
    - (void)awakeFromNib {
        [super awakeFromNib];
        _adressLabel.preferredMaxLayoutWidth = [UIScreen mainScreen].bounds.size.width - 15;
    }
    
    //从写模型set方法
    -(void)setModel:(PersonModel *)model{
        _model = model;
        _nameLabel.text = model.userNickName;
        _sexLabel.text = model.sex;
        _adressLabel.text = model.familyAdress;
    }
    @end

    ```
### MVC总结(标准MVC 的特点)
1. 控制器C:
    1. 控制器有一个数据源模型数组(当然有时也可以是单个模型)属性
    2. 控制器发送网络请求更新模型,然后刷新数据
 
2. 视图View(cell):
    1. view有一个模型属性,通过这个模型来获取所要展示的数据(model的set方法重写)
    2. view的.h不暴露任何子控件属性,所有的展示逻辑全部放在.m内部
3. 模型Model:
    1. 提供数据展示所需的属性
    2. 提供一个字典转模型的方法(当然也可以不提供,通过MJExtension)
    3. 添加辅助属性(当服务器的返回数据不能直接展示时,我们可以添加辅助属性,然后从写该属性的get方法,在get方法中处理成可以直接展示的属性)


