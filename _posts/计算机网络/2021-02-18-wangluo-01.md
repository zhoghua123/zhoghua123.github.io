---
layout: post
title: 网络协议四：物理层、链路层
category: 计算机网络
tags: 计算机网络
description: 计算机网络
---

> 网络分成

![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-20.png)

## 物理层
1. 物理层定义了接口标准、线缆标准、传输速率、传输方式等

### 数字信号、模拟信号
1. 模拟信号（Analog Signal）
    1. 连续的信号，适合长距离传输
    2. 抗干扰能力差，受到干扰时波形变形很难纠正
2. 数字信号（Digital Signal）
    1. 离散的信号，不适合长距离传输
        2. 抗干扰能力强，受到干扰时波形失真可以修复

### 数据通信模型
1. **注意：**网线不能超过100米

![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-21.png)

### 数据通信模型
1. 信道：信息传输的通道，一条传输介质上（比如网线）上可以有多条信道
2. 单工通信
    1. 信号只能往一个方向传输，任何时候都不能改变信号的传输方向
    2. 比如无线电广播、有线电视广播
3. 半双工通信
    1. 信号可以双向传输，但必须是交替进行，同一时间只能往一个方向传输
    2. 比如对讲机
4. 全双工通信
    1. 信号可以同时双向传输
    2. 比如手机（打电话，听说同时进行）

## 数据链路层（Data Link）
1. 链路：从1个节点到相邻节点的一段物理线路（有线或无线），中间没有其他交换节点
2. 数据链路：在一条链路上传输数据时，需要有对应的通信协议来控制数据的传输
    1. 不同类型的数据链路，所用的通信协议可能是不同的
        1. 广播信道：CSMA/CD协议（比如同轴电缆、集线器等组成的网络）
        2. 点对点信道：PPP协议（比如2个路由器之间的信道）
3. 数据链路层的3个基本问题
    1. 封装成帧
    2. 透明传输
    3. 差错检验
    
### 封装成帧
![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-22.png)

1. 帧（Frame）的数据部分
    1. 就是网络层传递下来的数据包（IP数据包，Packet）
2. 最大传输单元MTU（Maximum Transfer Unit）
    1. 每一种数据链路层协议都规定了所能够传送的帧的数据长度上限
    2. 以太网的MTU为1500个字节

### 透明传输
1. 使用SOH（Start Of Header）作为帧开始符
2. 使用EOT（End Of Transmission）作为帧结束符
3. 但是如果**数据中**间部分出现了EOT，那么就会造成数据丢失，因此为了防止这种现象：数据部分一旦出现了SOH、EOT，就需要进行转义-填充一个字节ESC

![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-23.png)

### 差错检验

![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-24.png)

1. FCS是根据数据部分 + 首部计算得出的一个值
2. 传输到目的地时也会计算一次，然后与传输过来的FCS进行比较，查看是否一致

### CSMA/CD协议
1. CSMA/CD（Carrier Sense Multiple Access with Collision Detectio）
    1. 载波侦听多路访问/冲突检测
2. 使用了CSMA/CD的网络可以称为是以太网（Ethernet），它传输的是以太网帧
    1. 以太网帧的格式有：Ethernet V2标准、IEEE的802.3标准
    2. 使用最多的是：Ethernet V2标准
3. 为了能够检测正在发送的帧是否产生了冲突，以太网的帧至少要64字节
4. 用交换机组建的网络，已经支持全双工通信，不需要再使用CSMA/CD，但它传输的帧依然是以太网帧
    1. 所以，用交换机组建的网络，依然可以叫做以太网

#### Ethernet V2帧的格式
![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-25.png)

1. 首部：目标MAC +源MAC + 网络类型
2. 以太网帧：首部 + 数据 + FCS
3. 数据的长度至少是：64 – 6 – 6 – 2 – 4 = 46字节

#### Ethernet V2标准
1. 当数据部分的长度小于46字节时
    1. 数据链路层会在数据的后面加入一些字节填充
    2. 接收端会将添加的字节去掉
2. 长度总结
    1. 以太网帧的数据长度：46~1500字节
    2. 以太网帧的长度：64~1518字节（目标MAC +源MAC + 网络类型 + 数据 + FCS）

### 网卡
![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-26.png)

1. 网卡接收到一个帧，首先会进行差错校验，如果校验通过则接收，否则丢弃
2. 网卡工作在数据链路层、物理层
3. Wireshark抓到的帧没有FCS ，因为它抓到的是差错校验通过的帧（帧尾的FCS会被硬件去掉）
    1. Wireshark抓不到差错校验失败的帧

## 网络层（Network）
1. 网络层数据包（IP数据包，Packet）由首部、数据2部分组成
    1. 数据：很多时候是由传输层传递下来的数据段（Segment）

![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-27.png)

