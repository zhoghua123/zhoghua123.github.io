---
layout: post
title: 网络协议六：应用层
category: 计算机网络
tags: 计算机网络
description: 计算机网络
---


1. 应用层的常见协议
    1. 超文本传输：HTTP、HTTPS
    2. 文件传输：FTP
    3. 电子邮件：SMTP、POP3、IMAP
    4. 动态主机配置：DHCP
    5. 域名系统：DNS

### 域名（Domain Name）
1. 由于IP地址不方便记忆，并且不能表达组织的名称和性质，人们设计出了域名（比如baidu.com）
    1. 但实际上，为了能够访问到具体的主机，最终还是得知道目标主机的IP地址
    2. 域名申请注册：[https://wanwang.aliyun.com/](https://wanwang.aliyun.com/)
2. 那干脆全程直接用域名，不用IP地址？
    1. IP地址固定4个字节，域名随随便便都至少10几个字节，这无疑会增加路由器的负担，浪费流量
3. 根据级别不同，域名可以分为
    1. 顶级域名（Top-level Domain，简称TLD）
    2. 二级域名
    3. 三级域名
    4. ...

#### 顶级域名的分类
1. 通用顶级域名（General Top-level Domain，简称gTLD）
    1. .com（公司），.net（网络机构），.org（组织机构），.edu（教育）
    2. .gov（政府部门），.int（国际组织）等
2. 国家及地区顶级域名（Country Code Top-level Domain，简称ccTLD）
    1. .cn（中国）、.jp（日本）、.uk（英国）
3. 新通用顶级域名（New Generic Top-level Domain，简称：New gTLD）
    1. .vip、.xyz、.top、.club、.shop等
    
#### 二级域名
1. 二级域名是指顶级域名**之下**的域名
    1. 在通用顶级域名下，它一般指域名注册人的名称，例如google、baidu、microsoft等
    2. 在国家及地区顶级域名下，它一般指注册类别的，例如com、edu、gov、net等
    3. 举例：baidu.com,其中.com为顶级域名，baidu为二级域名

### DNS
1. DNS的全称是：Domain Name System，译为：域名系统
    1. 利用DNS**协议**，可以将域名（比如baidu.com）解析成对应的IP地址（比如220.181.38.148）
    2. DNS可以基于UDP协议，也可以基于TCP协议，服务器占用**53端口**
    3. DNS也是一个应用层的网络协议，跟HTTP一样
    4. 比如：在浏览器输入http://www.baidu.com回车，它首先要通过**DNS协议**发送**DNS数据包**到**DNS服务器**去访问获取到百度的IP地址，然后才能通过IP地址进行访问百度的服务器
    5. DNS有缓存，下次再请求时就不需要进行访问了
2. DNS服务器
    1. 客户端首先会访问最近的一台DNS服务器（也就是客户端自己配置的DNS服务器）
    2. 所有的DNS服务器都记录了DNS根域名服务器的IP地址
    3. 上级DNS服务器记录了下一级DNS服务器的IP地址
    4. 全球一共13台IPv4的DNS根域名服务器、25台IPv6的DNS根域名服务器
3. DNS常用命令
    1. ipconfig /displaydns：查看DNS缓存记录
    2. ipconfig /flushdns：清空DNS缓存记录
    3. ping 域名
    4. nslookup 域名
    
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-47.png)

### DHCP
#### 1.IP地址的分配
1. IP地址按照分配方式，可以分为：静态IP地址、动态IP地址
    1. 静态IP地址
        1. 手动设置
        2. 适用场景：不怎么挪动的台式机（比如学校机房中的台式机）、服务器等
2. 动态IP地址
    1. 从**DHCP服务器**自动获取IP地址
    2. 适用场景：移动设备、无线设备等

#### 2.DHCP
1. DHCP（Dynamic Host Configuration Protocol），译为：动态主机配置**协议**
    1. DHCP协议基于UDP协议，客户端是**68端口**，服务器是**67端口**
    2. DHCP也是个协议，也有对应的服务器
2. DHCP**服务器**会从IP地址池中，挑选一个IP地址“出租“给客户端一段时间，时间到期就回收它们
    1. 平时家里上网的路由器就可以充当**DHCP服务器**
    
#### 3.分配IP地址的4个阶段
1. DISCOVER：发现服务器
    1. 发广播包（源IP是0.0.0.0，目标IP是255.255.255.255，目标MAC是FF:FF:FF:FF:FF:FF）
    2. 发广播就意味着当前主机可以没有IP地址，直接广播发出去
    3. 目的就是查找附近有哪些DHCP服务器可以使用
2. OFFER：提供租约
    1. 找到DHCP服务器之后，服务器返回可以租用的IP地址，以及租用期限、子网掩码、网关、DNS等信息
    2. 注意：这里可能会有多个服务器提供租约
3. REQUEST：选择IP地址
    1. 客户端选择一个OFFER，发送广播包进行回应
4. ACKNOWLEDGE：确认
    1. 被选中的服务器发送ACK数据包给客户端
    2. 至此，IP地址分配完毕

![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-48.png)

#### 4.细节
1. DHCP服务器可以跨网段分配IP地址么？（DHCP服务器、客户端不在同一个网段）
    1. 可以借助DHCP中继代理（DHCP Relay Agent）实现跨网段分配IP地址
2. 自动续约
    1. 客户端会在租期不足的时候，自动向DHCP服务器发送REQUEST信息申请续约
3. 常用命令
    1. ipconfig /all：可以看到DHCP相关的详细信息，比如租约过期时间、DHCP服务器地址等
    2. ipconfig /release：释放租约
    3. ipconfig /renew：重新申请IP地址、申请续约（延长租期）

## HTTP
1. HTTP（Hyper Text Transfer Protocol），译为超文本传输协议
    1. 是互联网中应用最广泛的应用层协议之一
    2. 设计HTTP最初的目的是：提供一种发布和接收HTML页面的方法，由URI(URI包括URL)来标识具体的资源
    3. 后面用HTTP来传递的数据格式不仅仅是HTML，应用非常广泛
2. 版本
    1. 1991年，HTTP/0.9
        1. 只支持GET请求方法获取文本数据（比如HTML文档），且不支持请求头、响应头等，无法向服务器传递太多信息
    2. 1996年，HTTP/1.0
        1. 支持POST、HEAD等请求方法，支持请求头、响应头等，支持更多种数据类型（不再局限于文本数据）
        2. 浏览器的每次请求都需要与服务器建立一个TCP连接，请求处理完成后立即断开TCP连接
    3. 1997年，HTTP/1.1（最经典、使用最广泛的版本）
        1. 支持PUT、DELETE等请求方法
        2. 采用持久连接（Connection: keep-alive），多个请求可以共用同一个TCP连接
    4. 2015年，HTTP/2.0
    5. 2018年，HTTP/3.0
3. 标准
    1. HTTP的标准
        1. 由万维网协会（W3C）、互联网工程任务组（IETF）协调制定，最终发布了一系列的RFC
    2. RFC（Request For Comments，可以译为：请求意见稿）
        1. HTTP/1.1最早是在1997年的RFC 2068中记录的
            1. 该规范在1999年的RFC 2616中已作废
            2. 2014年又由RFC 7230系列的RFC取代
        2. HTTP/2标准于2015年5月以RFC 7540正式发表，取代HTTP/1.1成为HTTP的实现标准
    3. 中国的RFC
        1. 1996年3月，清华大学提交的适应不同国家和地区中文编码的汉字统一传输标准被IETF通过为RFC 1922
        2. 成为中国大陆第一个被认可为RFC文件的提交协议
4. 报文格式
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-49.png)
    
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-50.png)
    
    1. 首部行：就是请求头、响应头，都是key（首部字段名）、value（值）键值对
    2. 实体主题： 就是请求体、响应体
    3. get请求没有请求体
5. ABNF（Augmented BNF）
    1. 是BNF（Backus-Naur Form，译为：巴科斯-瑙尔范式）的修改、增强版
    2. 在RFC 5234中表明：ABNF用作internet中通信协议的定义语言
    3. ABNF是最严谨的HTTP报文格式描述形式，脱离ABNF谈论HTTP报文格式，往往都是片面、不严谨的
6. 关于HTTP报文格式的定义
    1. RFC 2616 4.HTTP Message（旧）
    2. RFC 7230 3.Message Format（新）

