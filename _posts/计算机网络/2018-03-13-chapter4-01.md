---
layout: post
title: 第四章 介质访问子层(MAC层)
category: 计算机网络
tags: 计算机网络
description: 计算机网络
---

1. 一条物理媒体(线路)被多个用户共享
2. 这条物理媒体如何分配使用,这就是介质访问子层的作用
3. 局域网出来了以后,就把数据链路层分成2层: 
    1. 标准数据链路层工作,保证数据可靠传输
    2. 传输之前需要抓住一个信道的过程--介质访问子层

## 信道分配问题
1. 信道的静态分配(也就是把信道提前固定好,浪费)
    1. 频分多路复用FDM（Frequency Division Multiplexing）
    2. 时分多路复用TDM（Time Division Multiplexing）
    3. 静态分配的问题
        1. 延迟时间长
        2. 信道利用率低
    4. 局域网中很少采用静态分配方法,大多数采用动态分配.
2. 信道的动态分配

## 多路访问协议
1. 纯ALOHA
2. 分隙ALOHA
3. 载波侦听多路访问协议CSMA

### 载波侦听多路访问协议CSMA
1. 载波侦听协议（Carrier Sense Protocol） 
2. 意思: 比前两种有礼貌,当我这个站点要发送数据(讲话)时,先听一听有没有别人在讲话,如果有人在讲,我就不讲,如果没人讲,我讲.
3. 根据侦听方式分为: 持续和非持续CSMA （Carrier Sense Multiple Access，载波侦听多路访问）
    1. 1 – 持续CSMA
        1. 每个站在发送前，先侦听信道，如信道正忙，则等待并持续侦听，一旦信道空闲，立即发送，即发送的概率为1；如冲突(尽管先侦听还是会发生冲突,同时发送时)，则延时一随机时隙数后，重新发送 
    2. 非持续CSMA（Nonpersistent CSMA)
        1. 每个站在发送前，先侦听信道，如信道正忙，则不再继续侦听，而是延时一随机时隙数后，再侦听信道
    3. p – 持续CSMA（p-persistent CSMA）
        1. 更有礼貌
        2. 用于分隙信道
        3. 先侦听信道，如信道正忙，则等到下一时隙；如信道空闲，则以概率p发送，而以概率q=(1-p)把本次发送延至下一时隙，直至发送成功 
        4. 用于非常繁忙的传输
4. CSMA协议的冲突和冲突检测
    1. CSMA并不能完全解决冲突问题,如两个或多个准备发送的站都检测到信道空闲而同时发送将发生冲突
    2. 带冲突检测的CSMA
        1. CSMA/CD: 带冲突检测的载波侦听多路访问 
        2. 要点: 
            1. 在一帧传输完成后的时刻t0，想要发送的站点都可以尝试发送
            2. 如两个或多个站点同时发送则发生冲突 
            3. 判断出冲突后，立即停止发送，并延时一个随机时隙数后，通常其中的一个站点将发送成功 
    3. 这总工作机制用的最多,以太网就是
5. 无冲突的协议 
    1. 麻烦
6. 有限竞争协议
    1. 在低负荷时使用竞争法,在高负荷时使用无冲突法

## 以太网
1. 上面多种访问方式落实到具体的网络产品当中,以太网就是一个应用典型.
2. 标准以太网采用总线型结构.
3. 采用的访问方式是: CSMA/CD

### 以太网当中的电缆
1. 802.3标准,传输电缆分以下四种 
     ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/PCNet12.png)
2. 这个标准的产品就是10M的以太网.拓补结构为总线结构

#### 双绞线以太网(10BASE-T)
1. 连接图如下:       
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/PCNet13.png)
    1. 其物理接口为RJ-45
    2. 连线采用3类（或5类）双绞线，仅用两对线，且全双工 
    3. 距离为100 m 
    4. 编码采用曼切斯特编码 
    5. HUB上面有很多的RJ45的接口,每台计算机网卡上面也有一个RJ45的接口.用一根双绞线连接即可.
    6. 表面上是个星型结构,实际上还是总线型结构,只是把以太网总线移到了HUB里面.HUB上面的RJ45接口都连接到了总线上.
    7. 好处: 可靠性高,任意一台机器有问题,都没事.
2. RJ-45接口接线标准T-568B
    1. T-568B的直通线缆  
       ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/PCNet14.png)  
    2. 10Base-T 直通线缆 
        1. 交换机（或HUB）的RJ-45端口与主机网卡的RJ-45端口的连接电缆为直通（Straight-Through）的8芯5类线缆          
        ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/PCNet15.png)  
         ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/PCNet16.png) 
             
### 以太网MAC子层协议
1. 上面讲述了以太网的物理连接.
2. 以太网的帧结构
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/PCNet17.png) 

#### 帧结构字段说明
1. 先导字段
    1. 7个字节的10101010,连续7个字节都是，实际上下一个字符也是先导字段，只是最后的两位为1，表示紧接着的是真正的MAC帧 
    2. 8个字节的10101010的曼切斯特编码将产生10MHz，持续6. 4s的方波，周期为0.1s，可用于时钟同步  
2. 两个地址
    1. 目的地址和源地址都允许为2字节或6字节，在10M bps的基带以太网中是6字节
    2. 目的地址最高位为
        1. 0：普通地址
        2. 1：多点发送（Multicast）
        3. 目的地址全1：广播发送（Broadcast）
    3. 在6个字节（共48位）的地址中有46位用于地址的指定，即有246＝7.03687x1013个地址
    4. 网卡地址是一个全局地址(全球唯一),如：44-45-53-54-00-00 
3. 数据字段长度和校验和
    1. 字段长度: 指明数据的字节数，数据字段长度允许为0 
    2. 校验和: 4个字节共32位的CRC码 
4. 填充字段 
    1. 为保证帧的最短长度为64个字节
    2. 即：在数据字段长度为0时 
        1. 两个地址（12字节）+ 长度（2个字节）+ 填充字节+校验和（4个字节）= 64 
        2. 18字节+ 填充字节 = 64 
        3. 填充字节 = 46
    3. 所以填充字节为：0 ~ 46字节 
    4. 为什么帧的最短长度为64个字节?
        1. 因为以太网中使用的是 CSMA/CD访问.
        2. 为了确认发送帧是否正确到达目的站点，必须保证可能的冲突信号返回时帧的发送尚未结束，如在2τ内没有冲突信号返回，则发送成功，如果发送端在2τ时间内帧已经发送结束，则即使冲突也无法检测，即最短帧长应与2τ相当.2τ约等于51.2微秒,64个字节的长度传输月51.2微秒.

### 交换式以太网
1. 最简单的以太网络     
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/PCNet18.png) 
2. 交换式以太网络      
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/PCNet19.png) 


