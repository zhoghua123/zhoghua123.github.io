---
layout: post
title: 第五章 网络层(三)
category: 计算机网络
tags: 计算机网络
description: 计算机网络
---

### IP 控制协议 
1. 简介
    1. IP协议就是提供一种公共的数据格式,使得不同网络的数据可以相互传递
    2. IP协议只负责传送IP数据包，无法监视和控制网络中出现的一些问题，这些工作由Internet的控制协议来完成
        1. ICMP 
        2. ARP 
        3. RARP 、BOOTP和DHCP
    3. IP层除了IP协议之外还有很多的协议:ICMP /ARP /RARP 、BOOTP和DHCP等

#### ICMP 协议 (Internet Control Message Protocol)
1. 这个协议的主要作用就是处理IP网络传递当中出现的一些问题,比如数据报的丢失、重复、延迟、乱序等
2. ICMP提供了一种把通信服务中的差错向源站点报告的机制
3. 2个主要功能
    1. 传递一些差错信息
    2. 传递一些控制信息
    
##### ICMP报文格式
1. ICMP是控制消息和差错消息传递的一个报文,这个报文本身是由IP协议来传递的,这个报文会被当做IP的数据部分封装在一个IP的数据包里面,发送到相应的结点.
2. 这个报文本身又分为2个部分,跟所有的协议报文一样,分为报头部和数据区,数据区没有什么用,主要内容都在头部     
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/PCNet42.png) 
    
    1. 类型: 这一条ICMP是什么消息
    2. 代码: 消息的具体类型
    3. 校验和: 校验插座

##### ICMP报文主要类型
![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/PCNet43.png) 

1. 差错报文
    1. 提供网络当中出现的一些问题
2. 控制报文
    1. 传递一些控制信息
3. 请求应答报文
    1. 传递一些结点和结点之间的互通消息

##### ICMP应用举例
1. 测试报文的可达性 
    1. 使用ping命令（即调用ping过程）时，将向目的站点发送一个ICMP回应请求报文（包括一些任选的数据），如目的站点接收到该报文，必须向源站点发回一个ICMP回应应答报文，源站点收到应答报文（且其中的任选数据与所发送的相同），则认为目的站点是可达的，否则为不可达 
    2. ping命令的实现        
        ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/PCNet44.png) 
        
2. 路由跟踪(tracert（Unix下为traceroute）)
    1. tracert过程是通过ICMP数据报超时报文来得到一张途经路由器端口列表的 
    2. 源主机向目的主机发一个IP报文，并置hop为1，到达第一个路由器时，hop减1，为0，则该路由器回发一个ICMP数据报超时报文，源主机取出路由器的IP地址即为途经的第一个路由端口地址 
    3. 接着源主机再向目的主机发第二个IP报文，并置hop为2，然后再发第三个、第四个IP数据报，… …直至到达目的主机
    4. 但互联网的运行环境状态是动态的，每次路径的选择有可能不一致，所以，只有在相对较稳定（相对变化较缓慢）的互联网中，tracert才是有意义的
3. 得到路径中最小的MTU 
    1. 源主机发送一系列的探测IP数据报，并置DF = 1，即不允许分段，如途经某个网络的MTU较小，则路由器将丢弃该数据报并发回一个ICMP数据报参数错，要求分段，源主机则逐步减小数据报长度，并仍置DF = 1，直至某个探测报文成功到达目的主机，即得到路径中的最小MTU 

### IP 路由 


### IPv6 



