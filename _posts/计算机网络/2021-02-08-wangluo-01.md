---
layout: post
title: 网络协议三：路由
category: 计算机网络
tags: 计算机网络
description: 计算机网络
---

## 路由
1. 在不同网段之间转发数据，需要有路由器的支持
2. 默认情况下，路由器只知道跟它**直连**的网段，非直连的网段需要通过静态路由、动态路由告诉它
    1. 静态路由
        1. 管理员手动添加路由信息
        2. 适用于小规模网络
    2. 动态路由
        1. 路由器通过路由选择协议（比如RIP、OSPF）自动获取路由信息
        2. 适用于大规模网络
    
### 静态路由配置
![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-14.png)

1. 计算机0、1是通过路由器直连的2个网段
2. 计算机0如果想计算机3发送数据，这必须经过两个路由器，那么如何手动配置呢？ 
    1. 路由器0配置路由表如下：（实现计算机0向3发送数据）
        1. 网络：193.169.2.0  计算机2的网段地址
        2. 掩码： 255.255.255.0 计算机2的网段的子网掩码
        3. 下一跳：194.170.1.2 路由器1的端口IP地址
    2. 路由器3配置路由表如下：（实现计算机3向0发送数据）
        1. 网络：192.168.1.0  计算机0的网段地址
        2. 掩码： 255.255.255.0 计算机0的网段的子网掩码
        3. 下一跳：194.170.1.1 路由器1的端口IP地址
    3. 以上配置之后，便可以实现计算机0向计算机3相互通信
3. 下图让4台主机之间可以互相通信
    
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-15.png)
    
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-16.png)

### 数据包的传输过程
1. 这里仅仅是简述一下数据包的传输过程，后面详细学到网络分层时，会再次详细讲解数据包的传输过程
    
    ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-17.png)
    
    1. MAC地址获取过程： A发ARP广播到路交换机0的网段，获取路由器0的MAC地址,路由器0发送ARP广播到交换机1的网段获取路由器1的MAC地址，路由器1发送ARP广播到交换机2的网段获取F的MAC地址
    
### 计算机网络常识

#### 网络、互联网、因特网
1. 网络：就是一个网段，有交换机连接n台计算机，同属于一个网段
2. 全世界最大的互联网是：因特网（Internet）
    1. 将全世界所有的计算机都连接在一起，每个网段用路由器连接起来
    2. 一般使用大写I开头的Internet 特指因特网
    3. 日常生活中说的：你的电脑上不了网。其实就是指：你的电脑没有连接到因特网

#### ISP
1. ISP，Internet Service Provider，Internet服务提供商，比如移动、电信、网通、铁通等
    1. 我们平时拉的宽带都是通过ISP连接到Internet的
2. 因为只有政府才能有实力全国、全世界铺设网络，然我我们购买政府的服务

#### 网络分类
1. 按照网络的范围进行分类，可以分为：局域网、城域网、广域网等
2. 局域网（Local Area Network ,**LAN**）
    1. 一般是范围在几百米到十几公里内的计算机所构成的计算机网络
    2. 常用于公司、家庭、学校、医院、机关、一幢大楼等
    3. 局域网中使用最广泛的**网络技术**叫：**以太网（Ethernet）**
    4. 在电脑、手机上经常见到的一个英文WLAN（Wireless LAN），意思是无线局域网
3. 城域网（Metropolitan Area Network，**MAN**）
    1. 一般范围是数十公里到数百公里，可以覆盖一个城市
4. 广域网（Wide Area Network，**WAN**）
    1. 一般范围是几百公里到几千公里，可以覆盖一个国家。通常都需要租用ISP的线路。

#### 常见的几种接口
1. FastEthernet
    1. 快速以太网接口（100M）
    2. 常见的电脑、路由器、交换机上的网线插口
2. GigabitEthernet
    1. 千兆以太网接口
3. Serial
    1. 串行接口
    2. 常见电脑上一排针孔的插口
    
#### 上网方式
1. 电话线入户
    1. 这就是平时说的：ADSL电话拨号上网（Asymmetric Digital Subscriber Line)
        1. 非对称数字用户线路，提供上、下行不对称的传输带宽
        2. 下行：服务器到计算机；上行：计算机到服务器
    2. 猫（Modem），**调制解调器**，进行数字信号和模拟信号的转换
        1. 电话线传送模拟信号，计算机接收数字信号01
2. 光纤入户
    1. 光猫（Optical Modem），光调制解调器，进行数字信号和光信号的转换
3. 网线入户
    1. 光纤入户到小区，然后每层接交换机，交换机接网线到家庭
    
![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-18.png)
#### 家用无线路由器的逻辑结构

![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/wlxy-19.png)

### 公网IP、私网Ip
1. IP地址也分为：公网IP、私网IP
2. 公网IP（Public）
    1. Internet上的路由器中只有到达公网的路由表，没有到达私网的路由表
    2. 公网IP由因特网信息中心（Internet Network Information Center，Inter NIC）统一分配和管理
    3. 就是一个机构专门给每个国家的某个组织分配一些公网的IP地址用来使用
    4. ISP需要向Inter NIC申请公网IP
3. 私网IP（Private）
    1. 主要用于局域网。下面是保留的私网网段
        1. A类：10.0.0.0/8，1个A类网络
        2. B类：172.16.0.0/16 ~ 172.31.0.0/16 ，16个B类网络
        3. C类：192.168.0.0/24 ~ 192.168.255.0/24 ，256个C类网络
4. 疑问：既然Internet上的路由器中只有到达公网的路由表,那么由因特网连接的不同局域网的两台PC是怎么通信的呢？ 这时就需要两台局域网PC将自己的局域网IP转化为公网IP------NAT

#### NAT
1. 私网IP访问Internet需要进行NAT转换为公网IP
    1. NAT(Network Address Translation)
    2. 这一步可以由路由器来完成
2. NAT的特点
    1. 可以节约公网IP资源
    2. 会隐藏内部真实IP
3. NAT的分类
    1. 静态转换
        1. 手动配置NAT映射表（一个私网IP对应一个公网IP的表格）
        2. 一对一转换
    2. 动态转换
        1. 定义外部地址池，动态随机转换
        2. 一对一转换
    3. PAT(Port Address Translation)(最终解决方案)
        1. 多对一转换，最大程度节约公网IP资源(n个私有IP对一个一个公网IP)
        2. 采用端口多路复用方式，通过**端口号**标识不同的数据流(就是通过端口号来区分不同的私网IP)
        3. 注意：这个端口号不是服务器端的端口号
        4. 目前应用最广泛的NAT实现方式


