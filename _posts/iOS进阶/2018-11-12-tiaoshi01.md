---
layout: post
title: Xcode的动态调试
category: iOS进阶
tags: 调试
description: 调试
---

## 简述
1. 什么叫动态调试？
    1. 􏰊􏰋􏰌􏰍􏰎􏰏􏰐􏰑􏰒􏰓􏰔􏰕􏰖􏰁􏰗􏰘􏰙􏰚􏰛􏰑􏰜􏰝􏰞􏰟􏰁􏰠􏰡􏰢􏰁􏰣􏰟􏰇􏰤􏰥􏰋􏰙􏰊􏰋􏰌􏰍􏰎􏰏􏰐􏰑􏰒􏰓􏰔􏰕􏰖􏰁􏰗􏰘􏰙􏰚􏰛􏰑􏰜􏰝􏰞􏰟􏰁􏰠􏰡􏰢􏰁􏰣􏰟􏰇􏰤􏰥􏰋􏰙􏰊􏰋􏰌􏰍􏰎􏰏􏰐􏰑􏰒􏰓􏰔􏰕􏰖􏰁􏰗􏰘􏰙􏰚􏰛􏰑􏰜􏰝􏰞􏰟􏰁􏰠􏰡􏰢􏰁􏰣􏰟􏰇􏰤􏰥􏰋􏰙将程序运行起来，通过下断点、打印等方式，查看参数、返回值、函数调用流程等。
2. Xcode的动态调试原理
    1. 通常我们使用的打断点、调试窗口输入命令打印等这些功能都是LLDB这个调试器的功能。
    2. 如下关系图
        
        ![图1](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/tiaoshi01.png)
        
        1. MAC方面
            1. MAC上装有Xcode，Xcode内部嵌入有LLDB调试器
        2. 设备方面
            1. 设备上自带的有debugserver，专门用于对应LLDB的调试
        3. 调试过程
            1. Xcode调试窗口通过输入LLDB指令，给设备的debugserver
            2. debugserver接受到这个指令后执行到相应的APP上
            3. APP执行调试指令然后将执行的反馈信息返回给debugserver
            4. debugserver将这个信息反馈给LLDB
            5. LLDB将这个返回的信息，打印出来
3. GCC、LLVM、GDB、LLDB都是什么？
    1. GCC、LLVM都是编译器
        1. Xcode内置有编译器
        2. 打开项目-target->build setting ->搜索compiler（编译器)->能看见编译器就是LLVM
        3. 早期的Xcode（<4）内置的编译器是GCC，后来的就是LLVM
    2. GDB、LLDB都是调试器
        1. Xcode的调试器发展历程:GDB->LLDB
4. debugserver
    1. 一开始存放在MAC的Xcode中
    2. /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/De viceSupport/9.1/DeveloperDiskImage.dmg/usr/bin/debugserver
    3. 当Xcode识别到手机设备时，Xcode会自动将debugserver安装到iPhone上,且仅仅在这个手机第一次调试时安装一次
        1. 位置： /Developer/usr/bin/debugserver
    4. Xcode调试的局限性
        1. 一般情况下，只能调试**通过Xcode安装**的APP
5. 动态调试任意的APP（**逆向破解学习**）
    1. 从上面我们知道Xcode调试必须是先运行真机设备，而且保持Xcode一直运行在真机，然后才能调试
    2. 但是如果我想调试任意的APP呢？
    3. 。。。。。


## LLDB指令
1. 指令格式：
    
    ```
    <command> [<subcommand> [<subcommand>...]] <action> [-options [option- value]] [argument [argument...]]
    ```
    
    1. 其中，[] 代表可有可无
    2. command： 命令
    3. subcommand： 子命令
    4. action：命令操作
    5. options： 命令选项
    6. argument ： 命令参数
    7. 比如给test函数设置断点：
        
        ```
        breakpoint set -n test
        ```
2. help
    1. 查看指令的用法
    2. 比如：help breakpoint􏰁help、 breakpoint set
3. expression <cmd-options>--<expr>
    1. 执行一个表达式
    2. <cmd-options>:命令选项
    3. --： 命令选项结束符，表示所有的命令选项已设置完毕，如果没有命令选项，--可以省略
    4. <expr>:需要执行的表达式
    5. 举例：
        
        ```
        //在某个控制器代码处打个断点，然后在lldb输入一下命令，回车
        expression self.view.backgroundColor = [UIColor redColor]
        //然后继续点击箭头，放开断点，就会发现项目执行了这句代码。
        ```
    6. expression、expression--和指令print、p、call的效果一样
    7. expression-O--和指令po的效果一样。
    8. 因此，综上所述，通常用P/po就可以了
        1. P通常跟表达式
        2. po 通常跟对象

4. thread backtrace
    1. 打印线程的堆栈信息（其实就是函数调用栈）
    2. 和指令Bt效果一样
        1. 在某个函数中打个断点，然后输入改指令，回车
        2. 会出现一堆frame开头的东西
        3. 一个frame代表一个函数栈帧
        4. 可以看到，当前打断点的函数是由哪些函数一层一层调用过来的。
5. thread return [返回的数据]
    1. 让函数直接返回某个值，不执行断点后面的代码
6. frame variable [变量名]
    1. 打印当前栈帧的变量
    2. 不写变量名，打印出所有变量值
7. 调试窗口上面的按钮对应的命令：
    1. thread continue、􏰁continue􏰁、c ：程序继续运行
    2. thread step-over、􏰁next􏰁、n ：单步运行，把子函数当做整体，一步执行。
    3. hread step-in􏰁、step􏰁、s ：单步运行，遇到子函数会进入子函数。
    4. thread step-out􏰁、finish 􏰲：􏲞􏲟􏱚􏰎􏲲􏰺􏲤􏰣􏰟􏰧􏱾􏲳􏲢􏲣􏰑􏰠􏰡􏰽􏱇􏰀􏱢􏰣􏰟直接执行完当前函数的所有代码，返回到上一个函数
8. breakpoint set
    1. 设置断点
    2. breakpoint set -a 􏰣􏰟􏱬􏱭函数地址
    3. breakpoint set -n 􏰣􏰟􏱻函数名
        1. `breakpoint set -n test`
        2. `breakpoint set -n touchesBegan:withEvent:`
        3. `breakpoint set -n "-[ViewController touchesBegan:withEvent:]"`
    4. breakpoint set -r 正则表达式
    5. breakpoint set -s 动态库-n函数名
9. 小技巧
    1. 点击enter，会自动执行上次的命令
    2. 绝大部分指令都可以使用缩写。


