---
layout: post
title: 第六章：小程序云开发简介、云数据库
category: 小程序开发
tags: 小程序
description: 小程序开发
--- 

## 简介
1. 什么是云开发？ 
    1. 传统的开发模式需要专门的后台人员开发服务用来存储数据，云开发专门提供了后台功能，不需要后台人员开发服务，前端人员直接可以操作。
2. 云开发的模式 
    ![pic](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/xcxpic15.png) 
3. 云开发模式和传统模式对比
    ![pic](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/xcxpic16.png) 
4. 云开发主要包含三大核心技术:
    1. **云数据库:**
        1. 提供在小程序端直接对数据库进行增删改查的能力;
        2. 数据库是类似于MongoDB的文档存储的数据库，操作非常方便;
    2. **云存储:**
        1. 可以在小程序端直接上传、下载、删除文件;
        2. 自带CDN，提高文件访问速度;
        3. 可以获取临时链接，支持在小程序外访问;
    3. **云函数:**(对数据库、云存储能力的补充扩充)
        1. 提供了在服务器代码的执行能力;
        2. 包含微信天然的私有鉴权;
        3. 更大权限的操作数据库等;
        4. 进行云调用、HTTP请求等操作;
5. 初始化项目
    1. 打开“微信卡发者工具” -> 项目命名为“StudyCloud” ->选择项目目录 ->APPID(注意：云开发必须使用申请的id，不能使用测试号)->后端服务勾选： 小程序.云开发 ->新建
    2. 点击“微信卡发者工具” 的云开发按钮，进入到“云开发控制台”页面
        1. 点击开通 -> 环境名称：coderzhong，环境ID自动填充： coderzhong-xxxx ->点击确定即可
    3. 云开发控制台
        1. 云开发控制台包含
            1. 运营分析
            2. 数据库(云数据库)
            3. 存储(云存储)
            4. 云函数
        2. 云开发创建新环境
            1. 设置 – 环境名称 – 创建环境
            2. 在创建一个测试环境: coderzhong-dev
        3. 重要概念 – 环境和配额
            1. 环境:
                1. 一个环境对应一整套**独立的云开发资源**，包括数据库、存储空间、云函数等资源。
                2. 各个环境是相互独立的，用户开通云开发后即创建了一个环境，默认可拥有**最多两个**环境。
                3. 在实际开发中，**建议每一个正式环境都搭配一个测试环境**，所有功能先在测试环境测试完毕后再上到正式环境。 
            2. 配额:
                1. 默认有一定的免费配额(你懂的);
                2. 后期可以根据自己的业务量选择对应的更高配额;
                3. [https://developers.weixin.qq.com/miniprogram/dev/wxcloud/billing/quota.html](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/billing/quota.html)
        4. 清空项目默认文件
            1. Pages里面默认都是演示代码可以删除
6. 云开发初始化
    1. 在小程序端开始使用云能力前，需先调用 wx.cloud.init 方法完成云能力初始化
        1. 在app.js文件中
            
            ```
            onLaunch: function () {
                if (!wx.cloud) {
                  console.error('请使用 2.2.3 或以上的基础库以使用云能力')
                } else {
                  wx.cloud.init({
                    // env 参数说明：
                    //   env 参数决定接下来小程序发起的云开发调用（wx.cloud.xxx）会默认请求到哪个云环境的资源
                    //   此处请填入环境 ID, 环境 ID 可打开云控制台查看
                    //   如不填则使用默认环境（第一个创建的环境））
                    // env: 'my-env-id',
                    traceUser: true,
                  })
               }
            }
            ```
        2. cloud.init 有两个参数：
            1. env：后续 API 调用的默认环境配置，传入字符串形式的环 境 ID 可以指定所有服务的默认环境，传入对象可以 分别指定各个服务的默认环境，见下方详细定义
            2. traceUser： 是否在云开发控制台->运营分析->用户访问中记录        

## 云数据库介绍
1. 云开发三大核心之一的云数据库

### 数据库模块初始化
1. “微信卡发者工具” Pages目录下新建一个页面zhdatabase(右击新建目录),然后创建相应的文件(右击新建page)
2. 同理创建zhstorage（云存储）/zhcloudfunc（云函数）的目录以及page
3. 在app.json创建一个tabBar,然后分别用于展示：官方示例、云数据库、云存储、云函数
    
    ```
    "tabBar": {
        "list": [{
          "pagePath": "pages/index/index",
          "text": "官方示例"
        },
        {
          "pagePath": "pages/zhdatabase/zhdatabase",
          "text": "云数据库"
        },
        {
          "pagePath": "pages/zhstorage/zhstorage",
          "text": "云存储"
        }
        ,
        {
          "pagePath": "pages/zhcloudfunc/zhcloudfunc",
          "text": "云函数"
        }
        ]
      }
    ```

### 云数据库简介
1. JSON数据库:
    1. 云开发提供了一个**文档型**数据库，类似于MongoDB，里面存放的是一条条JSON格式的对象;并不是关系型数据库
    2. 一个数据库可以包含多个集合，一个集合中包含多个JSON对象;
        ![pic](https://raw.githubusercontent.com/zhoghua123/imgsBed/master/xcxpic17.png) 
2. 提供方便的API调用:学习这些API即可;
3. 提供了小程序端和服务器端(云函数)中调用的区分;
 
###  操作数据库

#### 控制台操作
1. 打开“云开发控制台”->数据库
2. 点击“集合名称”->设置为students，创建一个集合
3. 为students集合添加数据
    1. 点击“添加记录”
    2. 文档ID：不用填，使用默认，每个文档都需要有唯一的id
    3. 点击“文档ID”下面的“+”，添加字段、设置字段的类型、值
    4. 点击确定，就可以看到刚才添加的一条json数据
4. 云开发开控制台可以导入、导出数据
    1. 直接拿到json数据，保存到文件中
    2. 新建一个集合，然后点击导入该文件，就可以导入了
        1. 注意：json数据之前不能有分隔符，“，”也不行
        2. 比如:
            
            ```
            //数据1：这条数据用,隔开，不能导入
            {
                name: "a",
                height: 18
            },
            {
                name: "b",
                height: 19
            },
            {
                name: "c",
                height: 20
            }
            
            //数据2：这条数据能导入
            {
                name: "a",
                height: 18
            }
            {
                name: "b",
                height: 19
            }
            {
                name: "c",
                height: 20
            }
            ```

#### 代码操作
1. 在zhdatabase.wxml文件中分别添加几个按钮：增、删、改、查
    
    ```
    <button bind:tap="addDataToDB">添加数据</button>
    <button bind:tap="removeDataToDB">删除数据</button>
    <button bind:tap="updateDataToDB">修改数据</button>
    <button bind:tap="queryDataToDB">查询数据</button>
    ```
2. 事件响应在zhdatabase.js中
    
    ```
    
    ```

