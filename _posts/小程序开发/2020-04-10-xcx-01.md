---
layout: post
title: 第四章：豆瓣项目之首页
category: 小程序开发
tags: 小程序
description: 小程序开发
--- 

## 使用功能技巧

### 获取当前定位
1. 打开小程序官网文档：API->位置，可以查看使用示例：`wx.getLocation`
2. **注意：**使用定位需要在app.json添加permission字段
### 豆瓣API
1. 豆瓣官方的 API 已经不对外开放，但有第三方代理
    1. [https://douban.uieee.com](https://douban.uieee.com)
    2. [https://douban-api.uieee.com](https://douban-api.uieee.com)
2. 每个代理限流：10000 次 / 1 小时（豆瓣官方的限流），所有人共享这 10000 次
3. API 文档：[https://douban-api-docs.zce.me/](https://douban-api-docs.zce.me/)
4. 电影 API 文档：[https://douban-api-docs.zce.me/movie.html](https://douban-api-docs.zce.me/movie.html) 

### 百度地图逆地理编码使用
1. 创建百度地图应用、申请AK
    1. 首先要申请一个 AK ：[http://lbsyun.baidu.com/apiconsole/key/create](http://lbsyun.baidu.com/apiconsole/key/create)
        1. 点击“创建应用”
        2. 输入“应用名称”（随便写，比如：CoderZHTestProject）
        3. 应用类型选择“浏览器端”
        4. 启用服务一定要勾选“逆地理编码”
        5. Referer白名单：输入“*”，代表什么请求网址都可以
        6. 点击“提交”
    2. 根据这个应用拿到AK值
2. 逆地理编码 API
    1. 文档
        1. [API地址](http://lbsyun.baidu.com/index.php?title=webapi/guide/webservice -geocoding-abroad)
        2. 点击"服务文档"，可以看见使用方法：
            
            ```
            http://api.map.baidu.com/reverse_geocoding/v3/?ak=您的ak&output=json&coordtype=wgs84ll&location=31.225696563611,121.49884033194  //GET请求
            ```
    2. 即地址固定，只需要传入：AK与location经纬度即可

### 微信小程序的网络请求配置
1. 微信小程序中如果要请求一个新的地址，那么首先需要将这个地址域名在微信后台注册
2. 打开微信小程序官网->开发->开发设置->服务器域名->`request合法域名`
3. 然后在这里面把域名添加进去，比如：`https://api.map.baidu.com`，就可以网络请求了
4. **注意：**如果配置了仍然不能访问：
    1. 看是否是https
    2. “微信开发者工具”重新登录一次

### 微信小程序弹框提示封装
1. 打开小程序官网文档：API->界面->交互->wx.showToast
2. 封装系统的toast
3. 因为是全局使用所以放在app.js文件中
    
    ```
    //app.js
    App({
      // 小程序启动完毕调用
      onLaunch: function () {
        // 创建一个db对象
        wx.db={};
    
        // type = 0; 提示
        // type = 1, 成功
        // type = 2 失败
        let commonToast =(title,type,duration=1500)=>{
          let options ={
            title: title,
            icon: 'none',
            duration: duration,
            image: ''
          };
          if(type == 1){
            options.icon ='success';
          }else if(type == 2){
            options.image = '/assets/imgs/upsdk_cancel_normal.png'
          }
          wx.showToast(options);
        };
    
        wx.db.toast = (title,duration)=>{
          commonToast(title,0,duration);
        };
        // 2. 封装一个失败提示
        wx.db.toastError = (title,duration)=>{
          commonToast(title,1,duration);
        };
        // 3. 封装成功提示
        wx.db.toastSuccess = (title,duration)=>{
          commonToast(title,2,duration);
        };
        /*
        const tempDuration = 1500;
        // 1. 文本提示
        wx.db.toast = (title,duration=tempDuration)=>{
          wx.showToast({
            title: title,
            icon: 'none',
            duration: duration
          });
        };
        // 2. 封装一个失败提示
        wx.db.toastError = (title,duration=tempDuration)=>{
          wx.showToast({
            title: title,
            icon: 'none',
            image: '/assets/imgs/upsdk_cancel_normal.png',
            duration: duration
          });
        };
        // 3. 封装成功提示
        wx.db.toastSuccess = (title,duration=tempDuration)=>{
          wx.showToast({
            title: title,
            icon: 'success',
            duration: duration
          });
        };
        */
      },
      globalData: {
        userInfo: null
      }
    })
    ```

### 清除授权缓存
1. 场景：一旦授权，下次再如何才能再次弹框？ 
2. 解决办法：打开“微信开发者工具” 点击上面的清缓存按钮->清除授权数据
3. 再次刷新，就会重新弹出授权框

## 首页开发
1. 初始化home模块：
    1. 用“微信开发者工具”打开，在pages目录下右击“新建目录”创建home文件夹，然后右击新建Page命名为home
    2. 在app.json文件中，将pages下的home提到第一个，即启动显示home页面
2.  


