---
layout: post
title: 项目实战三-前后端分离驾考项目（二）
category: Java后端开发
tags: Java后端开发
description: Java后端开发
---  

## 前后端分离驾考项目

### 项目整合
1. 整合点梳理
    1. 控制器中的list方法
        
        ```
        public Map<String,Object> list(long page, long size,String keyword){};
        ```
    2. 需要接收参数，而且有可能有n个搜索参数，因此可以封装
    3. 前面讲过可以封装成一个query对象，不同的页面搜索使用不同的query类，而且每次查询的结果封装给这个query对象
        
        ```
        public Map<String,Object> list(DictTypeQuery query){};
        ```
2. 在pojo下新增一个query包，下面存放各个页面的query类
    
    ```
    //基类PageQuery
    @Data
    public class PageQuery {
        private static final int DEFAULT_SIZE = 10;
        private long page;
        private long size;
        //当前页的数据
        private List<?> data;
        //总数
        private long count;
        //总页数
        private long pages;
    
        public long getPage() {
            return Math.max(page,1);
        }
    
        public long getSize() {
            return (size < 1) ? DEFAULT_SIZE : size;
        }
    }
    //KeywordQuery
    @EqualsAndHashCode(callSuper = true)
    @Data
    public class KeywordQuery extends PageQuery {
        private String keyword;
    }
    //数据字典类型页面
    @EqualsAndHashCode(callSuper = true)
    @Data
    public class DictTypeQuery extends KeywordQuery {}
    //省份页面
    @EqualsAndHashCode(callSuper = true)
    @Data
    public class ProvinceQuery extends KeywordQuery{}
    ```
3. service层更新
    1. 数据字典类型页面
        
        ```
        //DictTypeService
        public interface DictTypeService extends IService<DictType> {
            void list(DictTypeQuery query);
        }
        //DictTypeServiceImpl
        @Service
        @Transactional
        public class DictTypeServiceImpl extends ServiceImpl<DictTypeMapper, DictType> implements DictTypeService {
            @Autowired
            private DictTypeMapper mapper;
            @Override
            public void list(DictTypeQuery query) {
                //配置搜索条件
                LambdaQueryWrapper<DictType> queryWrapper = new LambdaQueryWrapper<>();
                String keyword = query.getKeyword();
                if(!StringUtils.isEmpty(keyword)){
                    queryWrapper.like(DictType::getName,keyword).or()
                            .like(DictType::getValue,keyword).or()
                            .like(DictType::getIntro,keyword);
                }
                //根据id降序
                queryWrapper.orderByDesc(DictType::getId);
        
                MpPage<DictType> page = new MpPage<>(query);
                //查询
                mapper.selectPage(page,queryWrapper);
                //填充结果
                page.updateQuery(query);
            }
        }
        ```
    2. 省份页面
        
        ```
        public interface ProvinceService extends IService<Province> {
            void list(ProvinceQuery query);
        }
        
        @Service
        @Transactional
        public class ProvinceServiceImpl extends ServiceImpl<ProvinceMapper, Province> implements ProvinceService {
            @Autowired
            private ProvinceMapper mapper;
            @Override
            public void list(ProvinceQuery query) {
                String keyword = query.getKeyword();
                //配置搜索条件
                LambdaQueryWrapper<Province> queryWrapper = new LambdaQueryWrapper<>();
                if(!StringUtils.isEmpty(keyword)){
                    queryWrapper.like(Province::getName,keyword).or()
                            .like(Province::getPlate,keyword);
                }
                //根据id降序
                queryWrapper.orderByDesc(Province::getId);
                mapper.selectPage(new MpPage<>(query),queryWrapper).updateQuery(query);
            }
        }
        ```
4. MpPage是Page的增强类，用于抽取冗余代码
    
    ```
    //com.zh.jk.common.enhance
    public class MpPage<T> extends Page<T> {
        public MpPage(PageQuery query) {
            super(query.getPage(),query.getSize());
        }
        //如果不使用增强类，这段代码将会在每个service中重复写
        public void updateQuery(PageQuery query) {
            //填充结果
            query.setCount(getTotal());
            query.setPages(getPages());
            query.setData(getRecords());
            query.setPages(getCurrent());
            query.setSize(getSize());
        }
    }
    ```
5. controller
    1. DictTypeController、ProvinceController的list方法如下
    
    ```
    //DictTypeController
    @GetMapping
    public Map<String,Object> list(DictTypeQuery query) {
        service.list(query);
        Map<String,Object> map = new HashMap<>();
        map.put("code",0);
        map.put("msg","");
        map.put("count",query.getCount());
        map.put("data",query.getData());
        return map;
    }
    //ProvinceController
    @GetMapping
    public Map<String,Object> list(ProvinceQuery query) {
        service.list(query);
        Map<String,Object> map = new HashMap<>();
        map.put("code",0);
        map.put("msg","");
        map.put("count",query.getCount());
        map.put("data",query.getData());
        return map;
    }
    ```


