---
layout: post
title: JavaEE开发-第六节 个人简历管理系统项目开发(二)
category: Java后端开发
tags: Java后端开发
description: Java后端开发
--- 

## 面向接口编程
1. 当前的项目目录如下：
    
    ```
    bean
        BaseBean
        Education
        Website
    dao
        EducationDao
        WebsiteDao
    service
        EducationService
        WebsiteService
    servlet
        BaseServlet
        EducationServlet
        WebsiteServlet
    ```
2. 在dao、service文件夹下分别新建文件夹impl
3. 将所有的dao跟service的类名修改后面全部添加Impl,然后全部拖拽到相应的Impl文件夹中
    1. 比如BaseDao修改为WebsiteDaoImpl
4. 在dao跟service文件夹下新建每个类的**接口**，右击new-JavaClass（选择Interface）
    1. 比如在dao下新建BaseDao这个接口
    
    ```
    dao
        impl
            EducationDaoImpl
            WebsiteDaoImpl
        EducationDao
        WebsiteDao
    service
        impl
            EducationServiceImpl
            WebsiteServiceImpl
        EducationService
        WebsiteService
    ```
5. 将Impl类中的方法都抽取到对应的接口中
    1. EducationDao与EducationService一样
        
        ```
        public interface EducationDao {
            boolean remove(Integer id);
            boolean remove(List<Integer> ids);
            boolean save(Education education);
            Education get(Integer id);
            List<Education> list();
            int count();
        }
        ```
    2. WebsiteDao与WebsiteService一样
        
        ```
        public interface WebsiteDao {
            boolean remove(Integer id);
            boolean remove(List<Integer> ids);
            boolean save(Website education);
            Website get(Integer id);
            List<Website> list();
            int count();
        }
        ```
6. Impl类都添加接口实现
    
    ```
    public class EducationDaoImpl implements EducationDao {}
    public class WebsiteDaoImpl implements WebsiteDao {}
    public class EducationServiceImpl implements EducationService {}
    public class WebsiteServiceImpl implements WebsiteService {}
    ```
7. 目前的对象拥有连接是：Servlet拥有Service对象，Service对象拥有Dao对象，现在分别将Servlet与ServiceImpl对象中的拥有修改成接口引用
    
    ```
    Servlet拥有Service接口
    private EducationService service = new EducationServiceImpl();
    private WebsiteService service = new WebsiteServiceImpl();
    
    ServiceImpl对象拥有Dao接口
    private EducationDao dao = new EducationDaoImpl();
    private WebsiteDao dao = new WebsiteDaoImpl();
    ```
    
### 代码抽取 

#### dao抽取
1. 接口抽取
    1. 在dao下新建一个BaseDao，抽取代码如下
    
        ```
        package com.zh.xr.dao;
        import java.util.List;
        
        public interface BaseDao<T> {
            boolean remove(Integer id);
            boolean remove(List<Integer> ids);
            boolean save(T bean);
            T get(Integer id);
            List<T> list();
            int count();
        }
        ```
    2. EducationDao跟WebsiteDao如下：
    
        ```
        public interface EducationDao extends BaseDao<Education>{}
        public interface WebsiteDao extends BaseDao<Website> {}
        ```
2. Impl抽取
    1. 在dao文件夹下新建一个BaseDaoImpl,将Impl中的count、remove方法抽取出来
    2. BaseDaoImpl
        
        ```
        public abstract class BaseDaoImpl<T> implements BaseDao<T> {
            private String table = table();
            //要求子类实现，告知表名
            protected abstract String table();
        
            public boolean remove(Integer id) {
                String sql = "DELETE FROM" + table + " WHERE id = ? ";
                return Dbs.getTpl().update(sql,id) >0 ;
            }
        
            public boolean remove(List<Integer> ids) {
                List<Object> args = new ArrayList<>();
                StringBuilder sql = new StringBuilder();
                sql.append("DELETE FROM ").append(table).append(" WHERE id in (");
                for (Integer id: ids) {
                    args.add(id);
                    sql.append("?, ");
                }
                sql.replace(sql.length()-2,sql.length(),")");
        
                return Dbs.getTpl().update(sql.toString(),args.toArray()) >0 ;
            }
            public int count() {
                String sql = "SELECT COUNT(*) FROM " + table;
                return Dbs.getTpl().queryForObject(sql, new BeanPropertyRowMapper<>(Integer.class));
            }
        }
        ```
    3. EducationDaoImpl
        
        ```
        public class EducationDaoImpl extends BaseDaoImpl<Education> implements EducationDao {

            @Override
            protected String table() {
                return "education";
            }
            public boolean save(Education education) {
                Integer id = education.getId();
                List<Object> args = new ArrayList<>();
                args.add(education.getName());
                args.add(education.getType());
                args.add(education.getIntro());
                args.add(education.getBeginDay());
                args.add(education.getEndDay());
                String sql = "";
                if(id == null || id <1){
                    sql = "INSERT INTO education(name,type,intro,begin_day,end_day) VALUES(?, ?, ?, ?, ?)";
                }else {
                    sql = "UPDATE education SET name = ?, type = ?, intro = ?, begin_day = ?, end_day = ? WHERE id = ?";
                    args.add(id);
                }
                return Dbs.getTpl().update(sql,args.toArray()) >0 ;
            }
        
            public Education get(Integer id) {
                String sql = "SELECT id, created_time, name, type, intro, begin_day, end_day FROM education WHERE id = ?";
                return Dbs.getTpl().queryForObject(sql,new BeanPropertyRowMapper<>(Education.class),id);
            }
            public List<Education> list() {
                String sql = "SELECT id, created_time, name, type, intro, begin_day, end_day FROM education";
                return Dbs.getTpl().query(sql,new BeanPropertyRowMapper<>(Education.class));
            }
        }
        ```
    4. WebsiteDaoImpl
        
        ```
        public class WebsiteDaoImpl extends BaseDaoImpl<Website> implements WebsiteDao {
            @Override
            protected String table() {
                return "website";
            }
            public boolean save(Website website) {
                Integer id = website.getId();
                List<Object> args = new ArrayList<>();
                args.add(website.getFooter());
                String sql = "";
                if(id == null || id <1){
                    sql = "INSERT INTO website(footer) VALUES(?)";
                }else {
                    sql = "UPDATE website SET footer = ? WHERE id = ?";
                    args.add(id);
                }
                return Dbs.getTpl().update(sql,args.toArray()) >0 ;
            }
            public Website get(Integer id) {
                return null;
            }
     
            public List<Website> list() {
                String sql = "SELECT id, created_time, footer FROM website";
                return Dbs.getTpl().query(sql,new BeanPropertyRowMapper<>(Website.class));
            }
        }
        ```

#### service抽取
1. 接口抽取
    1. 同理抽取service，新建一个BaseService，然后抽取
    2. BaseService
        
        ```
        public interface BaseService<T>{
            boolean remove(Integer id);
            boolean remove(List<Integer> ids);
            boolean save(T bean);
            T get(Integer id);
            List<T> list();
            int count();
        }
        ```
    3. EducationService/WebsiteService
        
        ```
        public interface WebsiteService extends BaseService<Website> {}
        public interface EducationService extends BaseService<Education>{}
        ```
2. Impl抽取
    1. 新建BaseServiceImpl
        
        ```
        public abstract class BaseServiceImpl<T> implements BaseService<T> {
            private BaseDao<T> dao = dao();
            protected abstract  BaseDao<T> dao();
            public boolean remove(Integer id) {
                return dao.remove(id);
            }
            public boolean remove(List<Integer> ids) {
                return dao.remove(ids);
            }
            public boolean save(T bean) {
                return dao.save(bean) ;
            }
            public T get(Integer id) {
                return dao.get(id);
            }
            public List<T> list() {
                return dao.list();
            }
            public int count() {
                return dao.count();
            }
        }
        ```
    2. EducationServiceImpl、WebsiteServiceImpl
        
        ```
        public class WebsiteServiceImpl extends BaseServiceImpl<Website> implements WebsiteService {
            @Override
            protected BaseDao<Website> dao() {
                return new WebsiteDaoImpl();
            }
        }
        public class EducationServiceImpl extends BaseServiceImpl<Education> implements EducationService {
            @Override
            protected BaseDao<Education> dao() {
                return new EducationDaoImpl();
            }
        }
        ```




