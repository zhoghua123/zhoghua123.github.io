---
layout: post
title: Java常用企业框架-SpringMVC(二)
category: Java后端开发
tags: Java后端开发
description: Java后端开发
--- 

## 返回值
1. 返回给客户端的内容通常有以下
    1. 无返回值
    2. 文件：SpringMVC已经处理，不需要再处理
    3. 普通文本、HTML文本
    4. XML
    5. JSON

### 无返回值
1. 跟之前的Servlet一样，直接写回给客户端
    
    ```
    @Controller
    public class VoidController {
        @RequestMapping("/void")
        public void testVoid(HttpServletRequest request,
                             HttpServletResponse response) throws Exception {
            //直接写回给客户端
            response.setContentType("text/html; charset=UTF-8");
            response.getWriter().write("ZH666");
        }
    }
    ```

### 普通文本、HTML文本
1. 普通文本

    ```
    //produces:响应数据为普通文本，编码为UTF8
    @RequestMapping(value = "/get", produces = "text/plain; charset=UTF-8")
    @ResponseBody
    public String get() {
        return "This is xxx";
    }
    ```
2. html文本
    
    ```
    //produces:响应数据为html格式，编码为UTF8
    @RequestMapping(value = "/get", produces = "text/html; charset=UTF-8")
    @ResponseBody
    public String get() {
        return "<h1>This is xxx</h1>";
    }
    ```

### XML
1. 要求返回给客户端的数据为：
    
    ```
    <person name="Jack" age="20">
        <car name="BMW" price="123"/>
    </person>
    ```

#### 方法1：
1. 响应方法如下：
    ```
    @RequestMapping(value = "/xml1", produces = "application/xml; charset=UTF-8")
    @ResponseBody
    public String xml1() {
        Person person = new Person();
        person.setName("小xx");
        person.setAge(20);
    
        Car car = new Car();
        car.setName("Bently");
        car.setPrice(100);
        person.setCar(car);
    
        // 用第三方库将Model对象转为XML字符串（很多这样的库）
    
        return "<?xml version=\"1.0\" encoding=\"UTF-8\"?>"
                + "<person name=\"" + person.getName() + "\" age=\"" + person.getAge() + "\">"
                    + "<car name=\"" + car.getName() + "\" price=\"" + car.getPrice() + "\"/>"
                + "</person>";
    }
    ```
2. 部署项目，客户端访问：`http://localhost:8080/mvc02/xml1`

#### 方法2：
1. 响应方法改造如下：
    
    ```
    @RequestMapping(value = "/xml2")
    @ResponseBody
    public Person xml2() {
        Person person = new Person();
        person.setName("Jack");
        person.setAge(20);

        Car car = new Car();
        car.setName("Bently");
        car.setPrice(100);
        person.setCar(car);

        return person;
    }
    ```
2. pom.xml添加依赖
    
    ```
    <!-- Model转XML字符串 -->
    <dependency>
        <groupId>javax.xml.bind</groupId>
        <artifactId>jaxb-api</artifactId>
        <version>2.4.0-b180830.0359</version>
    </dependency>

    <dependency>
        <groupId>javax.xml</groupId>
        <artifactId>jaxb-impl</artifactId>
        <version>2.1</version>
    </dependency>
    ```
3. 在applicationContext.xml中必须设置
    
    ```
    <mvc:annotation-driven/>
    ```
4. 模型类设置
    
    ```
    //person
    //告诉上面那两个依赖，这个类要生成xml，根节点为person
    @XmlRootElement(name = "person")
    public class Person {
        private String name;
        private Integer age;
        private Car car;
    
        //为根节点下的另外一个标签元素
        //@XmlElement
        //为根节点的属性
        @XmlAttribute
        public String getName() {
            return name;
        }
    
        public void setName(String name) {
            this.name = name;
        }
    
        @XmlAttribute
        public Integer getAge() {
            return age;
        }
    
        public void setAge(Integer age) {
            this.age = age;
        }
    
        @XmlElement
        public Car getCar() {
            return car;
        }
    
        public void setCar(Car car) {
            this.car = car;
        }
    }
    
    //Car
    //如果不设置name，则默认是小写
    @XmlRootElement
    public class Car {
        private String name;
        private Integer price;
    
        @XmlAttribute
        public String getName() {
            return name;
        }
    
        public void setName(String name) {
            this.name = name;
        }
    
        @XmlAttribute
        public Integer getPrice() {
            return price;
        }
    
        public void setPrice(Integer price) {
            this.price = price;
        }
    }
    ```
5. 部署项目，客户端访问：`http://localhost:8080/mvc02/xml2`

### JSON

#### 方法一：
1. 响应方法如下：
    
    ```
    @RequestMapping(value = "/json1", produces = "application/json; charset=UTF-8")
    @ResponseBody
    public String json1() {

        // 用第三方库将Model对象转为XML字符串（很多这样的库）
        return "{\"name\":\"华仔\",\"age\":20,\"car\":{\"name\":\"Bently\",\"price\":100}}";
    }
    ```
2. 部署项目，客户端访问：`http://localhost:8080/mvc02/json1`

#### 方法二：
1. pom.xml添加依赖
    
    ```
    <!-- Model转JSON字符串 -->
    <dependency>
        <groupId>com.fasterxml.jackson.core</groupId>
        <artifactId>jackson-databind</artifactId>
        <version>2.11.0</version>
    </dependency>
    ```
2. 响应方法如下：
    
    ```
    //如果添加了依赖，而且返回值为Model对象，那么会自动转为json返回
    @RequestMapping(value = "/json2")
    @ResponseBody
    public Student json2() {
        Student student = new Student();
        student.setName("Jack");
        student.setAge(20);
        student.setNickNames(List.of("123", "456", "789"));

        Dog dog = new Dog();
        dog.setName("Bently");
        dog.setPrice(100);
        student.setDog(dog);

        return student;
    }
    ```
3. 在applicationContext.xml中必须设置`<mvc:annotation-driven/>`
4. 部署项目，客户端访问：`http://localhost:8080/mvc02/json2`
5. **注意：**如果添加了依赖jackson-databind，一个controller的响应方法直接返回Model对象，那么SpringMVC，会默认将这个Model对象转化为json串

### 全局设置相应数据的编码
1. 从上面的示例可以看出，Controller的**每个**响应方法都需要通过一下方式设置响应数据的编码
    
    ```
    produces = "application/json; charset=UTF-8")
    ```
2. 也可以全局设置响应数据的编码,在applicationContext.xml中如下设置
    
    ```
    <mvc:annotation-driven>
        <mvc:message-converters>
            <!-- 影响返回值是String的内容,设置编码 -->
            <bean class="org.springframework.http.converter.StringHttpMessageConverter">
                <property name="defaultCharset" value="UTF-8"/>
            </bean>

            <!-- 影响返回值是Model对象（最后通过Jackson转成JSON字符串）,设置编码 -->
            <bean class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter">
                <property name="defaultCharset" value="UTF-8"/>
            </bean>

            <!-- 影响返回值是Model对象（最后通过JAXB转成XML字符串）,设置编码 -->
            <bean class="org.springframework.http.converter.xml.Jaxb2RootElementHttpMessageConverter">
                <property name="defaultCharset" value="UTF-8"/>
            </bean>

        </mvc:message-converters>
    </mvc:annotation-driven>
    ```
3. 这样一来，针对全部所有的Controller，响应结果为字符串、html、xml、json的数据都设置了统一的编码格式
4. 就不需要通过produces属性来设置了
    
    

