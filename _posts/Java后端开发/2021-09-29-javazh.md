---
layout: post
title: Java进阶-Redis
category: Java后端开发
tags: Java后端开发
description: Java后端开发
---  

### redis简介
1. 数据库分类
    1. 关系型数据库：
        1. Oracle,MySQL,SqlServer,DB2
        2. 特点：有一套标准的一套标准的SQL语句，有事务功能
    2. 非关系型数据库（Nosql数据库）
        1. 以下几种
            1. key-value存储数据库
                1. 这一类数据库主要会使用到一个哈希表，这个表中有一个特定的键和一个指针指向特定的数据。
                2. Key/value模型对于IT系统来说的优势在于简单、易部署。但是如果DBA只对部分值进行查询或更新的时候，Key/value就显得效率低下了。
                3. 举例如：Tokyo Cabinet/Tyrant， Redis， Voldemort， Oracle BDB。
            2. 列存储数据库
                1. 这部分数据库通常是用来应对分布式存储的海量数据。键仍然存在，但是它们的特点是指向了多个列。这些列是由列家族来安排的。如：Cassandra， HBase， Ria
            3. 文档性数据库
                1. 文档型数据库的灵感是来自于Lotus Notes办公软件的，而且它同第一种键值存储相类似。
                2. 该类型的数据模型是版本化的文档，半结构化的文档以特定的格式存储，比如JSON。
                3. 文档型数据库可以看作是键值数据库的升级版，允许之间嵌套键值。而且文档型数据库比键值数据库的查询效率更高。如：CouchDB， MongoDb. 国内也有文档型数据库SequoiaDB，已经开源。
            4. 图形数据库
                1. 图形结构的数据库通其他行列以及刚性结构的SQL数据库不同.它是使用灵活的图形模型.并且能拓展到多个服务器上
                2. 常见的数据库有: Neo4J
        2. 非关系型数据库特点
            1. 数据模型比较简单(主要)
            2. 需要灵活性更强的应用系统
            3. 对数据库性能要求较高(主要)
            4. 不需要高度的数据一致性
            5. 对于给定key,比较容易映射复杂值的环境.
2. redis简介
    1. Redis **是**一个简单的，高效的，分布式的，基于**内存**缓存**工具**，架设好服务器后，通过网络链接（类似数据库），提供Key-Value 式缓存服务。
        1. redis就是一个软件，通过这个软件可以进行数据存储，跟mysql一样
    2. 优势：
        1. 速度快
            1. 数据存储在内存中，读写速度快，读数据: 11w/s、写数据: 8w/s
        2. 提供丰富的数据类型
            1. mysql中的数据类型是固定的，查询出来数据需要进行转换，而且不支持集合类型
            2. redis可以直接传这些数据类型,String、List、Set、Zset、Hash 
        3. 原子性操作
            1. Redis 所有操作都是原子性，意思就是要么执行成功、要么执行失败、完全不执行。
            2. 单个操作是原子性的。多个操作也支持事务，即原子性，通过 MULTI和 EXEC 指令包起来
        4. 丰富的特征
            1. Redis 还支持 publish/subscribe, 通知，key过期等特征
        5. 持久化机制
        6. 高可用分布式
    2. 学习redis
        1. redis在线入门 ： http://try.redis.io/
        2. redis 中文资料站： http://www.redis.cn/
        3. github: https://github.com/antirez/redis
        4. 官网: https://redis.io/
        5. redis命令参考: http://redisdoc.com/
3. redis安装
    1. gcc安装：`yum -y install gcc automake autoconf libtool make`
        1. 如果是mac系统，不用执行
    2. redis安装
        1. 下载 `wget http://download.redis.io/releases/redis-6.2.5.tar.gz`
        2. 解压 `tar -zxvf redis-6.2.5.tar.gz -C /usr/local`
            1. 是C源码，需要编译
            2. 解压到`/usr/local`目录下
        3. 编译：`make`
            1. `cd /usr/local/redis-6.2.5`下，执行make编译成可执行文件
        4. 安装：`make PREFIX=/usr/local/redis-6.2.5 install`
            1. 安装到指定目录下
    3. 启动
        1. 进入安装目录： `cd /usr/local/redis-6.2.5/bin`
        2. 启动服务:
            1. 方式1: 直接使用`redis-server`
            2. 方式2: 使用动态参数`redis-server --port=6380`
            3. 方式3: 使用配置文件启动(**推荐**)
        3. 客户端访问连接redis：`./redis-cli`
            1. `redis-cli -h IP地址 -p 端口` ：指定哪台主机的端口应用
            2. 退出客户端 ctrl + C
    4. 如何使用配置文件启动
        1. 进入到redis安装目录下`cd /usr/local/redis-6.2.5`,该目录下有一个默认的配置文件redis.conf
        2. 新建一个conf文件夹`mkdir conf`
        3. 将当前目录的redis.conf文件copy到conf文件夹下`cp redis.conf conf/redis_6379.conf`
            1. 因为分布式部署可能有n个redis启动，因此这个配置文件名需要唯一
        4. `cd /usr/local/redis-6.2.5` 执行`bin/redis-server conf/redis_6379.conf`,启动redis
    6. 配置启动配置文件
        1. 上面的启动是前台启动,可以通过配置文件配置后台启动等其他功能，打开redis_6379.conf
        2. 常见设置如下
            
            ```
            //配置后台启动
            daemonize  yes 
            //配置远程登录,就是配置访问的IP地址,可以通过 netstat -ntlp 查看绑定的网卡信息
            bind 0.0.0.0
            //端口配置
            port 6379
            //工作目录,缓存中的数据如果需要持久化，持久化的目录,注意：这里要创建一个data文件夹!!!, mkdir data
            dir /usr/local/redis-6.2.5/data
            //日志文件:redis运行的日志文件存放目录,放到上面的工作目录下
            logfile "redis_6379.log"
            //密码配置,默认是注释了，打开配置
            requirepass $HaoBa@123.com
            ```
        3. 上面配置修改完之后，执行启动命令`bin/redis-server conf/redis_6379.conf`,会发现没有反应，需要到`/usr/local/redis-6.2.5/data/redis_6379.log`日志文件下产看，redis启动的状态
    7. redis的关闭
        1. 方式一：执行`/usr/local/redis-6.2.5/bin/redis-cli.sh shutdown` 停止服务
        2. 方式二：`kill -9 PID`,PID为应用进程的id
        3. 注意：如果设置了密码，关闭时需要输入密码：`redis-cli.sh '$HaoBa@123.com' shutdown`
    8. 总结
        1. redis就是一个软件，需要安装，下载的包是一个C语言源码包`redis-6.2.5.tar.gz`，需要自己编译后，再进行安装
        2. 跟mysql一样，但是mysql不需要进行解压，直接安装
        3. `/usr/local/redis-6.2.5/bin`下可执行文件说明
        
            ```
            redis-server 启动redis服务命令
            redis-cli  redis的客户端连接命令
            redis-check-aof 检查aof命令
            redis-check-rdb 检查rdb备份命令
            redis-benchmark redis 性能测试命令
            redis-sentinel  redis的哨兵机制启动命令
            ```
    9. **MAC系统注意事项：**
        1.安装到`/usr/local`下可能没有权限，上面的命令需要加sudo
        2. 通过`sudo chmod 777 /usr/local/redis-6.2.5/`,给该目录下开放所有权限，否则无法操作redis数据

### Redis的数据类型
1. 通用命令
    1. 启动redis，然后使用`/usr/local/redis-6.2.5/bin/redis-cli`,连接redis，然后就可以使用命令了
    
    ```
    keys *  查看所有的key，会扫描所有的数据, 阻塞其他操作, 不建议使用
    dbsize 查看key的数量,性能很快, 时间复杂度0(1)
    exists key 判断是否存在对应的key，如果存在 返回1 ，如果不存在, 返回 0 
    expire key seconds  给对应的key设置过期时间, 单位是秒
    ttl key   获取key的剩余有效时间，-1 代表永久有效 -2 代表无效的键
    persist key  把一个有过期时间的key变为一个永久的key
    del key 根据指定key删除记录, 可以一次删除多个可以
    type key 用来获取key对应的数据的类型
    flushdb  慎用 清空数据库记录
    flushall 清空所有的数据库记录
    info  查看服务器信息
    ```




2. 什么是redis
    1. 高可用
        1. 我们在做主从分离的时候,是一台主服务器,多台从服务器.如果主服务器挂了意味我们无法给引用提供服务了.高可用就是我们会有多台主服务器,如果一台主服务器挂了,它下面的从服务器会自动挂载到新的主服务器中.
        2. 三种形式:
            1. 主从形式:只有一台机器是主节点,有多台机器是从节点.如果主节点挂了,应用就挂.
            2. 哨兵形式(Redis2.x版本):在主从模式下,会有一台机器充当哨兵的角色.它去监控其他机器的状态.当主节点挂了会在从节点之间进行选举,看那台机器性能比较好,比较高，然后把指定的一台从节点升级为主节点，实现高可用；下次主节点修复好了,会自动加入进来变成从节点.
            3. 集群模式(Redis3.0之后):可以拥有多主多从,如果其中一台主节点挂了,会选举下面的从节点为主节点,可以做哨兵的这个事情
    2. 数据可靠性
        1. redis存储在内存中，一旦机器断点、重启数据就没了，如何保证数据的可靠性？
        2. 整体思路：将redis数据进行持久化，在服务器断电之后重新启动,数据还能恢复Redis
        3. 主要两种持久化的方式:
            1. RDB:可以周期性的同步内存中的数据到所在的机器的硬盘上.
            2. AOF:会把里面的DML操作写到一个日志里,实时记录.断电之后可以从日志里面知道你之前做了什么操作了.


