---
layout: post
title: Java常用企业框架-Spring(二)
category: Java后端开发
tags: Java后端开发
description: Java后端开发
--- 

## Converter
1. Spring已经内置了基本的类型转换功能，比如
    1. String转int、String转Date（支持yyyy/MM/dd格式）
    
    ```
    <bean id="service" class="com.zh.service.PersonServiceImpl">
        <!--字符串自动转化为int-->
        <property name="age" value="25"/>
        <!--"2011/09/10"自动转化为Date-->
        <property name="birthday" value="2011/09/10"/>
    </bean>
    ```
2. Spring默认的日期转化仅仅支持yyyy/MM/dd格式，那么如果我们要自己定义转化格式，该怎么办呢？

### 自定义Converter
1. 自定义Converter类，实现Converter接口
    
    ```
    //继承Converter接口，String->Date
    public class DateConverter implements Converter<String, Date> {
        private List<String> formats;
    
        public void setFormats(List<String> formats) {
            this.formats = formats;
        }
    
        @Override
        public Date convert(String s) {
            //根据传过来的所有格式进行遍历
            for (String format : formats) {
                try {
                    SimpleDateFormat fmt = new SimpleDateFormat(format);
                    return fmt.parse(s);
                } catch (ParseException e) {
                    // e.printStackTrace();
                }
            }
            return null;
        }
    }
    ```
2. applicationContext.xml中注册
    
    ```
    <!--自动转化，但是注意必须是yyyy/MM/dd格式-->
<!--    <bean id="person" class="com.zh.domain.Person" p:birthday="2011/09/10"/>-->

    <!--其他格式的转化，自定义转换器-->
    <bean id="person" class="com.zh.domain.Person" p:birthday="09_10_2111"/>

    <!-- 配置FactoryBean
    1. 创建Spring内置对象conversionService
    2. 给内置对象设置属性converters--所有自定义的转换器
    3. 将自定义转换器设置的所有格式进行设置
    -->
    <bean id="conversionService" class="org.springframework.context.support.ConversionServiceFactoryBean">
        <!-- 跟上面对象设置属性-->
        <property name="converters">
            <set>
                <!-- 设置自定义转化器-->
                <bean class="com.zh.converter.DateConverter">
                    <property name="formats">
                        <list>
                            <!-- 同时兼容各种格式-->
                            <value>yyyy-MM-dd</value>
                            <value>MM_dd_yyyy</value>
                        </list>
                    </property>
                </bean>
            </set>
        </property>
    </bean>
    ```
3. 测试
    
    ```
    @Test
    public void test() {
        ApplicationContext ctx = new ClassPathXmlApplicationContext("applicationContext.xml");
        Person person = ctx.getBean("person1", Person.class);
        System.out.println(person);
    }
    ```

