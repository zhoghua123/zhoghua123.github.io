---
layout: post
title: JavaEE开发-第五节 Maven
category: Java后端开发
tags: Java后端开发
description: Java后端开发
--- 

### 构建生命周期(Build Lifecycle)
1. 构建生命周期，描述了构建的过程。Maven内置了3个构建生命周期
    1. clean (清理)
    2. default (**默认，重点关注**)
    3. site (站点)
2. 构建生命周期由phase(阶段)组成
    1. phase可以跟plugin goal(插件目标)绑定
    2. plugin goal代表1个特定的任务
    3. 一旦某个phase被执行,就会执行其绑定的所有goal
    4. 比如双击packge时就会执行pom.xml中配置的打包插件`spring-boot-maven-plugin`
3. 通过命令`mvn 插件名称:help`可以查看插件包含的所有goal
    1. 比如`mvn archetype:help`:查看archetype插件下有哪些任务（goal）
    
    ![图1](https://gitee.com/zhonghua123/blogimgs/raw/master/img/javazh-24.png)

#### default生命周期
1. default生命周期由下表中的几个phase组成
    
    ```
    phase               描述
    
    validate            确认项目正确并且所有必要的信息均可用
    compile             编译项目的源代码（src/main）
    test                使用合适的单元测试框架测试编译后的源代码(src/test)
    package             获取编译后的代码，并将其打包为可分发的格式，例如jar
    verify              对集成测试的结果进行任何检查，以确保符合质量标准
    install             将软件包安装到本地存储库中，以作为本地其他项目中的依赖项
    deploy              在构建环境中完成后，将最终软件包复制到远程存储库中，以便与其他开发人员和项目共享
    ```
2. 使用命令mvn package就会默认按顺序执行validate、compile、test、package阶段
3. **注意:**install是将packge打包好的jar包安装到本地仓库,比如之前打包的hellojava.jar包中


#### 举例：

```
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-dependency-plugin</artifactId>
    <version>3.1.2</version>
    <!-- 插件执行任务 -->
    <executions>
        <!-- 每个执行 -->
        <execution>
            <!-- 在生命周期的哪个阶段执行,这个是在package阶段（phase）执行-->
            <phase>package</phase> 
            <!--一个插件中有n个goal（目标）需要指定执行哪一个目标 -->
            <goals>
                <!--指向拷贝依赖操作 -->
                <goal>copy-dependencies</goal>
            </goals>
            <configuration>
                <!--
                将依赖的jar包拷贝到target文件夹下的lib文件夹中
                ${project.build.directory}：就是指的是target文件夹路径
                最终提供给别人的是hellojava.jar和lib2个文件
                 -->
                <outputDirectory>${project.build.directory}/lib</outputDirectory>
            </configuration>
        </execution>
    </executions>
</plugin>
```

### dependency中scope的取值
1. compile: 默认值。编译依赖关系在**所有类路径中均可用**。此外，这些依赖项会传递到相关项目
2. provide: **仅在编译和测试类路径上可用**，并且不可传递。希望JDK或容器在运行时提供它
3. runtime: 依赖关系不是编译所必需的，而是运行所必需的。它在**运行时和测试类路径中**，但不在编译类路径中
4. test: 依赖关系对于正常使用该应用程序不是必需的，并且仅在**测试编译和执行阶段可用**。它不是可传递的
5. system:：必须显式提供jar的位置（可以通过systempath标签指定），不会去Maven仓库中查找

#### 举例

```
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid</artifactId>
    <version>1.2.3</version>
    <!-- scope的取值-->
    <scope>test</scope>
</dependency>
```


### Maven常见问题
1. 解决文件编码的警告：
    1. 双击packge时，会报错：`Using platform encoding(UTF-8 actually)...`
    2. 解决办法：在pom.xml中添加
    
        ```
        <project.build.sourceEncoding>UTF8</project.build.sourceEncoding>
        ``` 
2. 解决IDEA控制台输出乱码：
    1. Settings -> Build, Execution, Deployment -> Build Tools -> Maven -> Runner
    2. 在VM Options中添加`-Dfile.encoding=GBK`


