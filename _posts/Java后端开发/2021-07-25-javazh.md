---
layout: post
title: SpringBoot（二）
category: Java后端开发
tags: Java后端开发
description: Java后端开发
--- 

## 页面模板
1. SpringBoot中常用的页面模板有
    1. JSP
    2. Freemarker
    3. Thymeleaf(推荐)

### JSP
1. 新建子项03_jsp
2. 在pom.xml中添加依赖如下：
    
    ```
    <dependencies>
        <dependency>
            <groupId>org.apache.tomcat.embed</groupId>
            <artifactId>tomcat-embed-jasper</artifactId>
        </dependency>
    </dependencies>
    ```
3. 配置视图的前缀、后缀、热部署
    1. 在resources下添加一个application.yml
        
        ```
        #配置前后最
        spring:
          mvc:
            view:
              # jsp放在了webapp根路径下
              prefix: /
              suffix: .jsp
        #jsp的热部署
        server:
          servlet:
            jsp:
              init-parameters:
                - developement: true
        ```
    2. 添加webapp路劲
        1. 点击右上角Project Structure
        2. 找到03_jsp->web->右边Web Resources Directories->点击下面的+，Web Resources Directory path路径后面添加`/src/main/webapp`,点击OK
        3. 在webapp下添加一个test.jsp
4. 设置工作目录（Working directory)
    1. 点击Eidt Configurations ->Spring Boot->Application(当前项目的启动入口类)->Working directory设置->点击右边的+加号->选择Macros下的ModuleFileDir->点击insert->点击OK
    2. 控制器做如下改造
        
        ```
        //注意不能使用RestController
        @Controller
        public class TestController {
        
            @GetMapping("/index")
            public String index() {
                //会自动拼接前后缀， /test.jsp
                return "test";
            }
        }
        ```
    3. 运行项目，在浏览器输入`http://localhost:8080/index`
    4. 如果是使用Sring-boot-maven-plugin运行，可以不用设置这一项
        1. 在父项目22_spparent的pom.xml中添加
            
            ```
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <version>2.3.4.RELEASE</version>
            </dependency>
            ```
            
### Thymeleaf
1. Thymeleaf是在SpringBoot中推荐使用的页面模板引擎
    1. 可以完全取代JSP
    2. 可以在没有服务器的环境下展示静态页面
2. 官网[https://www.thymeleaf.org](https://www.thymeleaf.org)
3. 简单使用
    1. 新建子项目04_thymeleaf
    2. pom.xml添加依赖
        
        ```
        <dependencies>
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-thymeleaf</artifactId>
            </dependency>
        </dependencies>
        ```
    3. 一些默认配置：只要引入上面的库，相当于做了下面的配置
        
        ```
        spring:
          thymeleaf:
            #返回的数据编码
            encoding: UTF-8
            # 默认前后缀
            prefix: classpath:/templates/
            suffix: .html
            #开启thymeleaf模板功能
            enabled: true
            #返回的数据格式
            servlet:
              content-type: text/html
        ```
    4. resources下面新建一个templates文件夹
        1. 下面新建一个index.html
        2. 浏览器输入`http://localhost:8080/templates/index.html`但是无法打开
        3. templates中的资源必须通过转发才能访问
        4. 在控制器中做一个转发
            
            ```
            //注意不能使用RestController
            @Controller
            public class TestController {
                @GetMapping("/testIndex")
                public String testIndex() {
                    // prefix: classpath:/templates/
                    // suffix: .html
                    //转发到的最终路径
                    // classpath:/templates/index.html
                    return "index";
                }
            }

            ```
        5. 浏览器输入`http://localhost:8080/testIndex`，这可以正常访问index.html
4. 页面传值
    1. 控制器中转发如下
        
        ```
        //方法1：
        @GetMapping("/testIndex")
        public String testIndex(Model model) {
    
            model.addAttribute("name", "ZH");
            model.addAttribute("age", 22);
            //向index.html传值
            return "index";
        }
        //方法二：
        @GetMapping("/testIndex")
        public String testIndex(HttpServletRequest request) {
            //向index.html传值
            request.setAttribute("name", "ZH");
            request.setAttribute("age", 20);
            return "index";
        }
        ```
        
        1. Model参数并非SringBoot特有
        2. 可以单独在SringMVC中使用
    2. index.html如下：
        
        ```
        <!DOCTYPE html>
        <!--需要导入这个命名空间-->
        <html lang="en" xmlns:th="http://www.thymeleaf.org">
        <head>
            <meta charset="UTF-8">
            <title>Title</title>
        </head>
        <body>
        
        This is index.html
        <div th:text="${name}"></div>
        <div th:text="${age}"></div>
        </body>
        </html>
        ```

#### 说明
1. classpath:/templates/目录下的内容，默认只能通过转发访问
2. 可以通过spring.resources.static-locations设置静态资源目录，可以直接通过URL访问
    1. 在application.yml文件中输入static-locations,然后点击进入查看源码，如下：
        
        ```
        private static final String[] CLASSPATH_RESOURCE_LOCATIONS = { "classpath:/META-INF/resources/","classpath:/resources/", "classpath:/static/", "classpath:/public/" };
        
        	/**
        	 * Locations of static resources. Defaults to classpath:[/META-INF/resources/,
        	 * /resources/, /static/, /public/].
        	 */
        	private String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;

        ```
    2. 可以看到默认值是CLASSPATH_RESOURCE_LOCATIONS，也就是这些路径`"classpath:/META-INF/resources/","classpath:/resources/", "classpath:/static/", "classpath:/public/" `,凡是这些路径下的资源都可以直接访问
    3. 因此在resources下新建一个static文件夹，在内部再创建一个test.html，然后运行项目
    4. 浏览器输入：`http://localhost:8080/test.html`则可以直接访问
    5. 当然也可以直接在application.yml中修改上面的默认路径，设置一个新的路径，只要将html文件放在这个新路径下，就可以直接访问
        
        ```
        spring:
          resources:
            static-locations: "设置新的路径"
        ```
3. 属性名都是以th:开头
    1. th:text设置的文本不会进行解析渲染
    2. th:utext设置的文本会进行解析渲染
        1. 就是如果controller给html转发的数据是标签，会直接解析渲染
    3. 其他属性跟原来标签的属性相比，就是添加了一个`th:`，比如之前的属性是src，现在的属性就是`th:src`
4. 常用表达式
    1. 变量表达式(Variable) : ${...}
        1. 传递到html中的变量取值方式，上面已讲
    2. 选中变量表达式(Selection Variable) : *{...}
    3. 消息表达式(Message) : #{...}
    4. 链接表达式(Link URL) : @{...}
    5. 片段表达式(Fragment) : ~{...}


#### 注释
1. HTML注释
    
    ```
    <!--HTML注释-->
    ```
2. 解析器级别的注释（parser-level)
    1. `<!--/*-->`和`<!--/*-->`之间的任何内容
    2. 只有经过thymeleaf解析器处理后，才会变成真正的注释
    
    ```
    //通过thymeleaf解析这个时，会当做注释
    <!--/*-->
        <div>我是div2</div>
    <!--*/-->
    ```
3. 原形注释（prototype-only)
    1. 作为静态页面打开时，它是注释
    2. 经过thymeleaf解析器处理后，它是正常标签，不是注释
    3. 跟上面相反
    
    ```
    //直接在浏览器打开会当做注释，thymeleaf不会认为是注释
    <!--/*/
    <div>我是div3</div>
    /*/-->
    ```

#### 字面量

```
<!--name=Larry,age=10-->
<!--Ilovecoding.-->
<div th:text="Ilovecoding."></div>
<!--变量与常量拼接-->
<!--Larry love coding.22-->
<div th:text="${name} + ' love coding.' + ${age}"></div>
<!--Larry love coding.-->
<div th:text="${name} + | love coding.|"></div>
<!--不能拼接-->
<!--${name} love coding.-->
<div th:text="'${name} love coding.'"></div>
<!--可以拼接-->
<!--Larry love coding.-->
<div th:text="|${name} love coding.|"></div>


<!--数字-->
<!--age=20-->
<!--0-->
<div th:text="${age} % 2"></div>
<!--2020-->
<div th:text="2020"></div>
<!--4040-->
<div th:text="2020 * 2"></div>

<!-布尔-->
<!--true-->
<div th:text="${age} % 2 == 0"></div>
<!--false-->
<div th:text="${age} <= 10"></div>
<hr>
```

#### 局部变量、三目运算

```
<div th:text="${name} ? '存在name' : '不存在name'"></div>

<div th:with="id=10, salary=200, nickName='JJ'">
    <div th:text="'id = ' + ${id}"></div>
    <div th:text="'salary = ' + ${salary}"></div>
    <div th:text="'nickName = ' + ${nickName}"></div>
</div>
<div th:class="${age % 2 == 0} ? 'blue' : 'red'">
    div666
</div>
<div th:text="${age} ? ${age} : 'No Age'">
</div>
<!--等价于上面-->
<div th:text="${age} ?: 'No Age'">
</div>
<!--等价于${age == null} ? 'No Age':null-->
<div th:text="${age == null} ? 'No Age'">
</div>
```

#### 选中变量表达式


