---
layout: post
title: JavaEE开发-第一节 简介
category: Java后端开发
tags: Java后端开发
description: Java后端开发
---   

## 简介
1. JavaEE开发
    1. 在Java的三大版本JavaSE、JavaME、JavaEE中，JavaEE是专门用来做后台开发的
    2. 所以，平时所说的“Java后台开发“，一般叫做JavaEE开发
    3. JavaEE开发的工作内容
        1. 编写服务器上运行的程序，为客户端提供数据服务
        2. 很多大型网站、企业管理系统的后台，都是用JavaEE开发的
2. 服务器
    1. 用户量、数据访问量越大，对服务器的性能要求越高
    2. 一般中大型企业都有自己独立的服务器机房，摆放着成群的服务器
    3. 服务器的一些维护成本：电费、场地、维修等
    4. 小型企业可以考虑租用云服务器（比如阿里云、腾讯云服务器）
    5. 宕(dang)机
        1. 服务器死机、挂了
        2. 停止对外服务
        3. 客户端无正确响应
        4. 严重影响用户体验

## Servlet
1. Servlet是Server Applet的简称，译为“小型的服务程序”，**用于响应客户端的请求**
2. 一般的使用要素
    1. 继承java.servlet.http.HttpServlet,实现doGet、doPost或者service方法
    2. 通过request对象获取客户端的请求数据：`request.getParameter()`
    3. 通过response对象给客户端返回响应: `response.getWriter().write()`
    4. 通过注解@WebServlet设置Servlet对应的请求路径
3. 乱码问题解决
    1. 客户端的请求数据乱码
        
        ```
        //按照UTF8编码解析客户达发送过来的数据
        request.setCharacterEncoding("UTF-8");
        ```
    2. 服务器的响应数据乱码
        
        ```
        //设置响应数据的编码
        response.setContentType("text/plain;charset=UTF-8");
        ```
        
        1. 其中`text/plain`是数据的MINEType,根据实际情况而定
        2. 更多的MINEType可以参考Tomcat安装目录下的conf文件夹下/web.xml文件中可以查看
4. 一些细节
    1. 通过response拿到的输出流对象（比如getWriter），不需要程序员调用close去关闭
        1. 在语法基础IO流中讲过，流一般创建了，需要用close销毁，这里是获取，不是创建所以不用销毁
    2. 默认情况下，一个Servlet类，只会被服务器创建一个实例对象，而且是在第一次处理客户端请求才创建实例
        1. 注意：**Servlet并没有设计成单例模式！！！**
    3. 建议：不要在Servlet中定义可写（writable）的成员变量，会引发线程安全问题
    4. HTTP请求的默认端口号是80,，所以，如果Tomcat服务器的端口号设置为80，那么
        1. localhost/path等价于localhost:80/path（**仅仅是HTTP请求**才会自动加上80）
        2. 也就是说如果Tomcat服务器的端口号设置的不是80，那么HTTP请求的时候就必须是`域名(IP地址):+端口号`进行访问
        3. **注意**:这里的80不等于8080
        4. **HTTPS请求**的默认添加端口号是443
5. 代码举例：
    
    ```
    //TestServlet类
    package com.example.HelloWorld;
    import javax.servlet.ServletException;
    import javax.servlet.annotation.WebServlet;
    import javax.servlet.http.HttpServlet;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;
    import java.io.IOException;
    
    //设置请求路径
    @WebServlet("/login")
    //设置多个请求路径
    //@WebServlet({"/login","/test"})
    public class TestServlet extends HttpServlet {
        //可以从构造方法中看出，n个请求发送过来，TestServlet对象仅仅被创建一次
        public TestServlet(){
            //java中打印一个对象时，输出：类名@哈希值，每个对象都有唯一的哈希值，如果2个对象打印的值一样，说明2个对象是同一个对象
            System.out.println(this + "server");
        }
        /**
         * 客户端发送一个http请求，首先会调用这个service方法
         * */
        @Override
        protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
            //父类的service方法内部已经做好了分发，会判断当前客户端的请求是get还是post，然后分别调用doGet、doPost
            super.service(req, resp);
            System.out.println("------service-----------");
            //java中打印一个对象时，输出：类名@哈希值，每个对象都有唯一的哈希值，如果2个对象打印的值一样，说明2个对象是同一个对象
            System.out.println(this + "server");
        }
    
        //处理get请求
        @Override
        protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
            System.out.println("------doget-----------");
            //统一函数处理
            doPost(req,resp);
        }
        //处理post请求
        /**
         * HttpServletRequest req: 请求，用来获取客户端发送的数据
         * HttpServletResponse resp：响应，用来给客户端返回数据
         * */
        @Override
        protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
            System.out.println("-------dopost---------");
            //获取客户端发送的数据（请求参数）
            //按照UTF8编码解析客户达发送过来的数据
            req.setCharacterEncoding("UTF-8");
            String username = req.getParameter("username");
            String password = req.getParameter("password");
            System.out.println(username + "---" + password);
            //设置响应数据的MINE Type和数据编码
            resp.setContentType("text/plain;charset=UTF-8");
            //2. 判断
            if("123".equals(username) && "456".equals(password)){
                System.out.println("登录成功");
                resp.getWriter().write("Login Success!");
            }else {
                System.out.println("登录失败");
                resp.getWriter().write("Login Error!");
            }
        }
    }
    ```
    
### 用Servlet模拟一个前后端项目
1. webapp文件下新建一个login.html、login.css2个文件,login.html代码如下
    
    ```
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>CRM-登录</title>
    </head>
    <body>
    <!-- context path -->
    <!--<form action="/crm/test.jsp" method="post">-->
    <form action="/crm/login" method="post">
        <div>用户名 <input type="text" name="username"></div>
        <div>密码 <input type="text" name="password"></div>
        <div><button type="submit">登录</button></div>
    </form>
    
    </body>
    </html>
    ```
2. java文件夹下，com.zh.crm包名下
    1. 新建一个bean文件夹，用于存放数据的模型，新建一个Customer模型类
    2. 新建一个servlet，用来存放HttpServlet的子类对象，新建一个LoginServlet类
    3. LoginServlet代码如下：
        
        ```
        package com.zh.crm.servlet;
        import com.zh.crm.bean.Customer;
        import javax.servlet.*;
        import javax.servlet.http.*;
        import javax.servlet.annotation.*;
        import java.io.IOException;
        import java.io.PrintWriter;
        import java.util.ArrayList;
        import java.util.List;
        
        @WebServlet("/login")
        public class LoginServlet extends HttpServlet {
            @Override
            protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
                System.out.println("------doget-----------");
                //统一函数处理
                doPost(request,response);
            }
        
            @Override
            protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
                System.out.println("-------dopost---------");
                //获取客户端发送的数据（请求参数）
                //按照UTF8编码解析客户达发送过来的数据
                request.setCharacterEncoding("UTF-8");
                String username = request.getParameter("username");
                String password = request.getParameter("password");
                System.out.println(username + "---" + password);
                //设置响应数据的MINE Type和数据编码
                response.setContentType("text/html;charset=UTF-8");
                // 4.拿到输出流
                PrintWriter out = response.getWriter();
                // 5.判断
                if ("123".equals(username) && "123".equals(password)) {
                    success(out);
                } else {
                    failed(out);
                }
            }
            //获取客户,模拟数据库
            private List<Customer> getCustomers() {
                List<Customer> customers = new ArrayList<>();
                for (int i = 0; i< 5; i++) {
                    customers.add(new Customer("张三" + i, "432423" + i, ((i & 1) == 1) ? "男" : "女"));
                }
                return customers;
            }
            //手动拼接字符串
            private void success(PrintWriter out) {
                out.write("<html>");
                out.write("<head>");
                //引用css文件
                out.write("<link rel=\"stylesheet\" href=\"http://localhost:8080/crm/login.css\">");
                out.write("</head>");
                out.write("<body>");
                out.write("<h1 style=\"color: blue; border: 1px solid black;\">登录成功</h1>");
                out.write("<table>");
                out.write("<thead>");
                out.write("<tr>");
                out.write("<th>姓名</th>");
                out.write("<th>电话</th>");
                out.write("<th>性别</th>");
                out.write("</tr>");
                out.write("</thead>");
                out.write("<tbody>");
                //获取客户信息，拼接标签
                List<Customer> customers = getCustomers();
                for (Customer customer : customers) {
                    out.write("<tr>");
                    out.write("<td>" + customer.getName() + "</td>");
                    out.write("<td>" + customer.getPhone() + "</td>");
                    out.write("<td>" + customer.getSex() + "</td>");
                    out.write("</tr>");
                }
        
                out.write("</tbody>");
                out.write("</table>");
                out.write("</body>");
                out.write("</html>");
            }
        
            private void failed(PrintWriter out) {
                out.write("<h1 style=\"color: red; border: 1px solid black;\">登录失败</h1>");
                out.write("<ul>");
                out.write("<a href=\"http://localhost:8080/crm/login.html\">重新登录</a>");
                out.write("</ul>");
            }
        }
        ```
    4. Customer代码如下：
        
        ```
        package com.zh.crm.bean;
        //客户
        public class Customer {
            private String name;
            private String phone;
            private String sex;
            public Customer() {}
            public Customer(String name, String phone, String sex) {
                this.name = name;
                this.phone = phone;
                this.sex = sex;
            }
            public String getName() {
                return name;
            }
            public void setName(String name) {
                this.name = name;
            }
            public String getPhone() {
                return phone;
            }
            public void setPhone(String phone) {
                this.phone = phone;
            }
            public String getSex() {
                return sex;
            }
            public void setSex(String sex) {
                this.sex = sex;
            }
            // Alt + Insert
        }
        ```
        
#### 问题总结
1. 登录之后显是的网页是用后端代码一句一句拼接的，比较繁琐
2. 那么有没有简单的方法呢？ -----JSP
 
  
## JSP
1. JSP是JavaServer Pages的简称，是一种动态网页技术标准
2. 指令

    ```
    <%@ page%>: 配置当前页面信息
    <%@ include%>: 包含其他页面
    <%@ taglib%>: 导入标签库
    ```
3. 输出
    
    ```
    <%= 需要输出的内容%>
    等价于out.print(需要输出的内容)
    response.getWriter().print(需要输出的内容)
    ```
4. 嵌入Java代码
    
    ```
    <%Java代码%>
    ```
5. 注释
    
    ```
    <%--注释内容--%>
    HTML/CSS/JS注释照常使用
    ```
6. 声明
    
    ```
    <%!声明成员变量、方法%>
    ```
    
#### EL表达式、JSTL标签库
1. EL是Expression Launguage的简称
    
    ```
    ${obj.property}、${obj["property"]}、${obj[propertyVar]}
    empty、not empty
    ```
2. JSTL是JSP Standard Tag Library的简称，译为”JSP标准标签库“,由Apache的Jakarta小组维护
3. EL表达式、JSTL标签库都可以简化JSP代码

#### 下载使用JSTL核心标签库
1. 下载地址：[http://tomcat.apache.org/download-taglibs.cgi](http://tomcat.apache.org/download-taglibs.cgi)
    1. 如果使用其核心标签库，只需要下载2个jar包即可
        2. taglibs-standard-impl-1.2.5.jar、taglibs-standard-spec-1.2.5.jar
2. 将jar包加入到WEB-INF/lib中， 并且右击选择"Add das Library"
3. 使用taglib指令导入JSTL核心标签库
    
    ```
    <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
    ```
4. 常用标签
    
    ```
    <c：if test="条件">
    <c：for Each items="集合" var="元素" varStatus="循环相关的信息">
    <c：choose>、<c：when test="条件">、<c：oth erwise>
    ```

### JSP实现前后端项目
1. 在webapp文件夹下新建一个test.jsp 
2. 将login.html的form表单的aciton修改成：`action="/crm/test.jsp"` 
3. test.jsp 代码如下
    
    ```
    <%@ page import="java.util.ArrayList" %>
    <%@ page import="java.util.List" %>
    <%@ page import="com.zh.crm.bean.Customer" %>
    <%@ page contentType="text/html;charset=UTF-8" language="java" %>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>CRM-登录</title>
        <link rel="stylesheet" href="http://localhost:8080/crm/login.css">
    </head>
    <body>
    <%--
        jsp就是一个server类，就是一个继承自HttpServlet类的子类
        这里面可以定义成员变量、方法
        可以写java代码，java代码就是相当于在doGet、doPost的方法中写代码
        jsp中的所有标签都会通过response.getWriter().write()方法，从上到下响应给客户端
    --%>
        <%!
            //定义成员变量，
            //private  int other = 10;
            //定义成员方法，模拟数据
            private List<Customer> getCustomers() {
                List<Customer> customers = new ArrayList<>();
                for (int i = 0; i< 5; i++) {
                    customers.add(new Customer("张三" + i, "432423" + i, ((i & 1) == 1) ? "男" : "女"));
                }
                return customers;
            }
        %>
    
    
        <%
            //这个就相当于在doGet、doPost的方法中写代码
            // 1.设置请求数据的编码
            request.setCharacterEncoding("UTF-8");
            // 2.获取请求参数
            String username = request.getParameter("username");
            String password = request.getParameter("password");
            // 3.先设置响应的内容类型（MIMEType + 数据编码）
            response.setContentType("text/html;charset=UTF-8");
            // 4.拿到输出流
            // 5.判断,成功
            if ("123".equals(username) && "123".equals(password)) {
        %>
            <h1 style="color: blue; border: 1px solid black;">登录成功</h1>
            <table>
                <thead>
                    <tr>
                        <th>姓名</th>
                        <th>电话</th>
                        <th>性别</th>
                    </tr>
                </thead>
                <tbody>
                <%
                    List<Customer> customers = getCustomers();
                    for (Customer customer : customers) {
                %>
                    <tr>
                        <td><%= customer.getName()%></td>
                        <td><%= customer.getPhone()%></td>
                        <td><%= customer.getSex()%></td>
                    </tr>
                <%
                        }
                %>
                </tbody>
            </table>
            <%
                }else {
            %>
            <h1 style="color: #ff0000; border: 1px solid #000000;">登录失败</h1>
            <ul><a href="http://localhost:8080/crm/login.html">重新登录</a></ul>
            <%
                }
            %>
    </body>
    </html>
    ```
4. 总结
    1. jsp本质就是一个servlet，就是一个继承自HttpServlet类的子类，就相当于我们手动写的LoginServlet类
    2. 这里面可以定义成员变量、方法
    3. 可以写java代码，java代码就是相当于在service的方法中写代码
    4. jsp中的所有**非java代码**（H5标签）本质都是通过response.getWriter().write()方法，从上到下响应给客户端
5. 查看编译后的代码
    1. 运行项目后，查看控制台，点击Tomcat Catalina Log
    2. 找到下面一句：
        
        ```
        CATALINA_BASE：[/Users/mac/Library/Caches/JetBrains/IntelliJIdea2020.3/tomcat/c8454ae9-56f7-49f4-af61-eaf70a2a9796]
        ```
    3. 然后进入到该目录下，在`/work/Catalina/localhost/crm/org/apache/jsp/`文件夹下可以看到`test_jsp.java`文件
    4. 打开开文件，可以看到
        1. test_jsp这个类继承HttpJspBase
        2. 双击shift搜索HttpJspBase，点击tomcat源码进入HttpJspBase查看
            
            ```
            public abstract class HttpJspBase extends HttpServlet implements HttpJspPage {}
            ```
            
            1. HttpJspBase继承自HttpServlet
        3. jsp所有的代码都是在_jspService方法中执行
        4. 所有的标签都是通过out.write()响应给客户端








   

