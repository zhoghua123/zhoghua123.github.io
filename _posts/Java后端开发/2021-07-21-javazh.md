---
layout: post
title: Maven补充
category: Java后端开发
tags: Java后端开发
description: Java后端开发
--- 

## 依赖冲突
1. 什么是依赖冲突
    1. spring-webmvc、spring-jdbc都依赖spring-beans
    2. 如果spring-webmvc的版本是5.2.6，那么它依赖的spring-beans默认版本也是5.2.6
    3. 如果spring-jdbc的版本是5.2.8，那么它依赖的spring-beans默认版本也是5.2.8
    4. 如果将5.2.6版本的spring-webmvc、5.2.8版本的spring-jdbc放一起
        1. 会出现2个版本的spring-beans
        2. 这就是产生了依赖冲突
        3. 需要想办法只保留一个版本的spring-beans

### 依赖冲突的解决方案

#### 1.方案一：
1. Maven默认情况下：优先保留前面先声明的版本
2. 根据下面的代码，最终spring-beans将会是5.2.6
    
    ```
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-webmvc</artifactId>
        <version>5.2.6.RELEASE</version>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-jdbc</artifactId>
        <version>5.2.8.RELEASE</version>
    </dependency>
    ```
    
#### 2.方案二：
1. 单独为依赖库增加dependency指定版本号
2. 根据下面的代码，最终spring-beans将会是5.2.8
    
    ```
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-webmvc</artifactId>
        <version>5.2.6.RELEASE</version>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-jdbc</artifactId>
        <version>5.2.8.RELEASE</version>
    </dependency>
    <!-- 直接指定使用哪个版本 -->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-beans</artifactId>
        <version>5.2.8.RELEASE</version>
    </dependency>
    ```

#### 3.方案三：
1. 使用exclusion排除某个依赖
2. 根据下面的代码，最终spring-beans将会是5.2.6
    
    ```
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-jdbc</artifactId>
        <version>5.2.8.RELEASE</version>
        <!-- 删除当前包依赖的spring-beans -->
        <exclusions>
            <exclusion>
                <groupId>org.springframework</groupId>
                <artifactId>spring-beans</artifactId>
            </exclusion>
        </exclusions>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-webmvc</artifactId>
        <version>5.2.6.RELEASE</version>
    </dependency>
    ```

#### 4.方案四：
1. 最常用的解决方案：使用dependencyManagement锁定依赖库的版本号
2. 根据下面的代码，最终spring-beans将会是5.2.8
3. 注意： dependencyManagement只是声明版本号，并不会触发下载导入依赖库

    ```
    <properties>
        <spring.version>5.2.9.RELEASE</spring.version>
    </properties>

    <!-- 仅用于锁定库的版本号，并不会去下载导入库-->
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-beans</artifactId>
                <version>${spring.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>
    
    <!-- 会去下载导入库 -->
    <dependencies>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-jdbc</artifactId>
            <version>5.2.8.RELEASE</version>
        </dependency>
    
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-webmvc</artifactId>
            <version>5.2.6.RELEASE</version>
        </dependency>
    </dependencies>
    ```

### 自定义属性
1. 通过dependencyManagement指定好版本，然后dependency中不需要在写版本
    
    ```
    <!--统一设置所有依赖的版本号-->
    <properties>
        <spring.version>5.2.9.RELEASE</spring.version>
    </properties>
    
    <!--统一固定所有依赖的版本号码-->
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-webmvc</artifactId>
                <version>${spring.version}</version>
            </dependency>
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-jdbc</artifactId>
                <version>${spring.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>
    
    <!--不用在设置版本号-->
    <dependencies>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-jdbc</artifactId>
        </dependency>
    
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-webmvc</artifactId>
        </dependency>
    </dependencies>
    ```

## 分模块构建项目
1. 项目规模比较庞大时，可以考虑对项目进行拆分，分模块进行构建项目
2. 有2种常见的拆分思路
    1. 按业务模块：员工模块、部门模块、工资模块等
    2. 按层：dao层、service层、web层
    
    ![图1](https://gitee.com/zhonghua123/blogimgs/raw/master/img/javazh-31.png)
3. 分模块后，项目结构看起来会复杂一点，建议隐藏一些不常用的文件或文件夹
    1. Setting->Editor->File Types ->Ignore Files and Folders

### 初始化
1. 新建一个Maven项目20_parent
2. 右击20_parent->new->Module...->Maven->next->项目的默认路径就在20_parent下面，项目命名为dao->finished
3. 此时会发现20_parent的pom.xml出现了以下标签
    
    ```
    <!-- 只要这个项目想作为别人的项目，打包方式必须为pom -->
    <packaging>pom</packaging>
    
    <!--聚合-->
    <modules>
        <module>dao</module>
    </modules>
    ```
4. 子项目dao的pom.xml如下：
    
    ```
    <modelVersion>4.0.0</modelVersion>
    <!-- 指定父项目 -->
    <parent>
        <artifactId>20_parent</artifactId>
        <groupId>org.example</groupId>
        <version>1.0-SNAPSHOT</version>
    </parent>
    
    <!--当前项目的id、版本号-->
    <artifactId>dao</artifactId>
    <version>1.0-SNAPSHOT</version>
    ```

### 继承
1. 子项目继承父项目后，可以继承父项目中的pom.xml文件中的一些内容
    1. 比如：dependencies、dependencyManagement、properties等内容
    2. 在20_parent的pom.xml添加如下
        
        ```
        <!-- 这个变量，在dao项目中可以直接引用-->
        <properties>
            <spring.version>5.2.8.RELEASE</spring.version>
        </properties>
    
        <!--     仅用于锁定库的版本号，并不会去下载导入库-->
        <dependencyManagement>
            <dependencies>
                <dependency>
                    <groupId>org.springframework</groupId>
                    <artifactId>spring-context</artifactId>
                    <version>${spring.version}</version>
                </dependency>
            </dependencies>
        </dependencyManagement>
    
        <!-- 会去下载导入库 -->
        <dependencies>
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-context</artifactId>
            </dependency>
        </dependencies>
        ```
    3. 父项目的这些东西，可以在子项目中直接使用，或者pom.xml中直接使用
2. 同理分别新建service、web层,此时项目一级目录如下
    
    ```
    20_parent
        dao     //子项目
        service //子项目
        web     //子项目
        src     //父项目创建时自带
        20_parent.iml //父项目创建时自带
        pom.xml //父项目创建时自带
    ```
3. 注意：子项目是不可以使用父项目的类的，因此直接把父项目src文件夹删除即可

#### 隐藏项目不使用的文件夹
1. 分模块后，项目结构看起来会复杂一点，建议隐藏一些不常用的文件或文件夹
2. 比如上面项目，会有4个iml文件（20_parent.iml、dao.iml、service.iml、web.iml）
3. iml文件是用于说明idea的，因此整个项目不会使用
4. idea配置
    1. （Preverences）Setting->Editor->File Types ->Ignore Files and Folders
    2. 写上`*.xml;`，点击OK即可
    3. 此时打开项目发现没有.iml文件了
5. 此时项目文件目录如下：
    
    ```
    20_parent
        dao     //子项目
            src
                main
                test
            pom.xml
        service //子项目
            src
                main
                test
            pom.xml
        web     //子项目
            src
                main
                test
            pom.xml
        pom.xml //父项目创建时自带
    ```

#### 聚合
1. 此时父项目的pom.xml中的modules标签变化如下
    
    ```
    <!-- 聚合-->
    <modules>
        <module>dao</module>
        <module>service</module>
        <module>web</module>
    </modules>
    ``` 
2. 可以通过modules标签聚合多个项目，可以对多个项目进行统一构建管理
    1. 通常会在父项目中聚合它的子项目

### 依赖
1. service、dao、web分别放各自的代码，那么他们之间如何依赖的呢？
2. 一个项目A可以使用dependency依赖另一个项目B
    1. 项目A中可以直接拥有项目B的classpath中的内容（比如类、配置文件、依赖库等）
3. 举例
    1. 在dao项目下新建一个domain、一个dao
        
        ```
        //domain下的模型类
        //com.zh.domain.Skill
        
        //dao下的dao类
        //com.zh.dao.SkillDao
        ```
    2. 在service项目下新建一个service
        
        ```
        //service
        //com.zh.service.SkillService;
        
        //SkillServiceImpl
        //com.zh.service.impl.SkillServiceImpl;
        ```
4. service项目依赖于dao项目，要使用到dao项目中的Skill、SkillDao，该怎么办呢？
    1. 在service项目的pom.xml添加对dao项目的依赖即可
        
        ```
        <dependencies>
            <dependency>
                <groupId>org.example</groupId>
                <artifactId>dao</artifactId>
                <version>1.0-SNAPSHOT</version>
            </dependency>
        </dependencies>
        ```
    2. 这样就可以在service项目中直接使用dao项目中的所有类了
5. 同理在web项目中创建Controller
    1. 创建SkillController类
        
        ```
        //controller类
        //com.zh.controller.SkillController
        ```
    2. 再在pom.xml中添加对servcie的依赖
        
        ```
        <dependencies>
            <dependency>
                <groupId>org.example</groupId>
                <artifactId>service</artifactId>
                <version>1.0-SNAPSHOT</version>
            </dependency>
        </dependencies>
        ```
    3. 注意：Controller既可以使用service中的类，也可以使用dao中的类
    
#### 继承与依赖的区别
1. 继承：要使用一个项目的pom.xml文件中的配置
2. 依赖：要使用一个项目中的所有类、配置文件（properties）、依赖库（pom.xml中的dependencies）等
    

        
    

