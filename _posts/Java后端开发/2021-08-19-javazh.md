---
layout: post
title: 项目实战六-前后端分离驾考项目（五）
category: Java后端开发
tags: Java后端开发
description: Java后端开发
---  

### 科2科3模块
1. 页面如下
   ![图1](https://gitee.com/zhonghua123/blogimgs/raw/master/img/javazh-44.png) 
2. 根据exam_place_course表，通过EasyCode-MybatisCodeHepler生成对应层的类
3. exam_place_course表如下
    
    ```
    id create_time  name  price  intro  video  cover place_id
    ```
    
    1. place_id是关联exam_palce这张表的id的
    2. **注意：**因此这张表里面没有省份id、城市id
    3. 通过place_id找到exam_palce对应的id，然后找到plage_region对应的省份、城市id
4. 各个层代码如下
    1. po
        
        ```
        @Data
        public class ExamPlaceCourse {
            /**
            * 主键
            */
            private Integer id;
            
            private Date createTime;
            /**
            * 名称
            */
            private String name;
            /**
            * 价格
            */
            private Double price;
            /**
            * 课程类型：0是课程合集，2是科目2，3是科目3
            */
            private Short type;
            
            private String intro;
            /**
            * 视频
            */
            private String video;
            /**
            * 封面
            */
            private String cover;
            /**
            * 考场
            */
            @ForeignField(ExamPlace.class)
            private Integer placeId;
        }
        ``` 
    2. query
        
        ```
        @EqualsAndHashCode(callSuper = true)
        @Data
        public class ExamPlaceCourseQuery extends KeywordQuery {
            private Short type;
            private Integer provinceId;
            private Integer cityId;
            private Integer placeId;
        }
        ```
    3. mapper
        
        ```
        public interface ExamPlaceCourseMapper extends BaseMapper<ExamPlaceCourse> {}
        ```
    4. service
        
        ```
        //ExamPlaceCourseService
        public interface ExamPlaceCourseService extends IService<ExamPlaceCourse>{
            void list(ExamPlaceCourseQuery query);
        }
        //ExamPlaceCourseServiceImpl
        @Service
        @Transactional
        public class ExamPlaceCourseServiceImpl extends ServiceImpl<ExamPlaceCourseMapper, ExamPlaceCourse> implements ExamPlaceCourseService {
        
            @Override
            public void list(ExamPlaceCourseQuery query) {
                MpQueryWrapper<ExamPlaceCourse> wrapper = new MpQueryWrapper<>();
                //先将数据列表展示，查询代码空着
                baseMapper.selectPage(new MpPage<>(query),wrapper).updateQuery();
            }
        }
        ```
    5. controller
        
        ```
        @RestController
        @RequestMapping("/examPlaceCourses")
        public class ExamPlaceCourseController extends BaseController<ExamPlaceCourse> {
            @Autowired
            private ExamPlaceCourseService service;
        
            @Override
            protected IService<ExamPlaceCourse> getService() {
                return service;
            }
            @GetMapping
            public R list(ExamPlaceCourseQuery query) {
                service.list(query);
                return Rs.ok(query);
            }
        }
        ```
    6. 此时页面能正常暂时列表
    
    
#### 实现三级联动
1. 三级联动的后台数据如下
    
    ```
    {
        "code": 0,
        "data": [
            {
                "id": 3,
                "name": "广东",
                "plate": "粤",
                "children": [
                    {
                        "id": 5,
                        "name": "广州",
                        "plate": "A",
                        "children": [
                            {
                                "id": 1,
                                "name": "白云考场"
                            },
                            {
                                "id": 5,
                                "name": "天河考场"
                            }
                        ]
                    },
                    {
                        "id": 12,
                        "name": "深圳",
                        "plate": "B",
                        "children": [
                            {
                                "id": 4,
                                "name": "保安考场"
                            }
                        ]
                    }
                ]
            },
            {
                "id": 10,
                "name": "广西",
                "plate": "桂",
                "children": [
                    {
                        "id": 11,
                        "name": "南宁",
                        "plate": "A",
                        "children": [
                            {
                                "id": 3,
                                "name": "电瓶车考场"
                            }
                        ]
                    }
                ]
            }
        ]
    }
    ```
2. 从上面数据分析可以得知，需要在CityDto下新增children字段
    
    ```
    @Data
    public class CityDto {
        private Integer id;
        private String name;
        private String plate;
        private List<?> children;
    }
    ```
3. 由于是考场信息ExamPlaceController下新增
    
    ```
    @GetMapping("/regionExamPlaces")
    public R listRegionExamPlaces() {
        return Rs.ok(service.listRegionExamPlaces());
    }
    ```
4. ExamPlaceService
    
    ```
    //ExamPlaceService新增
    List<ProvinceDto> listRegionExamPlaces();
    //ExamPlaceServiceImpl新增
     @Override
    public List<ProvinceDto> listRegionExamPlaces() {
        return baseMapper.selectRegionExamPlaces();
    }
    ```
5. resources.com.zh.jk.mapper下新增ExamPlaceMapper.xml
    
    ```
    <?xml version="1.0" encoding="UTF-8" ?>
    <!DOCTYPE mapper
            PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
            "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    <mapper namespace="com.zh.jk.mapper.ExamPlaceMapper">
        <resultMap id="rmSelectRegionExamPlaces"
                   type="ProvinceDto">
            <id column="id" property="id"/>
            <result column="name" property="name"/>
            <result column="plate" property="plate"/>
            <collection property="children" ofType="CityDto">
                <id column="city_id" property="id"/>
                <result column="city_name" property="name"/>
                <result column="city_plate" property="plate"/>
                <collection property="children" ofType="ExamPlace">
                    <id column="exam_place_id" property="id"/>
                    <result column="exam_place_name" property="name"/>
                </collection>
            </collection>
        </resultMap>
    
        <select id="selectRegionExamPlaces"
                resultMap="rmSelectRegionExamPlaces">
            SELECT
                p.id,
                p.name,
                p.plate,
                c.id city_id,
                c.name city_name,
                c.plate city_plate,
                e.id exam_place_id,
                e.name exam_place_name
            FROM plate_region p
                 JOIN plate_region c ON c.parent_id = p.id
                 JOIN exam_place e ON e.city_id = c.id AND e.province_id = p.id
            WHERE p.parent_id = 0
            ORDER BY p.pinyin, c.plate
        </select>
    </mapper>
    ```
6. 则可以通过`http://localhost:8888/examPlaces/regionExamPlaces`接口获取三级联动数据

#### 编辑携带省份
1. 点击编辑，页面如下
    ![图1](https://gitee.com/zhonghua123/blogimgs/raw/master/img/javazh-45.png) 
2. 省份为何为空呢？原因如下
    1. 从数据库表exam_place_course可以知道，该表是没有省份、城市字段的
    2. 因此当点击列表中的某条数据，是拿不到省份、城市信息的
    3. 因此编辑页面不能携带到省份、城市信息
3. 解决办法
    


